let rm={},rmWidth=(rm.stopdragimg=$("img"),rm.stopdragimg.on("dragstart",function(){return!1}),rm.showRightMenu=function(e,n=0,t=0){var i=$("#rightMenu");i.css("top",n+"px").css("left",t+"px"),e?(i.show(),stopMaskScroll()):i.hide()},rm.hideRightMenu=function(){rm.showRightMenu(!1),$("#rightmenu-mask").attr("style","display: none")},$("#rightMenu").width()),rmHeight=$("#rightMenu").height(),domhref=(rm.reloadrmSize=function(){rmWidth=$("#rightMenu").width(),rmHeight=$("#rightMenu").height()},""),domImgSrc="";function downloadImage(e,o){rm.hideRightMenu(),0==rm.downloadimging?(rm.downloadimging=!0,btf.snackbarShow("正在下载中，请稍后",!1,1e4),setTimeout(function(){let i=new Image;i.setAttribute("crossOrigin","anonymous"),i.onload=function(){var e=document.createElement("canvas"),e=(e.width=i.width,e.height=i.height,e.getContext("2d").drawImage(i,0,0,i.width,i.height),e.toDataURL("image/png")),n=document.createElement("a"),t=new MouseEvent("click");n.download=o||"photo",n.href=e,n.dispatchEvent(t)},i.src=e,btf.snackbarShow("图片已添加盲水印，请遵守版权协议"),rm.downloadimging=!1},"10000")):btf.snackbarShow("有正在进行中的下载，请稍后再试")}function imageToBlob(e){const t=new Image,i=document.createElement("canvas"),o=i.getContext("2d");return t.crossOrigin="",t.src=e,new Promise(n=>{t.onload=function(){i.width=this.naturalWidth,i.height=this.naturalHeight,o.drawImage(this,0,0),i.toBlob(e=>{n(e)},"image/png",.75)}})}async function copyImage(e){e=await imageToBlob(e),e=new ClipboardItem({"image/png":e});navigator.clipboard.write([e])}function stopMaskScroll(){document.getElementById("rightmenu-mask")&&document.getElementById("rightmenu-mask").addEventListener("mousewheel",function(e){rm.hideRightMenu()},!1),document.getElementById("rightMenu")&&document.getElementById("rightMenu").addEventListener("mousewheel",function(e){rm.hideRightMenu()},!1)}window.oncontextmenu=function(w){if(768<document.body.clientWidth){let e=w.clientX+10,n=w.clientY,t=$(".rightMenuOther"),i=$(".rightMenuPlugin"),o=$("#menu-copytext"),r=$("#menu-commenttext"),c=$("#menu-newwindow"),m=$("#menu-copylink"),h=$("#menu-copyimg"),a=$("#menu-downloadimg"),d=$("#menu-search"),u=$("#menu-searchBaidu"),l=w.target.href,g=w.target.currentSrc,s=!1;return t.show(),(selectTextNow&&window.getSelection()?(s=!0,o.show(),r.show(),d.show(),u.show(),t):(o.hide(),r.hide(),u.hide(),d)).hide(),l?(s=!0,c.show(),m.show(),t.hide(),domhref=l):(c.hide(),m.hide()),g?(s=!0,h.show(),a.show(),t.hide(),domImgSrc=g):(h.hide(),a.hide()),s?i.show():i.hide(),rm.reloadrmSize(),e+rmWidth>window.innerWidth&&(e-=rmWidth+10),n+rmHeight>window.innerHeight&&(n-=n+rmHeight-window.innerHeight),rm.showRightMenu(!0,n,e),$("#rightmenu-mask").attr("style","display: flex"),!1}},rm.downloadimging=!1,rm.writeClipImg=function(e){console.log("按下复制"),rm.hideRightMenu(),btf.snackbarShow("正在下载中，请稍后",!1,1e4),0==rm.downloadimging&&(rm.downloadimging=!0,setTimeout(function(){copyImage(e),btf.snackbarShow("复制成功！图片已添加盲水印，请遵守版权协议"),rm.downloadimging=!1},"10000"))},rm.switchDarkMode=function(){navFn.switchDarkMode(),rm.hideRightMenu()},rm.copyUrl=function(e){$("body").after("<input id='copyVal'></input>");var n=document.getElementById("copyVal");n.value=e,n.select(),n.setSelectionRange(0,n.value.length),document.execCommand("copy"),$("#copyVal").remove()},rm.rightmenuCopyText=function(e){navigator.clipboard&&navigator.clipboard.writeText(e),rm.hideRightMenu()},rm.copyPageUrl=function(){var e=window.location.href;rm.copyUrl(e),btf.snackbarShow("复制本页链接地址成功",!1,2e3),rm.hideRightMenu()};var selectTextNow="";function selceText(){var e=document.selection?document.selection.createRange().text:window.getSelection()+"";selectTextNow=e||""}function replaceAll(e,n,t){return e.split(n).join(t)}function addRightMenuClickEvent(){$("#menu-backward").on("click",function(){window.history.back(),rm.hideRightMenu()}),$("#menu-forward").on("click",function(){window.history.forward(),rm.hideRightMenu()}),$("#menu-refresh").on("click",function(){window.location.reload()}),$("#menu-top").on("click",function(){btf.scrollToDest(0,500),rm.hideRightMenu()}),$(".menu-link").on("click",rm.hideRightMenu),$("#menu-darkmode").on("click",rm.switchDarkMode),$("#menu-home").on("click",function(){window.location.href=window.location.origin}),$("#rightmenu-mask").on("click",rm.hideRightMenu),$("#rightmenu-mask").contextmenu(function(){return rm.hideRightMenu(),!1}),$("#menu-translate").on("click",function(){rm.hideRightMenu(),translateInitialization()}),$("#menu-copy").on("click",rm.copyPageUrl),$("#menu-copytext").on("click",function(){rm.rightmenuCopyText(selectTextNow),btf.snackbarShow("复制成功，复制和转载请标注本文地址")}),$("#menu-commenttext").on("click",function(){rm.rightMenuCommentText(selectTextNow)}),$("#menu-newwindow").on("click",function(){window.open(domhref),rm.hideRightMenu()}),$("#menu-copylink").on("click",function(){rm.rightmenuCopyText(domhref),btf.snackbarShow("已复制链接地址")}),$("#menu-downloadimg").on("click",function(){downloadImage(domImgSrc,"zhheo")}),$("#menu-copyimg").on("click",function(){rm.writeClipImg(domImgSrc)}),$("#menu-searchBaidu").on("click",rm.searchBaidu)}document.onmouseup=document.ondbclick=selceText,rm.rightMenuCommentText=function(e){rm.hideRightMenu();var n=document.getElementsByClassName("el-textarea__inner")[0],t=document.createEvent("HTMLEvents"),e=(t.initEvent("input",!0,!0),replaceAll(e,"\n","\n> ")),e=(n.value="> "+e+"\n\n",n.dispatchEvent(t),document.querySelector("#post-comment").offsetTop);window.scrollTo(0,e-80),n.focus(),n.setSelectionRange(-1,-1)},rm.searchBaidu=function(){btf.snackbarShow("即将跳转到百度搜索",!1,2e3),setTimeout(function(){window.open("https://www.baidu.com/s?wd="+selectTextNow)},"2000"),rm.hideRightMenu()};