const IssuesAPI={requestIssuesAPI(a,r,o){let l=10;!function n(){return new Promise((s,e)=>{let t=0,i=setTimeout(()=>{0===t&&(t=2,i=null,e("Request timed out"),0==l)&&o()},5e3);fetch(a).then(function(e){if(2!==t&&(clearTimeout(i),s(e),i=null,t=1),e.ok)return e.json();throw new Error("Network response was not ok.")}).then(function(e){l=0,r(e)}).catch(function(e){0<l?(--l,setTimeout(()=>{n()},5e3)):o()})})}()},parseIssueStrToJson(e){let s=e.match(/```json[\s|\S]*```/);if((s=s&&0<s.length?s[0]:s)&&(s=s.split("```json")[1].split("```")[0]))return JSON.parse(s)},groupIssuesData(t,s){var n=new Object;if(0<s.length)if(null!=t.group){var a=t.group.split(":");if(1<a.length){var r=a[0];let e=a[1];for(r&&(e=e&&e.split(",")),t.group=e,i=0;i<s.length;i++){const t=this.parseIssueStrToJson(s[i].body);if(t&&r in t){let s=t[r];s=s.replace(", ",",").split(",");for(var o=0;o<s.length;o++)if(e.includes(s[o])){let e=n[s[o]];(e=null==e?new Array:e).push(t),n[s[o]]=e}}}}}else for(t.group=[""],i=0;i<s.length;i++){const t=this.parseIssueStrToJson(s[i].body);if(t){let e=n[""];(e=null==e?new Array:e).push(t),n[""]=e}}return n},getIssuesAPIForSites(s){const o=$(s.el)[0];$(o).append('<div class="loading"><i class="fa fa-cog fa-2x fa-spin"></i><p>Loading</p></div>'),this.requestIssuesAPI(s.api,function(e){$(o).find(".loading").remove();const a=IssuesAPI.groupIssuesData(s,e),r=Object.keys(a);s.group.forEach((s,t)=>{var i=a[s];if(i&&0<i.length)for(0<s.length?$(o).append("<h2>"+s+"</h2>"):""==name&&1<r.length&&$(o).append("<h2>unclassified</h2>"),$(o).append('<div class="site-card-group '+t+'"></div>'),j=0;j<i.length;j++){const s=i[j];var n=s.screenshot&&0<s.screenshot.length?'<div class="img"><img src="'+s.screenshot+'" onerror="javascript:this.src=\'https://image.thum.io/get/width/1024/crop/768/'+s.url+"';\"/></div>":'<div class="img"></div>';let e='<div class="info">';s.avatar&&0<s.avatar.length&&(e+='<img src="'+s.avatar+'" onerror="javascript:this.src=\'https://image.thum.io/get/width/1024/crop/768/'+s.url+"';\"/>"),e+='<span class="title">'+s.title+'</span><span class="desc">'+s.description+"</span></div>";n="<a class='site-card' target='_blank' href='"+s.url+"'>"+n+e+"</a>";$(o).find(".site-card-group."+t).append(n)}})},function(){$(o).find(".loading i").remove(),$(o).find(".loading p").text("Loading failed, please try again later.")})},getIssuesAPIForTimeline(e){const t=$(e.el)[0];$(t).append('<div class="loading"><i class="fa fa-cog fa-2x fa-spin"></i><p>Loading</p></div>'),this.requestIssuesAPI(e.api,function(e){if($(t).find(".loading").remove(),0<e.length)for(i=0;i<e.length;i++){var s='&nbsp;&nbsp;<a class="comments" target="_blank" href="'+e[i].html_url+'"><i class="fa fa-comment-dots fa-fw"></i>'+e[i].comments+"</a>",s='<div class="timenode"><div class="meta"><p></p><p>'+e[i].title+s+'</p><p></p></div><div class="body"><p>'+e[i].body+"</p></div></div>";$(t).append(s)}},function(){$(t).find(".loading i").remove(),$(t).find(".loading p").text("Loading failed, please try again later.")})},request(){for(var e=document.getElementsByClassName("issues-api"),s=0;s<e.length;s++){var t=e[s],i=t.getAttribute("api"),n=t.getAttribute("group"),a=new Object;a.class=t.getAttribute("class"),a.el=t,a.api=i,a.group=n,a.class.split(" ").includes("sites")?this.getIssuesAPIForSites(a):a.class.split(" ").includes("timeline")&&this.getIssuesAPIForTimeline(a)}}};IssuesAPI.request(),document.addEventListener("pjax:complete",function(){IssuesAPI.request()});