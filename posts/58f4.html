<!DOCTYPE html>
<html lang="zh-CN">
<head><!-- hexo injector head_begin start -->
<link rel="stylesheet" href="/css/bilicard.css?v=372a94e93f">
<!-- hexo injector head_begin end -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="空中有零，零域，分享快乐，音乐，心得，生活，电影，代码，编程，考试，学业，零式的天空，凌空博客，原零空博客，原Tans博客，现零的小屋官方博客，计算机，音乐，电脑，编程，生活，分享">
    <meta name="description" content="一个技术控，爱技术，爱分享，爱音乐">
    <meta name="author" content="Pin Young">
    
    <title>
        
            springboot中集成quartz任务调度 |
        
        零域
    </title>
    
<link rel="stylesheet" href="/css/style.css?v=512d6d2336">

    <link rel="shortcut icon" href="/img/favicon.png?v=96e789c5be">
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css?v=d318f67430">

    
<link rel="stylesheet" href="/font/css/regular.min.css?v=dd643a612d">

    
<link rel="stylesheet" href="/font/css/solid.min.css?v=4abb638a78">

    
<link rel="stylesheet" href="/font/css/brands.min.css?v=bffe02773a">

    
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"0skyu.cn","root":"/","language":"zh-CN","path":"search.xml"}
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#EE5A24","logo":"/img/favicon.png?v=96e789c5be","favicon":"/img/favicon.png?v=96e789c5be","avatar":"img/1.jpg","font_size":null,"font_family":null,"hover":{"shadow":true,"scale":false},"first_screen":{"enable":true,"header_transparent":false,"background_img":"/img/bg/333.jpg?v=7b42f26db7","description":"Keep writing and Keep loving.","font_color":"#f0d21a","hitokoto":true},"scroll":{"progress_bar":true,"percent":false}},"local_search":{"enable":true,"preload":true},"code_copy":{},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"side_tools":{},"pjax":{"enable":true},"lazyload":{"enable":true},"comment":{"enable":false,"use":"gitalk","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":"DsTansice","github_admins":"DsTansice","repository":"Null-Comment","client_id":"b109b534b2268088d780","client_secret":"7808e138a1ffbcd9f02bb39cc1ee7fb41828c52f","proxy":null},"twikoo":{"env_id":"twikoo-0skyucn-1gkzaji32bb03146","region":null,"version":"1.6.8"},"waline":{"server_url":null,"reaction":false,"version":2}},"post":{"author_label":{"enable":true,"auto":true,"custom_label_list":["Trainee","Engineer","Architect"]},"word_count":{"enable":true,"wordcount":true,"min2read":true},"img_align":"left","copyright_info":true},"version":"3.6.1"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml?v=f2133d50b5" title="零域" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/img/favicon.png?v=96e789c5be">
                </a>
            
            <a class="logo-title" href="/">
               零域
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class href="/">
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class href="/archives">
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class href="/tags">
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class href="/categories">
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class href="/links">
                                友链
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class target="_blank" rel="noopener" href="https://hao.0skyu.cn/">
                                HAO
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class href="/links">友链</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class target="_blank" rel="noopener" href="https://hao.0skyu.cn/">HAO</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            <div class="article-title">
                <span class="title-hover-animation">springboot中集成quartz任务调度</span>
            </div>

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/img/1.jpg?v=e52bd9a478">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">Pin Young</span>
                            
                                <span class="author-label">Lv9</span>
                            
                        </div>
                        <div class="meta-info">
                            
<div class="article-meta-info">
    <span class="article-date article-meta-item">
        
            <i class="fa-regular fa-calendar-plus"></i>&nbsp;
        
        <span class="pc">2017-05-15 17:12:21</span>
        <span class="mobile">2017-05-15 17:12</span>
    </span>
    
        <span class="article-update-date article-meta-item">
        <i class="fas fa-file-pen"></i>&nbsp;
        <span class="pc">2023-02-02 13:30:31</span>
    </span>
    
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/java/">java</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/quartz/">quartz</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/springboot/">springboot</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>2.2k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>11 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content keep-markdown-body">
                

                <h1 id="quartz的使用"><a href="#quartz的使用" class="headerlink" title="quartz的使用"></a>quartz的使用</h1><h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>  Quartz是一个完全由Java编写的开源作业调度框架，为在Java应用程序中进行作业调度提供了简单却强大的机制。Quartz允许开发人员根据时间间隔来调度作业。它实现了作业和触发器的多对多的关系，还能把多个作业与不同的触发器关联。</p>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>   最近项目需求需要用户设定自动执行的定时任务，因为用的springboot框架，所以结合springboot,<br>进行quartz在项目中的使用<br>   所需依赖：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 要用最新版本，<span class="number">4.2</span><span class="number">.7</span>.<span class="property">RELEASE</span> --&gt;</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line">		&lt;!-- tools --&gt;</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line">		&lt;!-- quartz  版本用：<span class="number">2.2</span><span class="number">.1</span>以上--&gt;</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.quartz-scheduler<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line">		&lt;!-- 该依赖必加，里面有sping对schedule的支持 --&gt;</span><br><span class="line">		<span class="language-xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>在Spring中使用Quartz有两种方式实现：第一种是任务类继承QuartzJobBean，第二种则是在配置文件里定义任务类和要执行的方法，类和方法可以是普通类。很显然，第二种方式远比第一种方式来的灵活。</p>
<p>这里采用的就是第二种方式。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">	<span class="attr">xmlns:task</span>=<span class="string">"http://www.springframework.org/schema/task"</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.0.xsd"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	</span></span><br><span class="line"><span class="language-xml">	<span class="comment">&lt;!-- 使用MethodInvokingJobDetailFactoryBean，任务类可以不实现Job接口，通过targetMethod指定调用方法--&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"taskJob"</span> <span class="attr">class</span>=<span class="string">"com.example.demo.utils.TestTask"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jobDetail"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"group"</span> <span class="attr">value</span>=<span class="string">"job_work"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"job_work_name"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="comment">&lt;!--false表示等上一个任务执行完后再开启新的任务--&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"concurrent"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetObject"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        	<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"taskJob"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">   	 	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"targetMethod"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        	<span class="tag">&lt;<span class="name">value</span>&gt;</span>run<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="comment">&lt;!--  调度触发器 --&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myTrigger"</span> <span class="attr">lazy-init</span>=<span class="string">"false"</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">      	<span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.CronTriggerFactoryBean"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">value</span>=<span class="string">"work_default_name"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"group"</span> <span class="attr">value</span>=<span class="string">"work_default"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jobDetail"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        	<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"jobDetail"</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cronExpression"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        	<span class="tag">&lt;<span class="name">value</span>&gt;</span>0 0 10 * * ?<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="comment">&lt;!-- 调度工厂 --&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"scheduler"</span> <span class="attr">lazy-init</span>=<span class="string">"false"</span> <span class="attr">class</span>=<span class="string">"org.springframework.scheduling.quartz.SchedulerFactoryBean"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"triggers"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        	<span class="tag">&lt;<span class="name">list</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            	<span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"myTrigger"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        	<span class="tag">&lt;/<span class="name">list</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    	<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	</span></span><br><span class="line"><span class="language-xml">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"springContextUtil"</span> <span class="attr">class</span>=<span class="string">"com.example.demo.utils.MyApplicationContextUtil"</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>TestTask类则是一个普通的Java类，没有继承任何类和实现任何接口(当然可以用注解方式来声明bean)：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">example</span>.<span class="property">demo</span>.<span class="property">utils</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">beans</span>.<span class="property">factory</span>.<span class="property">annotation</span>.<span class="property">Autowired</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">beans</span>.<span class="property">factory</span>.<span class="property">annotation</span>.<span class="property">Configurable</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">scheduling</span>.<span class="property">annotation</span>.<span class="property">EnableScheduling</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by clb on 17-7-14.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">@<span class="title class_">Configurable</span></span><br><span class="line">@<span class="title class_">EnableScheduling</span></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">TestTask</span> {</span><br><span class="line">	@<span class="title class_">Autowired</span></span><br><span class="line">	<span class="title class_">ScheduleJobService</span> scheduleJobService;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 检查任务启动情况</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	public <span class="keyword">void</span> <span class="title function_">run</span>(<span class="params"></span>) {</span><br><span class="line">		<span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">"测试任务线程开始执行"</span>);</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>读取配置类</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">example</span>.<span class="property">demo</span>.<span class="property">utils</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">beans</span>.<span class="property">BeansException</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">context</span>.<span class="property">ApplicationContext</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">context</span>.<span class="property">ApplicationContextAware</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">stereotype</span>.<span class="property">Component</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Note: 获取上下文的bean</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">MyApplicationContextUtil</span> implements <span class="title class_">ApplicationContextAware</span> {</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 声明一个静态变量保存   </span></span><br><span class="line">	private <span class="keyword">static</span> <span class="title class_">ApplicationContext</span> applicationContext;</span><br><span class="line"></span><br><span class="line">	public <span class="keyword">void</span> <span class="title function_">setApplicationContext</span>(<span class="title class_">ApplicationContext</span> applicationContext)</span><br><span class="line">			throws <span class="title class_">BeansException</span> {</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">		<span class="title class_">MyApplicationContextUtil</span>.<span class="property">applicationContext</span>=applicationContext;   </span><br><span class="line">	}</span><br><span class="line">	</span><br><span class="line">	public <span class="keyword">static</span> <span class="title class_">ApplicationContext</span> <span class="title function_">getContext</span>(<span class="params"></span>){</span><br><span class="line">		<span class="keyword">return</span> applicationContext;</span><br><span class="line">	}  </span><br><span class="line">	</span><br><span class="line">	@<span class="title class_">SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    public <span class="keyword">static</span> &lt;T&gt; T <span class="title function_">getBean</span>(<span class="title class_">String</span> name) throws <span class="title class_">BeansException</span> {</span><br><span class="line">               <span class="keyword">return</span> (T) applicationContext.<span class="title function_">getBean</span>(name);</span><br><span class="line">     }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>在Application添加配置</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@<span class="title class_">Configuration</span></span><br><span class="line">@<span class="title class_">ImportResource</span>(<span class="string">"classpath:/spring/applicationContext.xml"</span>)</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">XmlImportingConfiguration</span> {</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>项目启动自运行类</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">example</span>.<span class="property">demo</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by clb on 17-7-17.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.<span class="property">example</span>.<span class="property">demo</span>.<span class="property">utils</span>.<span class="property">ScheduleJobService</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">beans</span>.<span class="property">factory</span>.<span class="property">annotation</span>.<span class="property">Autowired</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">boot</span>.<span class="property">CommandLineRunner</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">stereotype</span>.<span class="property">Component</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 服务启动执行</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">MyStartupRunner1</span> implements <span class="title class_">CommandLineRunner</span> {</span><br><span class="line">	@<span class="title class_">Autowired</span></span><br><span class="line">	<span class="title class_">ScheduleJobService</span> scheduleJobService;</span><br><span class="line">	@<span class="title class_">Override</span></span><br><span class="line">	public <span class="keyword">void</span> <span class="title function_">run</span>(<span class="title class_">String</span>... args) throws <span class="title class_">Exception</span> {</span><br><span class="line">		<span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;服务启动执行，执行加载数据等操作&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;"</span>);</span><br><span class="line">		<span class="title function_">init</span>();</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 在项目启动时运行以下代码</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> <span class="variable">Exception</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	public <span class="keyword">void</span> <span class="title function_">init</span>() throws <span class="title class_">Exception</span> {</span><br><span class="line">		scheduleJobService.<span class="title function_">getAllSchedules</span>();</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>任务操作类</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">example</span>.<span class="property">demo</span>.<span class="property">utils</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.<span class="property">quartz</span>.*;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">beans</span>.<span class="property">factory</span>.<span class="property">annotation</span>.<span class="property">Autowired</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">scheduling</span>.<span class="property">quartz</span>.<span class="property">SchedulerFactoryBean</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">stereotype</span>.<span class="property">Service</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">ArrayList</span>;</span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">List</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by clb on 17-7-17.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@<span class="title class_">Service</span></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">ScheduleJobService</span> {</span><br><span class="line">	@<span class="title class_">Autowired</span></span><br><span class="line">	<span class="title class_">SchedulerFactoryBean</span> schedulerFactoryBean;</span><br><span class="line">	private <span class="keyword">static</span> <span class="title class_">String</span> <span class="variable constant_">JOB_GROUP_NAME</span> = <span class="string">"JOBGROUP_NAME"</span>;</span><br><span class="line">	private <span class="keyword">static</span> <span class="title class_">String</span> <span class="variable constant_">TRIGGER_GROUP_NAME</span> = <span class="string">"EXTJWEB_TRIGGERGROUP_NAME"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public <span class="keyword">void</span> <span class="title function_">getAllSchedules</span>() throws <span class="title class_">Exception</span> {</span><br><span class="line">		<span class="comment">// 这里从数据库中获取任务信息数据</span></span><br><span class="line">		<span class="title class_">List</span>&lt;<span class="title class_">ScheduleJob</span>&gt; jobList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">		<span class="title class_">ScheduleJob</span> scheduleJob = <span class="keyword">new</span> <span class="title class_">ScheduleJob</span>();</span><br><span class="line">		<span class="title class_">String</span> cron = <span class="title class_">String</span>.<span class="title function_">format</span>(<span class="string">"0 0/%s * * * ? *"</span>,<span class="number">1</span>);</span><br><span class="line">		scheduleJob.<span class="title function_">setJobDesc</span>(<span class="title class_">String</span>.<span class="title function_">format</span>(<span class="string">"task(id:%s) is running"</span>,<span class="string">"taskId"</span>));</span><br><span class="line">		scheduleJob.<span class="title function_">setJobName</span>(<span class="title class_">String</span>.<span class="title function_">valueOf</span>(<span class="number">11</span>));</span><br><span class="line">		scheduleJob.<span class="title function_">setJobGroup</span>(<span class="string">"test_group"</span>);</span><br><span class="line">		scheduleJob.<span class="title function_">setCronExpression</span>(cron);</span><br><span class="line">		jobList.<span class="title function_">add</span>(scheduleJob);</span><br><span class="line">		<span class="keyword">for</span> (<span class="title class_">ScheduleJob</span> job : jobList) {</span><br><span class="line">			<span class="title function_">addScheduleJob</span>(job);</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@Description</span>: 添加一个定时任务</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> <span class="variable">job</span></span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> <span class="variable">SchedulerException</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line"></span><br><span class="line">	public <span class="keyword">void</span> <span class="title function_">addScheduleJob</span>(<span class="title class_">ScheduleJob</span> job) throws <span class="title class_">SchedulerException</span> {</span><br><span class="line">		<span class="title class_">Scheduler</span> scheduler = schedulerFactoryBean.<span class="title function_">getScheduler</span>();</span><br><span class="line">		<span class="title class_">TriggerKey</span> triggerKey = <span class="title class_">TriggerKey</span>.<span class="title function_">triggerKey</span>(job.<span class="title function_">getJobName</span>(), job.<span class="title function_">getJobGroup</span>());</span><br><span class="line">		<span class="comment">//获取trigger，即在spring配置文件中定义的 bean id="myTrigger"</span></span><br><span class="line">		<span class="title class_">CronTrigger</span> trigger = (<span class="title class_">CronTrigger</span>) scheduler.<span class="title function_">getTrigger</span>(triggerKey);</span><br><span class="line">		<span class="comment">//不存在，创建一个</span></span><br><span class="line">		<span class="keyword">if</span> (<span class="literal">null</span> == trigger) {</span><br><span class="line">			<span class="title class_">JobDetail</span> jobDetail = <span class="title class_">JobBuilder</span>.<span class="title function_">newJob</span>(<span class="title class_">QuartzJobFactory</span>.<span class="property">class</span>)</span><br><span class="line">					.<span class="title function_">withIdentity</span>(job.<span class="title function_">getJobName</span>(), job.<span class="title function_">getJobGroup</span>()).<span class="title function_">build</span>();</span><br><span class="line">			jobDetail.<span class="title function_">getJobDataMap</span>().<span class="title function_">put</span>(<span class="string">"scheduleJob"</span>, job);</span><br><span class="line">			<span class="comment">//表达式调度构建器</span></span><br><span class="line">			<span class="title class_">CronScheduleBuilder</span> scheduleBuilder = <span class="title class_">CronScheduleBuilder</span>.<span class="title function_">cronSchedule</span>(job</span><br><span class="line">					.<span class="title function_">getCronExpression</span>()).<span class="title function_">withMisfireHandlingInstructionFireAndProceed</span>();</span><br><span class="line">			<span class="comment">//按新的cronExpression表达式构建一个新的trigger</span></span><br><span class="line">			trigger = <span class="title class_">TriggerBuilder</span>.<span class="title function_">newTrigger</span>().<span class="title function_">startNow</span>().<span class="title function_">withIdentity</span>(job.<span class="title function_">getJobName</span>(), job.<span class="title function_">getJobGroup</span>()).<span class="title function_">withSchedule</span>(scheduleBuilder).<span class="title function_">build</span>();</span><br><span class="line">			scheduler.<span class="title function_">scheduleJob</span>(jobDetail, trigger);</span><br><span class="line">		} <span class="keyword">else</span> {</span><br><span class="line">			<span class="comment">// Trigger已存在，那么更新相应的定时设置</span></span><br><span class="line">			<span class="comment">//表达式调度构建器</span></span><br><span class="line">			<span class="title class_">CronScheduleBuilder</span> scheduleBuilder = <span class="title class_">CronScheduleBuilder</span>.<span class="title function_">cronSchedule</span>(job</span><br><span class="line">					.<span class="title function_">getCronExpression</span>()).<span class="title function_">withMisfireHandlingInstructionFireAndProceed</span>();</span><br><span class="line">			<span class="comment">//按新的cronExpression表达式重新构建trigger</span></span><br><span class="line">			trigger = trigger.<span class="title function_">getTriggerBuilder</span>().<span class="title function_">startNow</span>().<span class="title function_">withIdentity</span>(triggerKey)</span><br><span class="line">					.<span class="title function_">withSchedule</span>(scheduleBuilder).<span class="title function_">build</span>();</span><br><span class="line">			<span class="comment">//按新的trigger重新设置job执行</span></span><br><span class="line">			scheduler.<span class="title function_">rescheduleJob</span>(triggerKey, trigger);</span><br><span class="line">		}</span><br><span class="line">		<span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">"触发器执行完毕！"</span>);</span><br><span class="line">		<span class="comment">// 启动</span></span><br><span class="line">		<span class="keyword">if</span> (!scheduler.<span class="title function_">isShutdown</span>()) {</span><br><span class="line">			scheduler.<span class="title function_">start</span>();</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@Description</span>: 移除一个任务</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> <span class="variable">job</span></span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> <span class="variable">SchedulerException</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	public <span class="keyword">void</span> <span class="title function_">removeJob</span>(<span class="title class_">ScheduleJob</span> job) throws <span class="title class_">SchedulerException</span> {</span><br><span class="line">		<span class="title class_">Scheduler</span> sched = schedulerFactoryBean.<span class="title function_">getScheduler</span>();</span><br><span class="line">		<span class="title class_">TriggerKey</span> triggerKey = <span class="title class_">TriggerKey</span>.<span class="title function_">triggerKey</span>(job.<span class="title function_">getJobName</span>(), job.<span class="title function_">getJobGroup</span>());</span><br><span class="line">		sched.<span class="title function_">pauseTrigger</span>(triggerKey);<span class="comment">// 停止触发器</span></span><br><span class="line">		sched.<span class="title function_">unscheduleJob</span>(triggerKey);<span class="comment">// 移除触发器</span></span><br><span class="line">		<span class="title class_">JobKey</span> jobKey = <span class="keyword">new</span> <span class="title class_">JobKey</span>(job.<span class="title function_">getJobName</span>(),job.<span class="title function_">getJobGroup</span>());</span><br><span class="line">		sched.<span class="title function_">deleteJob</span>(jobKey );<span class="comment">// 删除任务</span></span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>作业调度执行类</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">example</span>.<span class="property">demo</span>.<span class="property">utils</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.<span class="property">example</span>.<span class="property">demo</span>.<span class="property">service</span>.<span class="property">TaskService</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">quartz</span>.*;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">stereotype</span>.<span class="property">Component</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: 若一个方法一次执行不完下次轮转时则等待改方法执行完后才执行下一次操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">@<span class="title class_">Component</span></span><br><span class="line">@<span class="title class_">DisallowConcurrentExecution</span></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">QuartzJobFactory</span> implements <span class="title class_">Job</span> {</span><br><span class="line">	@<span class="title class_">Override</span></span><br><span class="line">	public <span class="keyword">void</span> <span class="title function_">execute</span>(<span class="title class_">JobExecutionContext</span> context) throws <span class="title class_">JobExecutionException</span> {</span><br><span class="line">		<span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">"任务成功运行"</span>);</span><br><span class="line">		<span class="title class_">ScheduleJob</span> scheduleJob = (<span class="title class_">ScheduleJob</span>)context.<span class="title function_">getMergedJobDataMap</span>().<span class="title function_">get</span>(<span class="string">"scheduleJob"</span>);</span><br><span class="line">		<span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">"任务名称 = ["</span> + scheduleJob.<span class="title function_">getJobName</span>() + <span class="string">"]"</span>);</span><br><span class="line">		<span class="title class_">TaskService</span> taskService = <span class="title class_">MyApplicationContextUtil</span>.<span class="title function_">getBean</span>(<span class="string">"taskService"</span>);</span><br><span class="line">		<span class="keyword">try</span> {</span><br><span class="line">			taskService.<span class="title function_">run</span>(<span class="title class_">Long</span>.<span class="title function_">parseLong</span>(scheduleJob.<span class="title function_">getJobName</span>()));</span><br><span class="line">		} <span class="keyword">catch</span> (<span class="title class_">Exception</span> e) {</span><br><span class="line"><span class="comment">//			log.error("定时任务运行出错！",e);</span></span><br><span class="line">			<span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">"定时任务运行出错"</span>+e.<span class="title function_">getMessage</span>());</span><br><span class="line">			<span class="title class_">ScheduleJobService</span> scheduleJobService = <span class="title class_">MyApplicationContextUtil</span>.<span class="title function_">getBean</span>(<span class="string">"scheduleJobService"</span>);</span><br><span class="line">			<span class="keyword">try</span> {</span><br><span class="line"><span class="comment">//				log.debug("删除定时任务");</span></span><br><span class="line">				<span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">"删除定时任务"</span>);</span><br><span class="line">				scheduleJobService.<span class="title function_">removeJob</span>(scheduleJob);</span><br><span class="line">				<span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">"删除数据库任务记录"</span>);</span><br><span class="line">				<span class="comment">//删除数据库中记录</span></span><br><span class="line"><span class="comment">//				TaskQuartzMapper taskQuartzMapper= MyApplicationContextUtil.getBean("taskQuartzMapper");</span></span><br><span class="line"><span class="comment">//				taskQuartzMapper.delete(scheduleJob);</span></span><br><span class="line">			} <span class="keyword">catch</span> (<span class="title class_">SchedulerException</span> e1) {</span><br><span class="line"><span class="comment">//				log.error("删除定时任务出错！",e);</span></span><br><span class="line">				<span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">"删除定时任务出错！"</span>+e.<span class="title function_">getMessage</span>());</span><br><span class="line">			}</span><br><span class="line">		}</span><br><span class="line">	}</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>实体类</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package com.<span class="property">example</span>.<span class="property">demo</span>.<span class="property">utils</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.<span class="property">Data</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.<span class="property">persistence</span>.<span class="property">Table</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">Data</span></span><br><span class="line">@<span class="title class_">Table</span>(name = <span class="string">"task_quartz"</span>)</span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">ScheduleJob</span> {</span><br><span class="line">	private <span class="title class_">Long</span> id;</span><br><span class="line">	private <span class="title class_">String</span> jobId;</span><br><span class="line">	private <span class="title class_">String</span> jobName;</span><br><span class="line">	private <span class="title class_">String</span> jobGroup;</span><br><span class="line">	private <span class="title class_">String</span> jobDesc;</span><br><span class="line">	private <span class="title class_">String</span> jobStatus;</span><br><span class="line">	private <span class="title class_">String</span> cronExpression;</span><br><span class="line">}</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>启动程序，效果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2017</span>-<span class="number">09</span>-<span class="number">03</span> <span class="number">12</span>:<span class="number">58</span>:<span class="number">26.555</span>  <span class="variable constant_">INFO</span> <span class="number">4040</span> --- [  restartedMain] o.<span class="property">s</span>.<span class="property">c</span>.<span class="property">support</span>.<span class="property">DefaultLifecycleProcessor</span>  : <span class="title class_">Starting</span> beans <span class="keyword">in</span> phase <span class="number">2147483647</span></span><br><span class="line"><span class="number">2017</span>-<span class="number">09</span>-<span class="number">03</span> <span class="number">12</span>:<span class="number">58</span>:<span class="number">26.556</span>  <span class="variable constant_">INFO</span> <span class="number">4040</span> --- [  restartedMain] o.<span class="property">s</span>.<span class="property">s</span>.<span class="property">quartz</span>.<span class="property">SchedulerFactoryBean</span>        : <span class="title class_">Starting</span> <span class="title class_">Quartz</span> <span class="title class_">Scheduler</span> now</span><br><span class="line"><span class="number">2017</span>-<span class="number">09</span>-<span class="number">03</span> <span class="number">12</span>:<span class="number">58</span>:<span class="number">26.556</span>  <span class="variable constant_">INFO</span> <span class="number">4040</span> --- [  restartedMain] org.<span class="property">quartz</span>.<span class="property">core</span>.<span class="property">QuartzScheduler</span>          : <span class="title class_">Scheduler</span> scheduler_$_NON_CLUSTERED started.</span><br><span class="line"><span class="number">2017</span>-<span class="number">09</span>-<span class="number">03</span> <span class="number">12</span>:<span class="number">58</span>:<span class="number">26.626</span>  <span class="variable constant_">INFO</span> <span class="number">4040</span> --- [  restartedMain] s.<span class="property">b</span>.<span class="property">c</span>.<span class="property">e</span>.<span class="property">t</span>.<span class="property">TomcatEmbeddedServletContainer</span> : <span class="title class_">Tomcat</span> started on <span class="title function_">port</span>(s): <span class="number">8080</span> (http)</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;服务启动执行，执行加载数据等操作&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><br><span class="line">触发器执行完毕！</span><br><span class="line"><span class="number">2017</span>-<span class="number">09</span>-<span class="number">03</span> <span class="number">12</span>:<span class="number">58</span>:<span class="number">26.631</span>  <span class="variable constant_">INFO</span> <span class="number">4040</span> --- [  restartedMain] org.<span class="property">quartz</span>.<span class="property">core</span>.<span class="property">QuartzScheduler</span>          : <span class="title class_">Scheduler</span> scheduler_$_NON_CLUSTERED started.</span><br><span class="line"><span class="number">2017</span>-<span class="number">09</span>-<span class="number">03</span> <span class="number">12</span>:<span class="number">58</span>:<span class="number">26.632</span>  <span class="variable constant_">INFO</span> <span class="number">4040</span> --- [  restartedMain] com.<span class="property">example</span>.<span class="property">demo</span>.<span class="property">QuartzApplication</span>       : <span class="title class_">Started</span> <span class="title class_">QuartzApplication</span> <span class="keyword">in</span> <span class="number">4.449</span> seconds (<span class="variable constant_">JVM</span> running <span class="keyword">for</span> <span class="number">4.988</span>)</span><br><span class="line">任务成功运行</span><br><span class="line">任务名称 = [<span class="number">11</span>]</span><br><span class="line">进入定时任务－－－</span><br><span class="line">------</span><br><span class="line">本次任务执行完毕－－－</span><br><span class="line">任务成功运行</span><br><span class="line">任务名称 = [<span class="number">11</span>]</span><br><span class="line">进入定时任务－－－</span><br><span class="line">------</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>源码地址：<br><a class="link" target="_blank" rel="noopener" href="https://github.com/RowRainclb/springboot_quartz">https://github.com/RowRainclb/springboot_quartz<i class="fas fa-external-link-alt"></i></a></p>

            </div>

            
                <div class="post-copyright-info">
                    
<div class="article-copyright-info-container">
    <ul class="copyright-info-content">
        <li class="post-title">
            <span class="type">本文标题</span>：<span class="content">springboot中集成quartz任务调度</span>
        </li>
        <li class="post-author">
            <span class="type">本文作者</span>：<span class="content">Pin Young</span>
        </li>
        <li class="post-time">
            <span class="type">创建时间</span>：<span class="content">2017-05-15 17:12:21</span>
        </li>
        <li class="post-link">
            <span class="type">本文链接</span>：<span class="content">posts/58f4.html</span>
        </li>
        <li class="post-license">
            <span class="type">版权声明</span>：<span class="content">本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</span>
        </li>
    </ul>
    <div class="copy-copyright-info flex-center tooltip" data-content="复制版权信息" data-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/java/">#java</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/quartz/">#quartz</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/springboot/">#springboot</a>&nbsp;
                        </li>
                    
                </ul>
            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev" rel="prev" href="/posts/1346.html">
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                                <span class="title flex-center">
                                <span class="post-nav-title-item">npm 的一个小细节</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next" rel="next" href="/posts/cdeb.html">
                            <span class="title flex-center">
                                <span class="post-nav-title-item">redis入门</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                                <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                            </a>
                        </div>
                    
                </div>
            

            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#quartz%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">1.</span> <span class="nav-text">quartz的使用</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-number">3.</span> <span class="nav-text">使用</span></a></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            
<footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            ©
            
                <span>2014</span> -
            
            2023
            
                &nbsp;<i class="fas fa-heart icon-animate"></i>
                &nbsp;<a href="/">Pin Young</a>
            
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    访问人数&nbsp;<span id="busuanzi_value_site_uv"></span> 
                
                
                    总访问量&nbsp;<span id="busuanzi_value_site_pv"></span>
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/dstansice">零域Lite 1.3.1</a>
        </div>
        
        
        <script async defer data-website-id="b3b1feba-ef0f-4367-ba34-6a0152b8749b" src="https://analysis.0skyu.cn/umami.js"></script>
         
            <div class="icp-info info-item">
            <div class="theme-info info-item">
                <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12011002021027" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img src="https://0skyu.cn/beian.png" style="float:left;"><p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">津公网安备 12011002021027号</p></a> 
                </div>
                 <div class="theme-info info-item">
               <center> <a target="_blank" rel="nofollow" href="https://beian.miit.gov.cn">
                    津ICP备2021004482号-1
                </a></center>
                </div>
                
            </div>
        
        
            <div class="deploy-info info-item">
                
                    <a target="_blank" rel="nofollow" href="https://hao.0skyu.cn/">
                
                    本站由 <span class="tooltip" data-content="腾讯云"><img src="/images/deploy-provider/tencent_cloud.png?v=9693e72d12"></span> 提供部署服务
                
                    </a>
                
            </div>
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center" href="/atom.xml" target="_blank">
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js?v=cbd27e8569"></script>

<script src="/js/main.js?v=3ab50fd2bb"></script>

<script src="/js/header-shrink.js?v=0418df63d7"></script>

<script src="/js/back2top.js?v=139ceb0539"></script>

<script src="/js/dark-light-toggle.js?v=f21816b072"></script>





    
<script src="/js/local-search.js?v=0ce0b1d637"></script>




    
<script src="/js/code-block.js?v=63706df46d"></script>




    
<script src="/js/lazyload.js?v=f1e4b68ec3"></script>



<div class="post-scripts pjax">
    
        
<script src="/js/post-helper.js?v=34bd3800c9"></script>

        
            
<script src="/js/libs/anime.min.js?v=864a144dbb"></script>

        
        
            
<script src="/js/toc.js?v=037238356c"></script>

        
    
</div>


    
<script src="/js/libs/pjax.min.js?v=cdf1c08dca"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
