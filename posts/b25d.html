<!DOCTYPE html><html lang="zh-CN"><head><link rel="stylesheet" href="/css/bilicard.css"><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="SQL, Database, 文氏图"><meta name="description" content="用文氏图和示例来理解 SQL 里的各种 JOIN。"><meta name="author" content="Pin Young"><title>图解 SQL 里的各种 JOIN | 零域</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="/img/favicon.png"><link rel="stylesheet" href="/font/css/fontawesome.min.css"><link rel="stylesheet" href="/font/css/regular.min.css"><link rel="stylesheet" href="/font/css/solid.min.css"><link rel="stylesheet" href="/font/css/brands.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"0skyu.cn",root:"/",language:"zh-CN",path:"search.xml"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!0,init_open:!0},style:{primary_color:"#EE5A24",logo:"/img/favicon.png",favicon:"/img/favicon.png",avatar:"img/1.jpg",font_size:null,font_family:null,hover:{shadow:!0,scale:!1},first_screen:{enable:!0,header_transparent:!1,background_img:"/img/bg/333.jpg",description:"Keep writing and Keep loving.",font_color:"#f0d21a",hitokoto:!0},scroll:{progress_bar:!0,percent:!1}},local_search:{enable:!1,preload:!0},code_copy:{},code_block:{tools:{enable:!0,style:"default"},highlight_theme:"default"},side_tools:{},pjax:{enable:!0},lazyload:{enable:!0},comment:{enable:!1,use:"gitalk",valine:{appid:null,appkey:null,server_urls:null,placeholder:null},gitalk:{github_id:"DsTansice",github_admins:"DsTansice",repository:"Null-Comment",client_id:"b109b534b2268088d780",client_secret:"7808e138a1ffbcd9f02bb39cc1ee7fb41828c52f",proxy:null},twikoo:{env_id:"twikoo-0skyucn-1gkzaji32bb03146",region:null,version:"1.6.8"},waline:{server_url:null,reaction:!1,version:2}},post:{author_label:{enable:!0,auto:!0,custom_label_list:["Trainee","Engineer","Architect"]},word_count:{enable:!0,wordcount:!0,min2read:!0},img_align:"left",copyright_info:!0},version:"3.6.1"},KEEP.language_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},KEEP.language_code_block={copy:"复制代码",copied:"已复制",fold:"折叠代码块",folded:"已折叠"},KEEP.language_copy_copyright={copy:"复制版权信息",copied:"已复制",title:"原文标题",author:"原文作者",link:"原文链接"}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="零域" type="application/atom+xml">
</head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span> <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-image" href="/"><img src="/img/favicon.png"> </a><a class="logo-title" href="/">零域</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">首页</a></li><li class="menu-item"><a href="/archives">归档</a></li><li class="menu-item"><a href="/tags">标签</a></li><li class="menu-item"><a href="/categories">分类</a></li><li class="menu-item"><a href="/links">友链</a></li><li class="menu-item"><a target="_blank" rel="noopener" href="https://hao.0skyu.cn/">HAO</a></li></ul></div><div class="mobile"><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">首页</a></li><li class="drawer-menu-item flex-center"><a href="/archives">归档</a></li><li class="drawer-menu-item flex-center"><a href="/tags">标签</a></li><li class="drawer-menu-item flex-center"><a href="/categories">分类</a></li><li class="drawer-menu-item flex-center"><a href="/links">友链</a></li><li class="drawer-menu-item flex-center"><a target="_blank" rel="noopener" href="https://hao.0skyu.cn/">HAO</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">图解 SQL 里的各种 JOIN</span></div><div class="article-header"><div class="avatar"><img src="/img/1.jpg"></div><div class="info"><div class="author"><span class="name">Pin Young</span> <span class="author-label">Lv9</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-calendar-plus"></i>&nbsp; <span class="pc">2021-03-28 00:00:00</span> <span class="mobile">2021-03-28 00:00</span> </span><span class="article-update-date article-meta-item"><i class="fas fa-file-pen"></i>&nbsp; <span class="pc">2023-02-05 21:25:09</span> </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i>&nbsp;<ul><li><a href="/categories/Database/">Database</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fas fa-file-word"></i>&nbsp;<span>1.9k 字</span> </span><span class="article-min2read article-meta-item"><i class="fas fa-clock"></i>&nbsp;<span>8 分钟</span> </span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content keep-markdown-body"><p>从业以来主要在做客户端，用到的数据库都是表结构比较简单的 SQLite，以我那还给老师一大半的 SQL 水平倒也能对付。现在偶尔需要到后台的 SQL Server 里追查一些数据问题，就显得有点捉襟见肘了，特别是各种 JOIN，有时候傻傻分不清楚，于是索性弄明白并做个记录。</p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在各种问答社区里谈及 SQL 里的各种 JOIN 之间的区别时，最被广为引用的是 CodeProject 上 <a class="link" target="_blank" rel="noopener" href="https://www.codeproject.com/script/Membership/View.aspx?mid=5909363">C.L. Moffatt<i class="fas fa-external-link-alt"></i></a> 的文章 <a class="link" target="_blank" rel="noopener" href="https://www.codeproject.com/Articles/33052/Visual-Representation-of-SQL-Joins">Visual Representation of SQL Joins<i class="fas fa-external-link-alt"></i></a>，他确实讲得简单明了，使用文氏图来帮助理解，效果明显。本文将沿用他的讲解方式，稍有演绎，可以视为该文较为粗糙的中译版。</p><h2 id="约定"><a href="#约定" class="headerlink" title="约定"></a>约定</h2><p>下文将使用两个数据库表 Table_A 和 Table_B 来进行示例讲解，其结构与数据分别如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM Table_A ORDER BY PK ASC;</span><br><span class="line">+----+---------+</span><br><span class="line">| PK | Value   |</span><br><span class="line">+----+---------+</span><br><span class="line">|  1 | both ab |</span><br><span class="line">|  2 | only a  |</span><br><span class="line">+----+---------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * from Table_B ORDER BY PK ASC;</span><br><span class="line">+----+---------+</span><br><span class="line">| PK | Value   |</span><br><span class="line">+----+---------+</span><br><span class="line">|  1 | both ab |</span><br><span class="line">|  3 | only b  |</span><br><span class="line">+----+---------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>其中 PK 为 1 的记录在 Table_A 和 Table_B 中都有，2 为 Table_A 特有，3 为 Table_B 特有。</p><h2 id="常用的-JOIN"><a href="#常用的-JOIN" class="headerlink" title="常用的 JOIN"></a>常用的 JOIN</h2><h3 id="INNER-JOIN"><a href="#INNER-JOIN" class="headerlink" title="INNER JOIN"></a>INNER JOIN</h3><p>INNER JOIN 一般被译作内连接。内连接查询能将左表（表 A）和右表（表 B）中能关联起来的数据连接后返回。</p><p><strong>文氏图：</strong></p><p><img lazyload alt="image" data-src="https://raw.githubusercontent.com/mzlogin/mzlogin.github.io/master/images/posts/database/inner-join.png" alt="INNER JOIN"></p><p><strong>示例查询：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.PK <span class="keyword">AS</span> A_PK, B.PK <span class="keyword">AS</span> B_PK,</span><br><span class="line">       A.Value <span class="keyword">AS</span> A_Value, B.Value <span class="keyword">AS</span> B_Value</span><br><span class="line"><span class="keyword">FROM</span> Table_A A</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> Table_B B</span><br><span class="line"><span class="keyword">ON</span> A.PK <span class="operator">=</span> B.PK;</span><br></pre></td></tr></table></figure><p>查询结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+------+------+---------+---------+</span><br><span class="line">| A_PK | B_PK | A_Value | B_Value |</span><br><span class="line">+------+------+---------+---------+</span><br><span class="line">|    1 |    1 | both ab | both ab |</span><br><span class="line">+------+------+---------+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><p><em>注：其中 <code>A</code> 为 <code>Table_A</code> 的别名，<code>B</code> 为 <code>Table_B</code> 的别名，下同。</em></p><h3 id="LEFT-JOIN"><a href="#LEFT-JOIN" class="headerlink" title="LEFT JOIN"></a>LEFT JOIN</h3><p>LEFT JOIN 一般被译作左连接，也写作 LEFT OUTER JOIN。左连接查询会返回左表（表 A）中所有记录，不管右表（表 B）中有没有关联的数据。在右表中找到的关联数据列也会被一起返回。</p><p><strong>文氏图：</strong></p><p><img lazyload alt="image" data-src="https://raw.githubusercontent.com/mzlogin/mzlogin.github.io/master/images/posts/database/left-join.png" alt="LEFT JOIN"></p><p><strong>示例查询：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.PK <span class="keyword">AS</span> A_PK, B.PK <span class="keyword">AS</span> B_PK,</span><br><span class="line">       A.Value <span class="keyword">AS</span> A_Value, B.Value <span class="keyword">AS</span> B_Value</span><br><span class="line"><span class="keyword">FROM</span> Table_A A</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Table_B B</span><br><span class="line"><span class="keyword">ON</span> A.PK <span class="operator">=</span> B.PK;</span><br></pre></td></tr></table></figure><p>查询结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+------+------+---------+---------+</span><br><span class="line">| A_PK | B_PK | A_Value | B_Value |</span><br><span class="line">+------+------+---------+---------+</span><br><span class="line">|    1 |    1 | both ab | both ba |</span><br><span class="line">|    2 | NULL | only a  | NULL    |</span><br><span class="line">+------+------+---------+---------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="RIGHT-JOIN"><a href="#RIGHT-JOIN" class="headerlink" title="RIGHT JOIN"></a>RIGHT JOIN</h3><p>RIGHT JOIN 一般被译作右连接，也写作 RIGHT OUTER JOIN。右连接查询会返回右表（表 B）中所有记录，不管左表（表 A）中有没有关联的数据。在左表中找到的关联数据列也会被一起返回。</p><p><strong>文氏图：</strong></p><p><img lazyload alt="image" data-src="https://raw.githubusercontent.com/mzlogin/mzlogin.github.io/master/images/posts/database/right-join.png" alt="RIGHT JOIN"></p><p><strong>示例查询：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.PK <span class="keyword">AS</span> A_PK, B.PK <span class="keyword">AS</span> B_PK,</span><br><span class="line">       A.Value <span class="keyword">AS</span> A_Value, B.Value <span class="keyword">AS</span> B_Value</span><br><span class="line"><span class="keyword">FROM</span> Table_A A</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> Table_B B</span><br><span class="line"><span class="keyword">ON</span> A.PK <span class="operator">=</span> B.PK;</span><br></pre></td></tr></table></figure><p>查询结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+------+------+---------+---------+</span><br><span class="line">| A_PK | B_PK | A_Value | B_Value |</span><br><span class="line">+------+------+---------+---------+</span><br><span class="line">|    1 |    1 | both ab | both ba |</span><br><span class="line">| NULL |    3 | NULL    | only b  |</span><br><span class="line">+------+------+---------+---------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="FULL-OUTER-JOIN"><a href="#FULL-OUTER-JOIN" class="headerlink" title="FULL OUTER JOIN"></a>FULL OUTER JOIN</h3><p>FULL OUTER JOIN 一般被译作外连接、全连接，实际查询语句中可以写作 <code>FULL OUTER JOIN</code> 或 <code>FULL JOIN</code>。外连接查询能返回左右表里的所有记录，其中左右表里能关联起来的记录被连接后返回。</p><p><strong>文氏图：</strong></p><p><img lazyload alt="image" data-src="https://raw.githubusercontent.com/mzlogin/mzlogin.github.io/master/images/posts/database/full-outer-join.png" alt="FULL OUTER JOIN"></p><p><strong>示例查询：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.PK <span class="keyword">AS</span> A_PK, B.PK <span class="keyword">AS</span> B_PK,</span><br><span class="line">       A.Value <span class="keyword">AS</span> A_Value, B.Value <span class="keyword">AS</span> B_Value</span><br><span class="line"><span class="keyword">FROM</span> Table_A A</span><br><span class="line"><span class="keyword">FULL</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> Table_B B</span><br><span class="line"><span class="keyword">ON</span> A.PK <span class="operator">=</span> B.PK;</span><br></pre></td></tr></table></figure><p>查询结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;FULL OUTER JOIN Table_B B</span><br><span class="line">ON A.PK = B.PK&#x27; at line 4</span><br></pre></td></tr></table></figure><p><em>注：我当前示例使用的 MySQL 不支持 <code>FULL OUTER JOIN</code>。</em></p><p>应当返回的结果（使用 UNION 模拟）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * </span><br><span class="line">    -&gt; FROM Table_A</span><br><span class="line">    -&gt; LEFT JOIN Table_B </span><br><span class="line">    -&gt; ON Table_A.PK = Table_B.PK</span><br><span class="line">    -&gt; UNION ALL</span><br><span class="line">    -&gt; SELECT *</span><br><span class="line">    -&gt; FROM Table_A</span><br><span class="line">    -&gt; RIGHT JOIN Table_B </span><br><span class="line">    -&gt; ON Table_A.PK = Table_B.PK</span><br><span class="line">    -&gt; WHERE Table_A.PK IS NULL;</span><br><span class="line">+------+---------+------+---------+</span><br><span class="line">| PK   | Value   | PK   | Value   |</span><br><span class="line">+------+---------+------+---------+</span><br><span class="line">|    1 | both ab |    1 | both ba |</span><br><span class="line">|    2 | only a  | NULL | NULL    |</span><br><span class="line">| NULL | NULL    |    3 | only b  |</span><br><span class="line">+------+---------+------+---------+</span><br><span class="line">3 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>以上四种，就是 SQL 里常见 JOIN 的种类和概念了，看一下它们的合影：</p><p><img lazyload alt="image" data-src="https://raw.githubusercontent.com/mzlogin/mzlogin.github.io/master/images/posts/database/general-joins.png"></p><p>有没有感觉少了些什么，学数学集合时完全不止这几种情况？确实如此，继续看。</p><h2 id="延伸用法"><a href="#延伸用法" class="headerlink" title="延伸用法"></a>延伸用法</h2><h3 id="LEFT-JOIN-EXCLUDING-INNER-JOIN"><a href="#LEFT-JOIN-EXCLUDING-INNER-JOIN" class="headerlink" title="LEFT JOIN EXCLUDING INNER JOIN"></a>LEFT JOIN EXCLUDING INNER JOIN</h3><p>返回左表有但右表没有关联数据的记录集。</p><p><strong>文氏图：</strong></p><p><img lazyload alt="image" data-src="https://raw.githubusercontent.com/mzlogin/mzlogin.github.io/master/images/posts/database/left-join-excluding-inner-join.png" alt="LEFT JOIN EXCLUDING INNER JOIN"></p><p><strong>示例查询：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.PK <span class="keyword">AS</span> A_PK, B.PK <span class="keyword">AS</span> B_PK,</span><br><span class="line">       A.Value <span class="keyword">AS</span> A_Value, B.Value <span class="keyword">AS</span> B_Value</span><br><span class="line"><span class="keyword">FROM</span> Table_A A</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Table_B B</span><br><span class="line"><span class="keyword">ON</span> A.PK <span class="operator">=</span> B.PK</span><br><span class="line"><span class="keyword">WHERE</span> B.PK <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><p>查询结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+------+------+---------+---------+</span><br><span class="line">| A_PK | B_PK | A_Value | B_Value |</span><br><span class="line">+------+------+---------+---------+</span><br><span class="line">|    2 | NULL | only a  | NULL    |</span><br><span class="line">+------+------+---------+---------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure><h3 id="RIGHT-JOIN-EXCLUDING-INNER-JOIN"><a href="#RIGHT-JOIN-EXCLUDING-INNER-JOIN" class="headerlink" title="RIGHT JOIN EXCLUDING INNER JOIN"></a>RIGHT JOIN EXCLUDING INNER JOIN</h3><p>返回右表有但左表没有关联数据的记录集。</p><p><strong>文氏图：</strong></p><p><img lazyload alt="image" data-src="https://raw.githubusercontent.com/mzlogin/mzlogin.github.io/master/images/posts/database/right-join-excluding-inner-join.png" alt="RIGHT JOIN EXCLUDING INNER JOIN"></p><p><strong>示例查询：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.PK <span class="keyword">AS</span> A_PK, B.PK <span class="keyword">AS</span> B_PK,</span><br><span class="line">       A.Value <span class="keyword">AS</span> A_Value, B.Value <span class="keyword">AS</span> B_Value</span><br><span class="line"><span class="keyword">FROM</span> Table_A A</span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">JOIN</span> Table_B B</span><br><span class="line"><span class="keyword">ON</span> A.PK <span class="operator">=</span> B.PK</span><br><span class="line"><span class="keyword">WHERE</span> A.PK <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><p>查询结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+------+------+---------+---------+</span><br><span class="line">| A_PK | B_PK | A_Value | B_Value |</span><br><span class="line">+------+------+---------+---------+</span><br><span class="line">| NULL |    3 | NULL    | only b  |</span><br><span class="line">+------+------+---------+---------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h3 id="FULL-OUTER-JOIN-EXCLUDING-INNER-JOIN"><a href="#FULL-OUTER-JOIN-EXCLUDING-INNER-JOIN" class="headerlink" title="FULL OUTER JOIN EXCLUDING INNER JOIN"></a>FULL OUTER JOIN EXCLUDING INNER JOIN</h3><p>返回左表和右表里没有相互关联的记录集。</p><p><strong>文氏图：</strong></p><p><img lazyload alt="image" data-src="https://raw.githubusercontent.com/mzlogin/mzlogin.github.io/master/images/posts/database/full-outer-join-excluding-inner-join.png" alt="FULL OUTER JOIN EXCLUDING INNER JOIN"></p><p><strong>示例查询：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.PK <span class="keyword">AS</span> A_PK, B.PK <span class="keyword">AS</span> B_PK,</span><br><span class="line">       A.Value <span class="keyword">AS</span> A_Value, B.Value <span class="keyword">AS</span> B_Value</span><br><span class="line"><span class="keyword">FROM</span> Table_A A</span><br><span class="line"><span class="keyword">FULL</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> Table_B B</span><br><span class="line"><span class="keyword">ON</span> A.PK <span class="operator">=</span> B.PK</span><br><span class="line"><span class="keyword">WHERE</span> A.PK <span class="keyword">IS</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">OR</span> B.PK <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br></pre></td></tr></table></figure><p>因为使用到了 FULL OUTER JOIN，MySQL 在执行该查询时再次报错。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#x27;FULL OUTER JOIN Table_B B</span><br><span class="line">ON A.PK = B.PK</span><br><span class="line">WHERE A.PK IS NULL</span><br><span class="line">OR B.PK IS NULL&#x27; at line 4</span><br></pre></td></tr></table></figure><p>应当返回的结果（用 UNION 模拟）：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * </span><br><span class="line">    -&gt; FROM Table_A</span><br><span class="line">    -&gt; LEFT JOIN Table_B</span><br><span class="line">    -&gt; ON Table_A.PK = Table_B.PK</span><br><span class="line">    -&gt; WHERE Table_B.PK IS NULL</span><br><span class="line">    -&gt; UNION ALL</span><br><span class="line">    -&gt; SELECT *</span><br><span class="line">    -&gt; FROM Table_A</span><br><span class="line">    -&gt; RIGHT JOIN Table_B</span><br><span class="line">    -&gt; ON Table_A.PK = Table_B.PK</span><br><span class="line">    -&gt; WHERE Table_A.PK IS NULL;</span><br><span class="line">+------+--------+------+--------+</span><br><span class="line">| PK   | Value  | PK   | Value  |</span><br><span class="line">+------+--------+------+--------+</span><br><span class="line">|    2 | only a | NULL | NULL   |</span><br><span class="line">| NULL | NULL   |    3 | only b |</span><br><span class="line">+------+--------+------+--------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>以上七种用法基本上可以覆盖各种 JOIN 查询了。七种用法的全家福：</p><p><img lazyload alt="image" data-src="https://raw.githubusercontent.com/mzlogin/mzlogin.github.io/master/images/posts/database/sql-joins.png" alt="SQL JOINS"></p><p>看着它们，我仿佛回到了当年学数学，求交集并集的时代……</p><p>顺带张贴一下 <a class="link" target="_blank" rel="noopener" href="https://www.codeproject.com/script/Membership/View.aspx?mid=5909363">C.L. Moffatt<i class="fas fa-external-link-alt"></i></a> 带 SQL 语句的图片，配合学习，风味更佳：</p><p><img lazyload alt="image" data-src="https://raw.githubusercontent.com/mzlogin/mzlogin.github.io/master/images/posts/database/Visual_SQL_JOINS_orig.jpg" alt="SQL JOINS"></p><h2 id="更新：更多的-JOIN"><a href="#更新：更多的-JOIN" class="headerlink" title="更新：更多的 JOIN"></a>更新：更多的 JOIN</h2><p>除以上几种外，还有更多的 JOIN 用法，比如 CROSS JOIN（迪卡尔集）、SELF JOIN，可以参考 <a class="link" target="_blank" rel="noopener" href="https://www.w3resource.com/slides/sql-joins-slide-presentation.php">SQL JOINS Slide Presentation<i class="fas fa-external-link-alt"></i></a> 学习。</p><h3 id="CROSS-JOIN"><a href="#CROSS-JOIN" class="headerlink" title="CROSS JOIN"></a>CROSS JOIN</h3><p>返回左表与右表之间符合条件的记录的迪卡尔集。</p><p><strong>图示：</strong></p><p><img lazyload alt="image" data-src="https://raw.githubusercontent.com/mzlogin/mzlogin.github.io/master/images/posts/database/cross-join.png" alt="CORSS JOIN"></p><p><strong>示例查询：</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.PK <span class="keyword">AS</span> A_PK, B.PK <span class="keyword">AS</span> B_PK,</span><br><span class="line">       A.Value <span class="keyword">AS</span> A_Value, B.Value <span class="keyword">AS</span> B_Value</span><br><span class="line"><span class="keyword">FROM</span> Table_A A</span><br><span class="line"><span class="keyword">CROSS</span> <span class="keyword">JOIN</span> Table_B B;</span><br></pre></td></tr></table></figure><p>查询结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+------+------+---------+---------+</span><br><span class="line">| A_PK | B_PK | A_Value | B_Value |</span><br><span class="line">+------+------+---------+---------+</span><br><span class="line">|    1 |    1 | both ab | both ba |</span><br><span class="line">|    2 |    1 | only a  | both ba |</span><br><span class="line">|    1 |    3 | both ab | only b  |</span><br><span class="line">|    2 |    3 | only a  | only b  |</span><br><span class="line">+------+------+---------+---------+</span><br><span class="line">4 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>上面讲过的几种 JOIN 查询的结果都可以用 CROSS JOIN 加条件模拟出来，比如 INNER JOIN 对应 <code>CROSS JOIN ... WHERE A.PK = B.PK</code>。</p><h3 id="SELF-JOIN"><a href="#SELF-JOIN" class="headerlink" title="SELF JOIN"></a>SELF JOIN</h3><p>返回表与自己连接后符合条件的记录，一般用在表里有一个字段是用主键作为外键的情况。</p><p>比如 Table_C 的结构与数据如下：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+--------+----------+-------------+</span><br><span class="line">| EMP_ID | EMP_NAME | EMP_SUPV_ID |</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">|   1001 | Ma       |        NULL |</span><br><span class="line">|   1002 | Zhuang   |        1001 |</span><br><span class="line">+--------+----------+-------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure><p>EMP_ID 字段表示员工 ID，EMP_NAME 字段表示员工姓名，EMP_SUPV_ID 表示主管 ID。</p><p><strong>示例查询：</strong></p><p>现在我们想查询所有有主管的员工及其对应的主管 ID 和姓名，就可以用 SELF JOIN 来实现。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.EMP_ID <span class="keyword">AS</span> EMP_ID, A.EMP_NAME <span class="keyword">AS</span> EMP_NAME, </span><br><span class="line">    B.EMP_ID <span class="keyword">AS</span> EMP_SUPV_ID, B.EMP_NAME <span class="keyword">AS</span> EMP_SUPV_NAME</span><br><span class="line"><span class="keyword">FROM</span> Table_C A, Table_C B</span><br><span class="line"><span class="keyword">WHERE</span> A.EMP_SUPV_ID <span class="operator">=</span> B.EMP_ID;</span><br></pre></td></tr></table></figure><p>查询结果：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+--------+----------+-------------+---------------+</span><br><span class="line">| EMP_ID | EMP_NAME | EMP_SUPV_ID | EMP_SUPV_NAME |</span><br><span class="line">+--------+----------+-------------+---------------+</span><br><span class="line">|   1002 | Zhuang   |        1001 | Ma            |</span><br><span class="line">+--------+----------+-------------+---------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure><h2 id="补充说明"><a href="#补充说明" class="headerlink" title="补充说明"></a>补充说明</h2><ol><li><p>文中的图使用 Keynote 绘制；</p></li><li><p>个人的体会是 SQL 里的 JOIN 查询与数学里的求交集、并集等很像；</p></li><li><p>SQLite 不支持 RIGHT JOIN 和 FULL OUTER JOIN，可以使用 LEFT JOIN 和 UNION 来达到相同的效果；</p></li><li><p>MySQL 不支持 FULL OUTER JOIN，可以使用 LEFT JOIN 和 UNION 来达到相同的效果；</p></li></ol><p>假如你对我的文章感兴趣，可以关注我的微信公众号 isprogrammer 随时阅读更多内容。</p><h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul><li><a class="link" target="_blank" rel="noopener" href="https://www.codeproject.com/Articles/33052/Visual-Representation-of-SQL-Joins">Visual Representation of SQL Joins<i class="fas fa-external-link-alt"></i></a></li><li><a class="link" target="_blank" rel="noopener" href="https://stackoverflow.com/questions/4796872/how-to-do-a-full-outer-join-in-mysql">How to do a FULL OUTER JOIN in MySQL?<i class="fas fa-external-link-alt"></i></a></li><li><a class="link" target="_blank" rel="noopener" href="https://www.w3resource.com/slides/sql-joins-slide-presentation.php">SQL JOINS Slide Presentation<i class="fas fa-external-link-alt"></i></a></li><li><a class="link" target="_blank" rel="noopener" href="https://www.w3resource.com/sql/joins/perform-a-self-join.php">SQL Self Join<i class="fas fa-external-link-alt"></i></a></li></ul></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul class="copyright-info-content"><li class="post-title"><span class="type">本文标题</span>：<span class="content">图解 SQL 里的各种 JOIN</span></li><li class="post-author"><span class="type">本文作者</span>：<span class="content">Pin Young</span></li><li class="post-time"><span class="type">创建时间</span>：<span class="content">2021-03-28 00:00:00</span></li><li class="post-link"><span class="type">本文链接</span>：<span class="content">posts/b25d.html</span></li><li class="post-license"><span class="type">版权声明</span>：<span class="content">本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</span></li></ul><div class="copy-copyright-info flex-center tooltip" data-content="复制版权信息" data-offset-y="-2px"><i class="fa-solid fa-copy"></i></div></div></div><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/posts/2286.html"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">关于 Markdown 的一些奇技淫巧</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/posts/721c.html"><span class="title flex-center"><span class="post-nav-title-item">Android 源码分析开篇</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%A6%E5%AE%9A"><span class="nav-number">2.</span> <span class="nav-text">约定</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84-JOIN"><span class="nav-number">3.</span> <span class="nav-text">常用的 JOIN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#INNER-JOIN"><span class="nav-number">3.1.</span> <span class="nav-text">INNER JOIN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LEFT-JOIN"><span class="nav-number">3.2.</span> <span class="nav-text">LEFT JOIN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RIGHT-JOIN"><span class="nav-number">3.3.</span> <span class="nav-text">RIGHT JOIN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FULL-OUTER-JOIN"><span class="nav-number">3.4.</span> <span class="nav-text">FULL OUTER JOIN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">3.5.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BB%B6%E4%BC%B8%E7%94%A8%E6%B3%95"><span class="nav-number">4.</span> <span class="nav-text">延伸用法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#LEFT-JOIN-EXCLUDING-INNER-JOIN"><span class="nav-number">4.1.</span> <span class="nav-text">LEFT JOIN EXCLUDING INNER JOIN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RIGHT-JOIN-EXCLUDING-INNER-JOIN"><span class="nav-number">4.2.</span> <span class="nav-text">RIGHT JOIN EXCLUDING INNER JOIN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FULL-OUTER-JOIN-EXCLUDING-INNER-JOIN"><span class="nav-number">4.3.</span> <span class="nav-text">FULL OUTER JOIN EXCLUDING INNER JOIN</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">5.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%EF%BC%9A%E6%9B%B4%E5%A4%9A%E7%9A%84-JOIN"><span class="nav-number">6.</span> <span class="nav-text">更新：更多的 JOIN</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#CROSS-JOIN"><span class="nav-number">6.1.</span> <span class="nav-text">CROSS JOIN</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SELF-JOIN"><span class="nav-number">6.2.</span> <span class="nav-text">SELF JOIN</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A5%E5%85%85%E8%AF%B4%E6%98%8E"><span class="nav-number">7.</span> <span class="nav-text">补充说明</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">8.</span> <span class="nav-text">参考</span></a></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2014</span> - 2023 &nbsp;<i class="fas fa-heart icon-animate"></i> &nbsp;<a href="/">Pin Young</a></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item">访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp; 总访问量&nbsp;<span id="busuanzi_value_site_pv"></span></div><div class="theme-info info-item">由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/dstansice">零域Lite 1.3.1</a></div><script async defer data-website-id="b3b1feba-ef0f-4367-ba34-6a0152b8749b" src="https://analysis.0skyu.cn/umami.js"></script><div class="icp-info info-item"><div class="theme-info info-item"><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12011002021027" style="display:inline-block;text-decoration:none;height:20px;line-height:20px"><img src="https://0skyu.cn/beian.png" style="float:left"><p style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#939393">津公网安备 12011002021027号</p></a></div><div class="theme-info info-item"><center><a target="_blank" rel="nofollow" href="https://beian.miit.gov.cn">津ICP备2021004482号-1</a></center></div></div><div class="deploy-info info-item"><a target="_blank" rel="nofollow" href="https://hao.0skyu.cn/">本站由 <span class="tooltip" data-content="腾讯云"><img src="/images/deploy-provider/tencent_cloud.png"></span>提供部署服务</a></div></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item rss flex-center"><a class="flex-center" href="/atom.xml" target="_blank"><i class="fas fa-rss"></i></a></li><li class="tools-item tool-scroll-to-top flex-center"><i class="fas fa-arrow-up"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li></ul></div></div><div class="zoom-in-image-mask"><img class="zoom-in-image"></div></main><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/header-shrink.js"></script><script src="/js/back2top.js"></script><script src="/js/dark-light-toggle.js"></script><script src="/js/code-block.js"></script><script src="/js/lazyload.js"></script><div class="post-scripts pjax"><script src="/js/post-helper.js"></script><script src="/js/libs/anime.min.js"></script><script src="/js/toc.js"></script></div><script src="/js/libs/pjax.min.js"></script><script>window.addEventListener("DOMContentLoaded",()=>{window.pjax=new Pjax({selectors:["head title",".page-container",".pjax"],history:!0,debug:!1,cacheBust:!1,timeout:0,analytics:!1,currentUrlFullReload:!1,scrollRestoration:!1}),document.addEventListener("pjax:send",()=>{KEEP.utils.pjaxProgressBarStart()}),document.addEventListener("pjax:complete",()=>{KEEP.utils.pjaxProgressBarEnd(),window.pjax.executeScripts(document.querySelectorAll("script[data-pjax], .pjax script")),KEEP.refresh()})})</script></body></html>