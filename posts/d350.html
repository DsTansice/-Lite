<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="空中有零，零域，分享快乐，音乐，心得，生活，电影，代码，编程，考试，学业，零式的天空，凌空博客，原零空博客，原Tans博客，现零的小屋官方博客，计算机，音乐，电脑，编程，生活，分享"><meta name="description" content="一个技术控，爱技术，爱分享，爱音乐"><meta name="author" content="Pin Young"><title>【HTML5】Canvas 实现放大镜效果 | 零域</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="/img/favicon.png"><link rel="stylesheet" href="/font/css/fontawesome.min.css"><link rel="stylesheet" href="/font/css/regular.min.css"><link rel="stylesheet" href="/font/css/solid.min.css"><link rel="stylesheet" href="/font/css/brands.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"0skyu.cn",root:"/",language:"zh-CN",path:"search.xml"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!0,init_open:!0},style:{primary_color:"#EE5A24",logo:"/img/favicon.png",favicon:"/img/favicon.png",avatar:"img/1.jpg",font_size:null,font_family:null,hover:{shadow:!0,scale:!1},first_screen:{enable:!0,header_transparent:!1,background_img:"/img/bg/333.jpg",description:"Keep writing and Keep loving.",font_color:"#f0d21a",hitokoto:!0},scroll:{progress_bar:!0,percent:!1}},local_search:{enable:!0,preload:!0},code_copy:{},code_block:{tools:{enable:!0,style:"default"},highlight_theme:"default"},side_tools:{},pjax:{enable:!0},lazyload:{enable:!0},comment:{enable:!1,use:"gitalk",valine:{appid:null,appkey:null,server_urls:null,placeholder:null},gitalk:{github_id:"DsTansice",github_admins:"DsTansice",repository:"Null-Comment",client_id:"b109b534b2268088d780",client_secret:"7808e138a1ffbcd9f02bb39cc1ee7fb41828c52f",proxy:null},twikoo:{env_id:"twikoo-0skyucn-1gkzaji32bb03146",region:null,version:"1.6.8"},waline:{server_url:null,reaction:!1,version:2}},post:{author_label:{enable:!0,auto:!0,custom_label_list:["Trainee","Engineer","Architect"]},word_count:{enable:!0,wordcount:!0,min2read:!0},img_align:"left",copyright_info:!0},version:"3.6.1"},KEEP.language_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},KEEP.language_code_block={copy:"复制代码",copied:"已复制",fold:"折叠代码块",folded:"已折叠"},KEEP.language_copy_copyright={copy:"复制版权信息",copied:"已复制",title:"原文标题",author:"原文作者",link:"原文链接"}</script><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="零域" type="application/atom+xml">
</head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span> <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-image" href="/"><img src="/img/favicon.png"> </a><a class="logo-title" href="/">零域</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">首页</a></li><li class="menu-item"><a href="/archives">归档</a></li><li class="menu-item"><a href="/tags">标签</a></li><li class="menu-item"><a href="/categories">分类</a></li><li class="menu-item"><a href="/links">友链</a></li><li class="menu-item"><a target="_blank" rel="noopener" href="https://hao.0skyu.cn/">HAO</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">首页</a></li><li class="drawer-menu-item flex-center"><a href="/archives">归档</a></li><li class="drawer-menu-item flex-center"><a href="/tags">标签</a></li><li class="drawer-menu-item flex-center"><a href="/categories">分类</a></li><li class="drawer-menu-item flex-center"><a href="/links">友链</a></li><li class="drawer-menu-item flex-center"><a target="_blank" rel="noopener" href="https://hao.0skyu.cn/">HAO</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">【HTML5】Canvas 实现放大镜效果</span></div><div class="article-header"><div class="avatar"><img src="/img/1.jpg"></div><div class="info"><div class="author"><span class="name">Pin Young</span> <span class="author-label">Lv9</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-calendar-plus"></i>&nbsp; <span class="pc">2016-10-09 09:58:34</span> <span class="mobile">2016-10-09 09:58</span> </span><span class="article-update-date article-meta-item"><i class="fas fa-file-pen"></i>&nbsp; <span class="pc">2023-02-02 13:39:46</span> </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i>&nbsp;<ul><li><a href="/categories/HTML5/">HTML5</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i>&nbsp;<ul><li><a href="/tags/HTML5/">HTML5</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fas fa-file-word"></i>&nbsp;<span>2.5k 字</span> </span><span class="article-min2read article-meta-item"><i class="fas fa-clock"></i>&nbsp;<span>12 分钟</span> </span><span class="article-pv article-meta-item"><i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content keep-markdown-body"><h2 id="图片放大镜"><a href="#图片放大镜" class="headerlink" title="图片放大镜"></a>图片放大镜</h2><h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p><img lazyload alt="image" data-src="/images/glass/002.png"><br><a class="link" target="_blank" rel="noopener" href="http://zhangjikai.com/demo/html5-magnifying-glass/image.html">在线演示<i class="fas fa-external-link-alt"></i></a> &amp;nbsp;&amp;nbsp; <a class="link" target="_blank" rel="noopener" href="https://github.com/zhangjikai/samples/tree/master/html5-magnifying-glass">源码<i class="fas fa-external-link-alt"></i></a></p><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>首先选择图片的一块区域，然后将这块区域放大，然后再绘制到原先的图片上，保证两块区域的中心点一致, 如下图所示:<br><img lazyload alt="image" data-src="/images/glass/001.png"></p><span id="more"></span><h3 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">&quot;canvas&quot;</span> <span class="attr">width</span>=<span class="string">&quot;500&quot;</span> <span class="attr">height</span>=<span class="string">&quot;500&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;image.png&quot;</span> <span class="attr">style</span>=<span class="string">&quot;display: none&quot;</span> <span class="attr">id</span>=<span class="string">&quot;img&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>获得 canvas 和 image 对象，这里使用 <code>&lt;img&gt;</code> 标签预加载图片, 关于图片预加载可以看<a class="link" target="_blank" rel="noopener" href="http://blog.zhangjikai.com/2015/06/22/%E3%80%90HTML5%E3%80%91%E5%9B%BE%E7%89%87%E9%A2%84%E5%8A%A0%E8%BD%BD/">这里<i class="fas fa-external-link-alt"></i></a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> canvas = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> context = canvas.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line"><span class="keyword">var</span> img = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;img&quot;</span>);</span><br></pre></td></tr></table></figure><p>设置相关变量</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 图片被放大区域的中心点，也是放大镜的中心点</span></span><br><span class="line"><span class="keyword">var</span> centerPoint = &#123;&#125;;</span><br><span class="line"><span class="comment">// 图片被放大区域的半径</span></span><br><span class="line"><span class="keyword">var</span> originalRadius = <span class="number">100</span>;</span><br><span class="line"><span class="comment">// 图片被放大区域</span></span><br><span class="line"><span class="keyword">var</span> originalRectangle = &#123;&#125;;</span><br><span class="line"><span class="comment">// 放大倍数</span></span><br><span class="line"><span class="keyword">var</span> scale = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// 放大后区域</span></span><br><span class="line"><span class="keyword">var</span> scaleGlassRectangle</span><br></pre></td></tr></table></figure><h3 id="画背景图片"><a href="#画背景图片" class="headerlink" title="画背景图片"></a>画背景图片</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">drawBackGround</span>(<span class="params"></span>) &#123;</span><br><span class="line">    context.<span class="title function_">drawImage</span>(img, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="计算图片被放大的区域的范围"><a href="#计算图片被放大的区域的范围" class="headerlink" title="计算图片被放大的区域的范围"></a>计算图片被放大的区域的范围</h3><p>这里我们使用鼠标的位置作为被放大区域的中心点(放大镜随着鼠标移动而移动)，因为 canvas 在画图片的时候，需要知道左上角的坐标以及区域的宽高，所以这里我们计算区域的范围</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">calOriginalRectangle</span>(<span class="params">point</span>) &#123;</span><br><span class="line">    originalRectangle.<span class="property">x</span> = point.<span class="property">x</span> - originalRadius;</span><br><span class="line">    originalRectangle.<span class="property">y</span> = point.<span class="property">y</span> - originalRadius;</span><br><span class="line">    originalRectangle.<span class="property">width</span> = originalRadius * <span class="number">2</span>;</span><br><span class="line">    originalRectangle.<span class="property">height</span> = originalRadius * <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="绘制放大镜区域"><a href="#绘制放大镜区域" class="headerlink" title="绘制放大镜区域"></a>绘制放大镜区域</h3><h4 id="裁剪区域"><a href="#裁剪区域" class="headerlink" title="裁剪区域"></a>裁剪区域</h4><p>放大镜一般是圆形的，这里我们使用 <code>clip</code> 函数裁剪出一个圆形区域，然后在该区域中绘制放大后的图。一旦裁减了某个区域，以后所有的绘图都会被限制的这个区域里，这里我们使用 <code>save</code> 和 <code>restore</code> 方法清除裁剪区域的影响。<code>save</code> 保存当前画布的一次状态，包含 canvas 的上下文属性，例如 <code>style</code>，<code>lineWidth</code> 等，然后会将这个状态压入一个堆栈。<code>restore</code> 用来恢复上一次 save 的状态，从堆栈里弹出最顶层的状态。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">context.<span class="title function_">save</span>();</span><br><span class="line">context.<span class="title function_">beginPath</span>();</span><br><span class="line">context.<span class="title function_">arc</span>(centerPoint.<span class="property">x</span>, centerPoint.<span class="property">y</span>, originalRadius, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">false</span>);</span><br><span class="line">context.<span class="title function_">clip</span>();</span><br><span class="line">......</span><br><span class="line">context.<span class="title function_">restore</span>();</span><br></pre></td></tr></table></figure><h4 id="计算放大镜区域"><a href="#计算放大镜区域" class="headerlink" title="计算放大镜区域"></a>计算放大镜区域</h4><p>通过中心点、被放大区域的宽高以及放大倍数，获得区域的左上角坐标以及区域的宽高。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">scaleGlassRectangle = &#123;</span><br><span class="line">    <span class="attr">x</span>: centerPoint.<span class="property">x</span> - originalRectangle.<span class="property">width</span> * scale / <span class="number">2</span>,</span><br><span class="line">    <span class="attr">y</span>: centerPoint.<span class="property">y</span> - originalRectangle.<span class="property">height</span> * scale / <span class="number">2</span>,</span><br><span class="line">    <span class="attr">width</span>: originalRectangle.<span class="property">width</span> * scale,</span><br><span class="line">    <span class="attr">height</span>: originalRectangle.<span class="property">height</span> * scale</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="绘制图片"><a href="#绘制图片" class="headerlink" title="绘制图片"></a>绘制图片</h4><p>在这里我们使用 <code>context.drawImage(img,sx,sy,swidth,sheight,x,y,width,height);</code> 方法，将 canvas 自身作为一副图片，然后取被放大区域的图像，将其绘制到放大镜区域里。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">context.<span class="title function_">drawImage</span>(canvas,</span><br><span class="line">    originalRectangle.<span class="property">x</span>, originalRectangle.<span class="property">y</span>,</span><br><span class="line">    originalRectangle.<span class="property">width</span>, originalRectangle.<span class="property">height</span>,</span><br><span class="line">    scaleGlassRectangle.<span class="property">x</span>, scaleGlassRectangle.<span class="property">y</span>,</span><br><span class="line">    scaleGlassRectangle.<span class="property">width</span>, scaleGlassRectangle.<span class="property">height</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><h4 id="绘制放大边缘"><a href="#绘制放大边缘" class="headerlink" title="绘制放大边缘"></a>绘制放大边缘</h4><p><code>createRadialGradient</code> 用来绘制渐变图像</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">context.<span class="title function_">beginPath</span>();</span><br><span class="line"><span class="keyword">var</span> gradient = context.<span class="title function_">createRadialGradient</span>(</span><br><span class="line">    centerPoint.<span class="property">x</span>, centerPoint.<span class="property">y</span>, originalRadius - <span class="number">5</span>,</span><br><span class="line">    centerPoint.<span class="property">x</span>, centerPoint.<span class="property">y</span>, originalRadius);</span><br><span class="line">gradient.<span class="title function_">addColorStop</span>(<span class="number">0</span>, <span class="string">&#x27;rgba(0,0,0,0.2)&#x27;</span>);</span><br><span class="line">gradient.<span class="title function_">addColorStop</span>(<span class="number">0.80</span>, <span class="string">&#x27;silver&#x27;</span>);</span><br><span class="line">gradient.<span class="title function_">addColorStop</span>(<span class="number">0.90</span>, <span class="string">&#x27;silver&#x27;</span>);</span><br><span class="line">gradient.<span class="title function_">addColorStop</span>(<span class="number">1.0</span>, <span class="string">&#x27;rgba(150,150,150,0.9)&#x27;</span>);</span><br><span class="line"></span><br><span class="line">context.<span class="property">strokeStyle</span> = gradient;</span><br><span class="line">context.<span class="property">lineWidth</span> = <span class="number">5</span>;</span><br><span class="line">context.<span class="title function_">arc</span>(centerPoint.<span class="property">x</span>, centerPoint.<span class="property">y</span>, originalRadius, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">false</span>);</span><br><span class="line">context.<span class="title function_">stroke</span>();</span><br></pre></td></tr></table></figure><h3 id="添加鼠标事件"><a href="#添加鼠标事件" class="headerlink" title="添加鼠标事件"></a>添加鼠标事件</h3><p>为 canvas 添加鼠标移动事件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">canvas.<span class="property">onmousemove</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="转换坐标"><a href="#转换坐标" class="headerlink" title="转换坐标"></a>转换坐标</h4><p>鼠标事件获得坐标一般为屏幕的或者 window 的坐标，我们需要将其装换为 canvas 的坐标。<code>getBoundingClientRect</code> 用于获得页面中某个元素的左，上，右和下分别相对浏览器视窗的位置。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">windowToCanvas</span>(<span class="params">x, y</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> bbox = canvas.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="attr">x</span>: x - bbox.<span class="property">left</span>, <span class="attr">y</span>: y - bbox.<span class="property">top</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="修改鼠标样式"><a href="#修改鼠标样式" class="headerlink" title="修改鼠标样式"></a>修改鼠标样式</h4><p>我们可以通过 css 来修改鼠标样式</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#canvas</span> &#123;</span><br><span class="line">    <span class="attribute">display</span>: block;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid red;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">    <span class="attribute">cursor</span>: crosshair;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="图表放大镜"><a href="#图表放大镜" class="headerlink" title="图表放大镜"></a>图表放大镜</h2><p>我们可能基于 canvas 绘制一些图表或者图像，如果两个元素的坐标离得比较近，就会给元素的选择带来一些影响，例如我们画两条线，一个线的坐标是<code>(200.5, 400) -&gt; (200.5, 200)</code>，另一个线的坐标为 <code>(201.5, 400) -&gt; (201.5, 20)</code>，那么这两条线几乎就会重叠在一起，如下图所示：<br><img lazyload alt="image" data-src="/images/glass/003.png"><br>使用图表放大镜的效果<br><img lazyload alt="image" data-src="/images/glass/004.png"></p><p><a class="link" target="_blank" rel="noopener" href="http://zhangjikai.com/demo/html5-magnifying-glass/chart.html">在线演示<i class="fas fa-external-link-alt"></i></a> &amp;nbsp;&amp;nbsp; <a class="link" target="_blank" rel="noopener" href="https://github.com/zhangjikai/samples/tree/master/html5-magnifying-glass">源码<i class="fas fa-external-link-alt"></i></a></p><h3 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a>原理</h3><p>类似于地图中的图例，放大镜使用较为精确的图例，如下图所示：</p><p><img lazyload alt="image" data-src="/images/glass/005.png"></p><p>在放大镜坐标系统中，原始的区域会变大，如下图所示</p><p><img lazyload alt="image" data-src="/images/glass/006.png"></p><h3 id="绘制原始线段"><a href="#绘制原始线段" class="headerlink" title="绘制原始线段"></a>绘制原始线段</h3><p>首先创建一个线段对象</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Line</span>(<span class="params">xStart, yStart, xEnd, yEnd, index, color</span>) &#123;</span><br><span class="line">    <span class="comment">// 起点x坐标</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">xStart</span> = xStart;</span><br><span class="line">    <span class="comment">// 起点y坐标</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">yStart</span> = yStart;</span><br><span class="line">    <span class="comment">// 终点x坐标</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">xEnd</span> = xEnd;</span><br><span class="line">    <span class="comment">// 终点y坐标</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">yEnd</span> = yEnd;</span><br><span class="line">    <span class="comment">// 用来标记是哪条线段</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">index</span> = index;</span><br><span class="line">    <span class="comment">// 线段颜色</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">color</span> = color;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>初始化线段</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原始线段</span></span><br><span class="line"><span class="keyword">var</span> chartLines = <span class="keyword">new</span> <span class="title class_">Array</span>();</span><br><span class="line"><span class="comment">// 处于放大镜中的原始线段</span></span><br><span class="line"><span class="keyword">var</span> glassLines;</span><br><span class="line"><span class="comment">// 放大后的线段</span></span><br><span class="line"><span class="keyword">var</span> scaleGlassLines;</span><br><span class="line"><span class="comment">// 位于放大镜中的线段数量</span></span><br><span class="line"><span class="keyword">var</span> glassLineSize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">initLines</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> line;</span><br><span class="line">    line = <span class="keyword">new</span> <span class="title class_">Line</span>(<span class="number">200.5</span>, <span class="number">400</span>, <span class="number">200.5</span>, <span class="number">200</span>, <span class="number">0</span>, <span class="string">&quot;#888&quot;</span>);</span><br><span class="line">    chartLines.<span class="title function_">push</span>(line);</span><br><span class="line">    line = <span class="keyword">new</span> <span class="title class_">Line</span>(<span class="number">201.5</span>, <span class="number">400</span>, <span class="number">201.5</span>, <span class="number">20</span>, <span class="number">1</span>, <span class="string">&quot;#888&quot;</span>);</span><br><span class="line">    chartLines.<span class="title function_">push</span>(line);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    glassLineSize = chartLines.<span class="property">length</span>;</span><br><span class="line">    glassLines = <span class="keyword">new</span> <span class="title class_">Array</span>(glassLineSize);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; glassLineSize; i++) &#123;</span><br><span class="line">        line = <span class="keyword">new</span> <span class="title class_">Line</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, i);</span><br><span class="line">        glassLines[i] = line;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    scaleGlassLines = <span class="keyword">new</span> <span class="title class_">Array</span>(glassLineSize);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; glassLineSize; i++) &#123;</span><br><span class="line">        line = <span class="keyword">new</span> <span class="title class_">Line</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, i);</span><br><span class="line">        scaleGlassLines[i] = line;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>绘制线段</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">drawLines</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> line;</span><br><span class="line">    context.<span class="property">lineWidth</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; chartLines.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        line = chartLines[i];</span><br><span class="line">        context.<span class="title function_">beginPath</span>();</span><br><span class="line">        context.<span class="property">strokeStyle</span> = line.<span class="property">color</span>;</span><br><span class="line">        context.<span class="title function_">moveTo</span>(line.<span class="property">xStart</span>, line.<span class="property">yStart</span>);</span><br><span class="line">        context.<span class="title function_">lineTo</span>(line.<span class="property">xEnd</span>, line.<span class="property">yEnd</span>);</span><br><span class="line">        context.<span class="title function_">stroke</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="计算原始区域和放大镜区域"><a href="#计算原始区域和放大镜区域" class="headerlink" title="计算原始区域和放大镜区域"></a>计算原始区域和放大镜区域</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">calGlassRectangle</span>(<span class="params">point</span>) &#123;</span><br><span class="line">    originalRectangle.<span class="property">x</span> = point.<span class="property">x</span> - originalRadius;</span><br><span class="line">    originalRectangle.<span class="property">y</span> = point.<span class="property">y</span> - originalRadius;</span><br><span class="line">    originalRectangle.<span class="property">width</span> = originalRadius * <span class="number">2</span>;</span><br><span class="line">    originalRectangle.<span class="property">height</span> = originalRadius * <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    scaleGlassRectangle.<span class="property">width</span> = originalRectangle.<span class="property">width</span> * scale;</span><br><span class="line">    scaleGlassRectangle.<span class="property">height</span> = originalRectangle.<span class="property">height</span> * scale;</span><br><span class="line">    scaleGlassRectangle.<span class="property">x</span> = originalRectangle.<span class="property">x</span> + originalRectangle.<span class="property">width</span> / <span class="number">2</span> - scaleGlassRectangle.<span class="property">width</span> / <span class="number">2</span>;</span><br><span class="line">    scaleGlassRectangle.<span class="property">y</span> = originalRectangle.<span class="property">y</span> + originalRectangle.<span class="property">height</span> / <span class="number">2</span> - scaleGlassRectangle.<span class="property">height</span> / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将值装换为整数</span></span><br><span class="line">    scaleGlassRectangle.<span class="property">width</span> = <span class="built_in">parseInt</span>(scaleGlassRectangle.<span class="property">width</span>);</span><br><span class="line">    scaleGlassRectangle.<span class="property">height</span> = <span class="built_in">parseInt</span>(scaleGlassRectangle.<span class="property">height</span>);</span><br><span class="line">    scaleGlassRectangle.<span class="property">x</span> = <span class="built_in">parseInt</span>(scaleGlassRectangle.<span class="property">x</span>);</span><br><span class="line">    scaleGlassRectangle.<span class="property">y</span> = <span class="built_in">parseInt</span>(scaleGlassRectangle.<span class="property">y</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="计算线段在新坐标系统的位置"><a href="#计算线段在新坐标系统的位置" class="headerlink" title="计算线段在新坐标系统的位置"></a>计算线段在新坐标系统的位置</h3><p>由原理图我们知道，放大镜中使用坐标系的图例要比原始坐标系更加精确，比如原始坐标系使用 <code>1:100</code>，那么放大镜坐标系使用 <code>1:10</code>，因此我们需要重新计算线段在放大镜坐标系中的位置。同时为了简便，我们将线段的原始坐标进行了转化，减去原始区域起始的x值和y值，即将原始区域左上角的点看做为<code>(0,0)</code>。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">calScaleLines</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> xStart = originalRectangle.<span class="property">x</span>;</span><br><span class="line">    <span class="keyword">var</span> xEnd = originalRectangle.<span class="property">x</span> + originalRectangle.<span class="property">width</span>;</span><br><span class="line">    <span class="keyword">var</span> yStart = originalRectangle.<span class="property">y</span>;</span><br><span class="line">    <span class="keyword">var</span> yEnd = originalRectangle.<span class="property">y</span> + originalRectangle.<span class="property">height</span>;</span><br><span class="line">    <span class="keyword">var</span> line, gLine, sgLine;</span><br><span class="line">    <span class="keyword">var</span> glassLineIndex = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; chartLines.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        line = chartLines[i];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 判断线段是否在放大镜中</span></span><br><span class="line">        <span class="keyword">if</span> (line.<span class="property">xStart</span> &lt; xStart || line.<span class="property">xEnd</span> &gt; xEnd) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (line.<span class="property">yEnd</span> &gt; yEnd || line.<span class="property">yStart</span> &lt; yStart) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        gLine = glassLines[glassLineIndex];</span><br><span class="line">        sgLine = scaleGlassLines[glassLineIndex];</span><br><span class="line">        <span class="keyword">if</span> (line.<span class="property">yEnd</span> &gt; yEnd) &#123;</span><br><span class="line">            gLine.<span class="property">yEnd</span> = yEnd;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (line.<span class="property">yStart</span> &lt; yStart) &#123;</span><br><span class="line">            gLine.<span class="property">yStart</span> = yStart;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        gLine.<span class="property">xStart</span> = line.<span class="property">xStart</span> - xStart;</span><br><span class="line">        gLine.<span class="property">yStart</span> = line.<span class="property">yStart</span> - yStart;</span><br><span class="line">        gLine.<span class="property">xEnd</span> = line.<span class="property">xEnd</span> - xStart;</span><br><span class="line">        gLine.<span class="property">yEnd</span> = line.<span class="property">yEnd</span> - yStart;</span><br><span class="line"></span><br><span class="line">        sgLine.<span class="property">xStart</span> = <span class="built_in">parseInt</span>(gLine.<span class="property">xStart</span> * scale);</span><br><span class="line">        sgLine.<span class="property">yStart</span> = <span class="built_in">parseInt</span>(gLine.<span class="property">yStart</span> * scale);</span><br><span class="line">        sgLine.<span class="property">xEnd</span> = <span class="built_in">parseInt</span>(gLine.<span class="property">xEnd</span> * scale);</span><br><span class="line">        sgLine.<span class="property">yEnd</span> = <span class="built_in">parseInt</span>(gLine.<span class="property">yEnd</span> * scale);</span><br><span class="line">        sgLine.<span class="property">color</span> = line.<span class="property">color</span>;</span><br><span class="line">        glassLineIndex++;</span><br><span class="line">    &#125;</span><br><span class="line">    glassLineSize = glassLineIndex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="绘制放大镜中心点"><a href="#绘制放大镜中心点" class="headerlink" title="绘制放大镜中心点"></a>绘制放大镜中心点</h3><p>绘制放大镜中心的瞄准器</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">drawAnchor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    context.<span class="title function_">beginPath</span>();</span><br><span class="line">    context.<span class="property">lineWidth</span> = <span class="number">2</span>;</span><br><span class="line">    context.<span class="property">fillStyle</span> = <span class="string">&quot;#fff&quot;</span>;</span><br><span class="line">    context.<span class="property">strokeStyle</span> = <span class="string">&quot;#000&quot;</span>;</span><br><span class="line">    context.<span class="title function_">arc</span>(<span class="built_in">parseInt</span>(centerPoint.<span class="property">x</span>), <span class="built_in">parseInt</span>(centerPoint.<span class="property">y</span>), <span class="number">10</span>, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> radius = <span class="number">15</span>;</span><br><span class="line">    context.<span class="title function_">moveTo</span>(<span class="built_in">parseInt</span>(centerPoint.<span class="property">x</span> - radius), <span class="built_in">parseInt</span>(centerPoint.<span class="property">y</span>));</span><br><span class="line">    context.<span class="title function_">lineTo</span>(<span class="built_in">parseInt</span>(centerPoint.<span class="property">x</span> + radius), <span class="built_in">parseInt</span>(centerPoint.<span class="property">y</span>));</span><br><span class="line">    context.<span class="title function_">moveTo</span>(<span class="built_in">parseInt</span>(centerPoint.<span class="property">x</span>), <span class="built_in">parseInt</span>(centerPoint.<span class="property">y</span> - radius));</span><br><span class="line">    context.<span class="title function_">lineTo</span>(<span class="built_in">parseInt</span>(centerPoint.<span class="property">x</span>), <span class="built_in">parseInt</span>(centerPoint.<span class="property">y</span> + radius));</span><br><span class="line">    <span class="comment">//context.fill();</span></span><br><span class="line">    context.<span class="title function_">stroke</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="绘制放大镜"><a href="#绘制放大镜" class="headerlink" title="绘制放大镜"></a>绘制放大镜</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">drawMagnifyingGlass</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">calScaleLines</span>();</span><br><span class="line"></span><br><span class="line">    context.<span class="title function_">save</span>();</span><br><span class="line">    context.<span class="title function_">beginPath</span>();</span><br><span class="line">    context.<span class="title function_">arc</span>(centerPoint.<span class="property">x</span>, centerPoint.<span class="property">y</span>, originalRadius, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">false</span>);</span><br><span class="line">    context.<span class="title function_">clip</span>();</span><br><span class="line"></span><br><span class="line">    context.<span class="title function_">beginPath</span>();</span><br><span class="line">    context.<span class="property">fillStyle</span> = <span class="string">&quot;#fff&quot;</span>;</span><br><span class="line">    context.<span class="title function_">arc</span>(centerPoint.<span class="property">x</span>, centerPoint.<span class="property">y</span>, originalRadius, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">false</span>);</span><br><span class="line">    context.<span class="title function_">fill</span>();</span><br><span class="line"></span><br><span class="line">    context.<span class="property">lineWidth</span> = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; glassLineSize; i++) &#123;</span><br><span class="line">        context.<span class="title function_">beginPath</span>();</span><br><span class="line">        context.<span class="property">strokeStyle</span> = scaleGlassLines[i].<span class="property">color</span>;</span><br><span class="line">        context.<span class="title function_">moveTo</span>(scaleGlassRectangle.<span class="property">x</span> + scaleGlassLines[i].<span class="property">xStart</span>, scaleGlassRectangle.<span class="property">y</span> + scaleGlassLines[i].<span class="property">yStart</span>);</span><br><span class="line">        context.<span class="title function_">lineTo</span>(scaleGlassRectangle.<span class="property">x</span> + scaleGlassLines[i].<span class="property">xEnd</span>, scaleGlassRectangle.<span class="property">y</span> + scaleGlassLines[i].<span class="property">yEnd</span>);</span><br><span class="line">        context.<span class="title function_">stroke</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    context.<span class="title function_">restore</span>();</span><br><span class="line"></span><br><span class="line">    context.<span class="title function_">beginPath</span>();</span><br><span class="line">    <span class="keyword">var</span> gradient = context.<span class="title function_">createRadialGradient</span>(</span><br><span class="line">        <span class="built_in">parseInt</span>(centerPoint.<span class="property">x</span>), <span class="built_in">parseInt</span>(centerPoint.<span class="property">y</span>), originalRadius - <span class="number">5</span>,</span><br><span class="line">        <span class="built_in">parseInt</span>(centerPoint.<span class="property">x</span>), <span class="built_in">parseInt</span>(centerPoint.<span class="property">y</span>), originalRadius);</span><br><span class="line"></span><br><span class="line">    gradient.<span class="title function_">addColorStop</span>(<span class="number">0.50</span>, <span class="string">&#x27;silver&#x27;</span>);</span><br><span class="line">    gradient.<span class="title function_">addColorStop</span>(<span class="number">0.90</span>, <span class="string">&#x27;silver&#x27;</span>);</span><br><span class="line">    gradient.<span class="title function_">addColorStop</span>(<span class="number">1</span>, <span class="string">&#x27;black&#x27;</span>);</span><br><span class="line">    context.<span class="property">strokeStyle</span> = gradient;</span><br><span class="line">    context.<span class="property">lineWidth</span> = <span class="number">5</span>;</span><br><span class="line">    context.<span class="title function_">arc</span>(<span class="built_in">parseInt</span>(centerPoint.<span class="property">x</span>), <span class="built_in">parseInt</span>(centerPoint.<span class="property">y</span>), originalRadius, <span class="number">0</span>, <span class="title class_">Math</span>.<span class="property">PI</span> * <span class="number">2</span>, <span class="literal">false</span>);</span><br><span class="line">    context.<span class="title function_">stroke</span>();</span><br><span class="line"></span><br><span class="line">    <span class="title function_">drawAnchor</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="添加事件"><a href="#添加事件" class="headerlink" title="添加事件"></a>添加事件</h3><h4 id="鼠标拖动"><a href="#鼠标拖动" class="headerlink" title="鼠标拖动"></a>鼠标拖动</h4><h2 id="鼠标移动到放大镜上，然后按下鼠标左键，可以拖动放大镜，不按鼠标左键或者不在放大镜区域都不可以拖动放大镜。为了实现上面的效果，我们要实现3种事件-mousedown-mousemove-‘mouseup’-当鼠标按下时，检测是否在放大镜区域，如果在，设置放大镜可以移动。鼠标移动时更新放大镜中兴点的坐标。鼠标松开时，设置放大镜不可以被移动。-鼠标双击当移动到对应的线段上时，鼠标双击可以选择该线段，将该线段的颜色变为红色。-键盘事件因为线段离得比较近，所以使用鼠标移动很难精确的选中线段，这里使用键盘的w-a-s-d-来进行精确移动"><a href="#鼠标移动到放大镜上，然后按下鼠标左键，可以拖动放大镜，不按鼠标左键或者不在放大镜区域都不可以拖动放大镜。为了实现上面的效果，我们要实现3种事件-mousedown-mousemove-‘mouseup’-当鼠标按下时，检测是否在放大镜区域，如果在，设置放大镜可以移动。鼠标移动时更新放大镜中兴点的坐标。鼠标松开时，设置放大镜不可以被移动。-鼠标双击当移动到对应的线段上时，鼠标双击可以选择该线段，将该线段的颜色变为红色。-键盘事件因为线段离得比较近，所以使用鼠标移动很难精确的选中线段，这里使用键盘的w-a-s-d-来进行精确移动" class="headerlink" title="鼠标移动到放大镜上，然后按下鼠标左键，可以拖动放大镜，不按鼠标左键或者不在放大镜区域都不可以拖动放大镜。为了实现上面的效果，我们要实现3种事件 mousedown, mousemove, ‘mouseup’, 当鼠标按下时，检测是否在放大镜区域，如果在，设置放大镜可以移动。鼠标移动时更新放大镜中兴点的坐标。鼠标松开时，设置放大镜不可以被移动。#### 鼠标双击当移动到对应的线段上时，鼠标双击可以选择该线段，将该线段的颜色变为红色。#### 键盘事件因为线段离得比较近，所以使用鼠标移动很难精确的选中线段，这里使用键盘的w, a, s, d 来进行精确移动
   "></a>鼠标移动到放大镜上，然后按下鼠标左键，可以拖动放大镜，不按鼠标左键或者不在放大镜区域都不可以拖动放大镜。<br>为了实现上面的效果，我们要实现3种事件 <code>mousedown</code>, <code>mousemove</code>, ‘mouseup’, 当鼠标按下时，检测是否在放大镜区域，如果在，设置放大镜可以移动。鼠标移动时更新放大镜中兴点的坐标。鼠标松开时，设置放大镜不可以被移动。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">canvas.<span class="property">onmousedown</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> point = <span class="title function_">windowToCanvas</span>(e.<span class="property">clientX</span>, e.<span class="property">clientY</span>);</span><br><span class="line">    <span class="keyword">var</span> x1, x2, y1, y2, dis;</span><br><span class="line"></span><br><span class="line">    x1 = point.<span class="property">x</span>;</span><br><span class="line">    y1 = point.<span class="property">y</span>;</span><br><span class="line">    x2 = centerPoint.<span class="property">x</span>;</span><br><span class="line">    y2 = centerPoint.<span class="property">y</span>;</span><br><span class="line">    dis = <span class="title class_">Math</span>.<span class="title function_">pow</span>(x2 - x1, <span class="number">2</span>) + <span class="title class_">Math</span>.<span class="title function_">pow</span>(y2 - y1, <span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span> (dis &lt; <span class="title class_">Math</span>.<span class="title function_">pow</span>(originalRadius, <span class="number">2</span>)) &#123;</span><br><span class="line">        lastPoint.<span class="property">x</span> = point.<span class="property">x</span>;</span><br><span class="line">        lastPoint.<span class="property">y</span> = point.<span class="property">y</span>;</span><br><span class="line">        moveGlass = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">canvas.<span class="property">onmousemove</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (moveGlass) &#123;</span><br><span class="line">        <span class="keyword">var</span> xDis, yDis;</span><br><span class="line">        <span class="keyword">var</span> point = <span class="title function_">windowToCanvas</span>(e.<span class="property">clientX</span>, e.<span class="property">clientY</span>);</span><br><span class="line">        xDis = point.<span class="property">x</span> - lastPoint.<span class="property">x</span>;</span><br><span class="line">        yDis = point.<span class="property">y</span> - lastPoint.<span class="property">y</span>;</span><br><span class="line">        centerPoint.<span class="property">x</span> += xDis;</span><br><span class="line">        centerPoint.<span class="property">y</span> += yDis;</span><br><span class="line">        lastPoint.<span class="property">x</span> = point.<span class="property">x</span>;</span><br><span class="line">        lastPoint.<span class="property">y</span> = point.<span class="property">y</span>;</span><br><span class="line">        <span class="title function_">draw</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">canvas.<span class="property">onmouseup</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    moveGlass = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>#### 鼠标双击<br>当移动到对应的线段上时，鼠标双击可以选择该线段，将该线段的颜色变为红色。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">canvas.<span class="property">ondblclick</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> xStart, xEnd, yStart, yEnd;</span><br><span class="line">    <span class="keyword">var</span> clickPoint = &#123;&#125;;</span><br><span class="line">    clickPoint.<span class="property">x</span> = scaleGlassRectangle.<span class="property">x</span> + scaleGlassRectangle.<span class="property">width</span> / <span class="number">2</span>;</span><br><span class="line">    clickPoint.<span class="property">y</span> = scaleGlassRectangle.<span class="property">y</span> + scaleGlassRectangle.<span class="property">height</span> / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">var</span> index = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; scaleGlassLines.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> scaleLine = scaleGlassLines[i];</span><br><span class="line"></span><br><span class="line">        xStart = scaleGlassRectangle.<span class="property">x</span> + scaleLine.<span class="property">xStart</span> - <span class="number">3</span>;</span><br><span class="line">        xEnd = scaleGlassRectangle.<span class="property">x</span> + scaleLine.<span class="property">xStart</span> + <span class="number">3</span>;</span><br><span class="line">        yStart = scaleGlassRectangle.<span class="property">y</span> + scaleLine.<span class="property">yStart</span>;</span><br><span class="line">        yEnd = scaleGlassRectangle.<span class="property">y</span> + scaleLine.<span class="property">yEnd</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (clickPoint.<span class="property">x</span> &gt; xStart &amp;&amp; clickPoint.<span class="property">x</span> &lt; xEnd &amp;&amp; clickPoint.<span class="property">y</span> &lt; yStart &amp;&amp; clickPoint.<span class="property">y</span> &gt; yEnd) &#123;</span><br><span class="line">            scaleLine.<span class="property">color</span> = <span class="string">&quot;#f00&quot;</span>;</span><br><span class="line">            index = scaleLine.<span class="property">index</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; chartLines.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> line = chartLines[i];</span><br><span class="line">        <span class="keyword">if</span> (line.<span class="property">index</span> == index) &#123;</span><br><span class="line">            line.<span class="property">color</span> = <span class="string">&quot;#f00&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            line.<span class="property">color</span> = <span class="string">&quot;#888&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">draw</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>#### 键盘事件<br>因为线段离得比较近，所以使用鼠标移动很难精确的选中线段，这里使用键盘的<code>w</code>, <code>a</code>, <code>s</code>, <code>d</code> 来进行精确移动<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="property">onkeyup</span> = <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (e.<span class="property">key</span> == <span class="string">&#x27;w&#x27;</span>) &#123;</span><br><span class="line">        centerPoint.<span class="property">y</span> = <span class="title function_">intAdd</span>(centerPoint.<span class="property">y</span>, -<span class="number">0.2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (e.<span class="property">key</span> == <span class="string">&#x27;a&#x27;</span>) &#123;</span><br><span class="line">        centerPoint.<span class="property">x</span> = <span class="title function_">intAdd</span>(centerPoint.<span class="property">x</span>, -<span class="number">0.2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (e.<span class="property">key</span> == <span class="string">&#x27;s&#x27;</span>) &#123;</span><br><span class="line">        centerPoint.<span class="property">y</span> = <span class="title function_">intAdd</span>(centerPoint.<span class="property">y</span>, <span class="number">0.2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (e.<span class="property">key</span> == <span class="string">&#x27;d&#x27;</span>) &#123;</span><br><span class="line">        centerPoint.<span class="property">x</span> = <span class="title function_">intAdd</span>(centerPoint.<span class="property">x</span>, <span class="number">0.2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">draw</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></h2><p>** 参考资料 **<br><a class="link" target="_blank" rel="noopener" href="https://github.com/David-Geary/HTML5-MagnifyingGlass">HTML5-MagnifyingGlass<i class="fas fa-external-link-alt"></i></a></p></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul class="copyright-info-content"><li class="post-title"><span class="type">本文标题</span>：<span class="content">【HTML5】Canvas 实现放大镜效果</span></li><li class="post-author"><span class="type">本文作者</span>：<span class="content">Pin Young</span></li><li class="post-time"><span class="type">创建时间</span>：<span class="content">2016-10-09 09:58:34</span></li><li class="post-link"><span class="type">本文链接</span>：<span class="content">posts/d350.html</span></li><li class="post-license"><span class="type">版权声明</span>：<span class="content">本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</span></li></ul><div class="copy-copyright-info flex-center tooltip" data-content="复制版权信息" data-offset-y="-2px"><i class="fa-solid fa-copy"></i></div></div></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/HTML5/">#HTML5</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/posts/a69d.html"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">iOS手势与变形</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/posts/a8af.html"><span class="title flex-center"><span class="post-nav-title-item">Git学习总结</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E6%94%BE%E5%A4%A7%E9%95%9C"><span class="nav-number">1.</span> <span class="nav-text">图片放大镜</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%88%E6%9E%9C"><span class="nav-number">1.1.</span> <span class="nav-text">效果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">1.2.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">1.3.</span> <span class="nav-text">初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%BB%E8%83%8C%E6%99%AF%E5%9B%BE%E7%89%87"><span class="nav-number">1.4.</span> <span class="nav-text">画背景图片</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E5%9B%BE%E7%89%87%E8%A2%AB%E6%94%BE%E5%A4%A7%E7%9A%84%E5%8C%BA%E5%9F%9F%E7%9A%84%E8%8C%83%E5%9B%B4"><span class="nav-number">1.5.</span> <span class="nav-text">计算图片被放大的区域的范围</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E6%94%BE%E5%A4%A7%E9%95%9C%E5%8C%BA%E5%9F%9F"><span class="nav-number">1.6.</span> <span class="nav-text">绘制放大镜区域</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A3%81%E5%89%AA%E5%8C%BA%E5%9F%9F"><span class="nav-number">1.6.1.</span> <span class="nav-text">裁剪区域</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E6%94%BE%E5%A4%A7%E9%95%9C%E5%8C%BA%E5%9F%9F"><span class="nav-number">1.6.2.</span> <span class="nav-text">计算放大镜区域</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E5%9B%BE%E7%89%87"><span class="nav-number">1.6.3.</span> <span class="nav-text">绘制图片</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E6%94%BE%E5%A4%A7%E8%BE%B9%E7%BC%98"><span class="nav-number">1.6.4.</span> <span class="nav-text">绘制放大边缘</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6"><span class="nav-number">1.7.</span> <span class="nav-text">添加鼠标事件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2%E5%9D%90%E6%A0%87"><span class="nav-number">1.7.1.</span> <span class="nav-text">转换坐标</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E9%BC%A0%E6%A0%87%E6%A0%B7%E5%BC%8F"><span class="nav-number">1.7.2.</span> <span class="nav-text">修改鼠标样式</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%BE%E8%A1%A8%E6%94%BE%E5%A4%A7%E9%95%9C"><span class="nav-number">2.</span> <span class="nav-text">图表放大镜</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86-1"><span class="nav-number">2.1.</span> <span class="nav-text">原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E5%8E%9F%E5%A7%8B%E7%BA%BF%E6%AE%B5"><span class="nav-number">2.2.</span> <span class="nav-text">绘制原始线段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E5%8E%9F%E5%A7%8B%E5%8C%BA%E5%9F%9F%E5%92%8C%E6%94%BE%E5%A4%A7%E9%95%9C%E5%8C%BA%E5%9F%9F"><span class="nav-number">2.3.</span> <span class="nav-text">计算原始区域和放大镜区域</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E7%BA%BF%E6%AE%B5%E5%9C%A8%E6%96%B0%E5%9D%90%E6%A0%87%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="nav-number">2.4.</span> <span class="nav-text">计算线段在新坐标系统的位置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E6%94%BE%E5%A4%A7%E9%95%9C%E4%B8%AD%E5%BF%83%E7%82%B9"><span class="nav-number">2.5.</span> <span class="nav-text">绘制放大镜中心点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%98%E5%88%B6%E6%94%BE%E5%A4%A7%E9%95%9C"><span class="nav-number">2.6.</span> <span class="nav-text">绘制放大镜</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B7%BB%E5%8A%A0%E4%BA%8B%E4%BB%B6"><span class="nav-number">2.7.</span> <span class="nav-text">添加事件</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%BC%A0%E6%A0%87%E6%8B%96%E5%8A%A8"><span class="nav-number">2.7.1.</span> <span class="nav-text">鼠标拖动</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%BC%A0%E6%A0%87%E7%A7%BB%E5%8A%A8%E5%88%B0%E6%94%BE%E5%A4%A7%E9%95%9C%E4%B8%8A%EF%BC%8C%E7%84%B6%E5%90%8E%E6%8C%89%E4%B8%8B%E9%BC%A0%E6%A0%87%E5%B7%A6%E9%94%AE%EF%BC%8C%E5%8F%AF%E4%BB%A5%E6%8B%96%E5%8A%A8%E6%94%BE%E5%A4%A7%E9%95%9C%EF%BC%8C%E4%B8%8D%E6%8C%89%E9%BC%A0%E6%A0%87%E5%B7%A6%E9%94%AE%E6%88%96%E8%80%85%E4%B8%8D%E5%9C%A8%E6%94%BE%E5%A4%A7%E9%95%9C%E5%8C%BA%E5%9F%9F%E9%83%BD%E4%B8%8D%E5%8F%AF%E4%BB%A5%E6%8B%96%E5%8A%A8%E6%94%BE%E5%A4%A7%E9%95%9C%E3%80%82%E4%B8%BA%E4%BA%86%E5%AE%9E%E7%8E%B0%E4%B8%8A%E9%9D%A2%E7%9A%84%E6%95%88%E6%9E%9C%EF%BC%8C%E6%88%91%E4%BB%AC%E8%A6%81%E5%AE%9E%E7%8E%B03%E7%A7%8D%E4%BA%8B%E4%BB%B6-mousedown-mousemove-%E2%80%98mouseup%E2%80%99-%E5%BD%93%E9%BC%A0%E6%A0%87%E6%8C%89%E4%B8%8B%E6%97%B6%EF%BC%8C%E6%A3%80%E6%B5%8B%E6%98%AF%E5%90%A6%E5%9C%A8%E6%94%BE%E5%A4%A7%E9%95%9C%E5%8C%BA%E5%9F%9F%EF%BC%8C%E5%A6%82%E6%9E%9C%E5%9C%A8%EF%BC%8C%E8%AE%BE%E7%BD%AE%E6%94%BE%E5%A4%A7%E9%95%9C%E5%8F%AF%E4%BB%A5%E7%A7%BB%E5%8A%A8%E3%80%82%E9%BC%A0%E6%A0%87%E7%A7%BB%E5%8A%A8%E6%97%B6%E6%9B%B4%E6%96%B0%E6%94%BE%E5%A4%A7%E9%95%9C%E4%B8%AD%E5%85%B4%E7%82%B9%E7%9A%84%E5%9D%90%E6%A0%87%E3%80%82%E9%BC%A0%E6%A0%87%E6%9D%BE%E5%BC%80%E6%97%B6%EF%BC%8C%E8%AE%BE%E7%BD%AE%E6%94%BE%E5%A4%A7%E9%95%9C%E4%B8%8D%E5%8F%AF%E4%BB%A5%E8%A2%AB%E7%A7%BB%E5%8A%A8%E3%80%82-%E9%BC%A0%E6%A0%87%E5%8F%8C%E5%87%BB%E5%BD%93%E7%A7%BB%E5%8A%A8%E5%88%B0%E5%AF%B9%E5%BA%94%E7%9A%84%E7%BA%BF%E6%AE%B5%E4%B8%8A%E6%97%B6%EF%BC%8C%E9%BC%A0%E6%A0%87%E5%8F%8C%E5%87%BB%E5%8F%AF%E4%BB%A5%E9%80%89%E6%8B%A9%E8%AF%A5%E7%BA%BF%E6%AE%B5%EF%BC%8C%E5%B0%86%E8%AF%A5%E7%BA%BF%E6%AE%B5%E7%9A%84%E9%A2%9C%E8%89%B2%E5%8F%98%E4%B8%BA%E7%BA%A2%E8%89%B2%E3%80%82-%E9%94%AE%E7%9B%98%E4%BA%8B%E4%BB%B6%E5%9B%A0%E4%B8%BA%E7%BA%BF%E6%AE%B5%E7%A6%BB%E5%BE%97%E6%AF%94%E8%BE%83%E8%BF%91%EF%BC%8C%E6%89%80%E4%BB%A5%E4%BD%BF%E7%94%A8%E9%BC%A0%E6%A0%87%E7%A7%BB%E5%8A%A8%E5%BE%88%E9%9A%BE%E7%B2%BE%E7%A1%AE%E7%9A%84%E9%80%89%E4%B8%AD%E7%BA%BF%E6%AE%B5%EF%BC%8C%E8%BF%99%E9%87%8C%E4%BD%BF%E7%94%A8%E9%94%AE%E7%9B%98%E7%9A%84w-a-s-d-%E6%9D%A5%E8%BF%9B%E8%A1%8C%E7%B2%BE%E7%A1%AE%E7%A7%BB%E5%8A%A8"><span class="nav-number">3.</span> <span class="nav-text">鼠标移动到放大镜上，然后按下鼠标左键，可以拖动放大镜，不按鼠标左键或者不在放大镜区域都不可以拖动放大镜。为了实现上面的效果，我们要实现3种事件 mousedown, mousemove, ‘mouseup’, 当鼠标按下时，检测是否在放大镜区域，如果在，设置放大镜可以移动。鼠标移动时更新放大镜中兴点的坐标。鼠标松开时，设置放大镜不可以被移动。123456789101112131415161718192021222324252627282930313233canvas.onmousedown &#x3D; function (e) { var point &#x3D; windowToCanvas(e.clientX, e.clientY); var x1, x2, y1, y2, dis; x1 &#x3D; point.x; y1 &#x3D; point.y; x2 &#x3D; centerPoint.x; y2 &#x3D; centerPoint.y; dis &#x3D; Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2); if (dis &lt; Math.pow(originalRadius, 2)) { lastPoint.x &#x3D; point.x; lastPoint.y &#x3D; point.y; moveGlass &#x3D; true; }}canvas.onmousemove &#x3D; function (e) { if (moveGlass) { var xDis, yDis; var point &#x3D; windowToCanvas(e.clientX, e.clientY); xDis &#x3D; point.x - lastPoint.x; yDis &#x3D; point.y - lastPoint.y; centerPoint.x +&#x3D; xDis; centerPoint.y +&#x3D; yDis; lastPoint.x &#x3D; point.x; lastPoint.y &#x3D; point.y; draw(); }}canvas.onmouseup &#x3D; function (e) { moveGlass &#x3D; false;}#### 鼠标双击当移动到对应的线段上时，鼠标双击可以选择该线段，将该线段的颜色变为红色。123456789101112131415161718192021222324252627282930313233canvas.ondblclick &#x3D; function (e) { var xStart, xEnd, yStart, yEnd; var clickPoint &#x3D; {}; clickPoint.x &#x3D; scaleGlassRectangle.x + scaleGlassRectangle.width &#x2F; 2; clickPoint.y &#x3D; scaleGlassRectangle.y + scaleGlassRectangle.height &#x2F; 2; var index &#x3D; -1; for (var i &#x3D; 0; i &lt; scaleGlassLines.length; i++) { var scaleLine &#x3D; scaleGlassLines[i]; xStart &#x3D; scaleGlassRectangle.x + scaleLine.xStart - 3; xEnd &#x3D; scaleGlassRectangle.x + scaleLine.xStart + 3; yStart &#x3D; scaleGlassRectangle.y + scaleLine.yStart; yEnd &#x3D; scaleGlassRectangle.y + scaleLine.yEnd; if (clickPoint.x &gt; xStart &amp;&amp; clickPoint.x &lt; xEnd &amp;&amp; clickPoint.y &lt; yStart &amp;&amp; clickPoint.y &gt; yEnd) { scaleLine.color &#x3D; &quot;#f00&quot;; index &#x3D; scaleLine.index; break; } } for (var i &#x3D; 0; i &lt; chartLines.length; i++) { var line &#x3D; chartLines[i]; if (line.index &#x3D;&#x3D; index) { line.color &#x3D; &quot;#f00&quot;; } else { line.color &#x3D; &quot;#888&quot;; } } draw();}#### 键盘事件因为线段离得比较近，所以使用鼠标移动很难精确的选中线段，这里使用键盘的w, a, s, d 来进行精确移动123456789101112131415document.onkeyup &#x3D; function (e) { if (e.key &#x3D;&#x3D; &#39;w&#39;) { centerPoint.y &#x3D; intAdd(centerPoint.y, -0.2); } if (e.key &#x3D;&#x3D; &#39;a&#39;) { centerPoint.x &#x3D; intAdd(centerPoint.x, -0.2); } if (e.key &#x3D;&#x3D; &#39;s&#39;) { centerPoint.y &#x3D; intAdd(centerPoint.y, 0.2); } if (e.key &#x3D;&#x3D; &#39;d&#39;) { centerPoint.x &#x3D; intAdd(centerPoint.x, 0.2); } draw();}</span></a></li></ol></div></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2014</span> - 2023 &nbsp;<i class="fas fa-heart icon-animate"></i> &nbsp;<a href="/">Pin Young</a></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="website-count info-item">访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp; 总访问量&nbsp;<span id="busuanzi_value_site_pv"></span></div><div class="theme-info info-item">由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/dstansice">零域Lite 1.1</a></div><script async defer data-website-id="b3b1feba-ef0f-4367-ba34-6a0152b8749b" src="https://analysis.0skyu.cn/umami.js"></script><div class="icp-info info-item"><div class="theme-info info-item"><a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12011002021027" style="display:inline-block;text-decoration:none;height:20px;line-height:20px"><img src="https://0skyu.cn/beian.png" style="float:left"><p style="float:left;height:20px;line-height:20px;margin:0 0 0 5px;color:#939393">津公网安备 12011002021027号</p></a></div><div class="theme-info info-item"><center><a target="_blank" rel="nofollow" href="https://beian.miit.gov.cn">津ICP备2021004482号-1</a></center></div></div></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item flex-center toggle-show-toc"><i class="fas fa-list"></i></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item rss flex-center"><a class="flex-center" href="/atom.xml" target="_blank"><i class="fas fa-rss"></i></a></li><li class="tools-item tool-scroll-to-top flex-center"><i class="fas fa-arrow-up"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li></ul></div></div><div class="zoom-in-image-mask"><img class="zoom-in-image"></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="close-popup-btn"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/header-shrink.js"></script><script src="/js/back2top.js"></script><script src="/js/dark-light-toggle.js"></script><script src="/js/local-search.js"></script><script src="/js/code-block.js"></script><script src="/js/lazyload.js"></script><div class="post-scripts pjax"><script src="/js/post-helper.js"></script><script src="/js/libs/anime.min.js"></script><script src="/js/toc.js"></script></div><script src="/js/libs/pjax.min.js"></script><script>window.addEventListener("DOMContentLoaded",()=>{window.pjax=new Pjax({selectors:["head title",".page-container",".pjax"],history:!0,debug:!1,cacheBust:!1,timeout:0,analytics:!1,currentUrlFullReload:!1,scrollRestoration:!1}),document.addEventListener("pjax:send",()=>{KEEP.utils.pjaxProgressBarStart()}),document.addEventListener("pjax:complete",()=>{KEEP.utils.pjaxProgressBarEnd(),window.pjax.executeScripts(document.querySelectorAll("script[data-pjax], .pjax script")),KEEP.refresh()})})</script></body></html>