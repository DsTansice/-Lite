<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="空中有零，零域，分享快乐，音乐，心得，生活，电影，代码，编程，考试，学业，零式的天空，凌空博客，原零空博客，原Tans博客，现零的小屋官方博客，计算机，音乐，电脑，编程，生活，分享">
    <meta name="description" content="一个技术控，爱技术，爱分享，爱音乐">
    <meta name="author" content="Pin Young">
    
    <title>
        
            【C】文件操作(二) |
        
        零域
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/img/favicon.png">
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"0skyu.cn","root":"/","language":"zh-CN","path":"search.xml"}
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#EE5A24","logo":"/img/favicon.png","favicon":"/img/favicon.png","avatar":"img/1.jpg","font_size":null,"font_family":null,"hover":{"shadow":true,"scale":false},"first_screen":{"enable":true,"header_transparent":false,"background_img":"/img/bg/333.jpg","description":"Keep writing and Keep loving.","font_color":"#f0d21a","hitokoto":true},"scroll":{"progress_bar":true,"percent":false}},"local_search":{"enable":true,"preload":true},"code_copy":{},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"side_tools":{},"pjax":{"enable":true},"lazyload":{"enable":true},"comment":{"enable":false,"use":"gitalk","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":"DsTansice","github_admins":"DsTansice","repository":"Null-Comment","client_id":"b109b534b2268088d780","client_secret":"7808e138a1ffbcd9f02bb39cc1ee7fb41828c52f","proxy":null},"twikoo":{"env_id":"twikoo-0skyucn-1gkzaji32bb03146","region":null,"version":"1.6.8"},"waline":{"server_url":null,"reaction":false,"version":2}},"post":{"author_label":{"enable":true,"auto":true,"custom_label_list":["Trainee","Engineer","Architect"]},"word_count":{"enable":true,"wordcount":true,"min2read":true},"img_align":"left","copyright_info":true},"version":"3.6.1"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="零域" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/img/favicon.png">
                </a>
            
            <a class="logo-title" href="/">
               零域
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                友链
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               target="_blank" rel="noopener" href="https://hao.0skyu.cn/"
                            >
                                HAO
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links">友链</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       target="_blank" rel="noopener" href="https://hao.0skyu.cn/">HAO</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            <div class="article-title">
                <span class="title-hover-animation">【C】文件操作(二)</span>
            </div>

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/img/1.jpg">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">Pin Young</span>
                            
                                <span class="author-label">Lv9</span>
                            
                        </div>
                        <div class="meta-info">
                            
<div class="article-meta-info">
    <span class="article-date article-meta-item">
        
            <i class="fa-regular fa-calendar-plus"></i>&nbsp;
        
        <span class="pc">2016-03-04 18:45:21</span>
        <span class="mobile">2016-03-04 18:45</span>
    </span>
    
        <span class="article-update-date article-meta-item">
        <i class="fas fa-file-pen"></i>&nbsp;
        <span class="pc">2023-02-02 13:39:45</span>
    </span>
    
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/C/">C</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/C/">C</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>2.9k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>12 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content keep-markdown-body">
                

                <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>这里主要记录一下C对二进制的读写操作, 包括随机读取文件和写入文件</p>
<h2 id="fseek-和-ftell"><a href="#fseek-和-ftell" class="headerlink" title="fseek 和 ftell"></a>fseek 和 ftell</h2><p><strong>fseek</strong><br>fseek主要用来移动文件指针, 它允许用户像对待数组那样对待一个文件, 可以直接将文件指针移动到任意字节处, 下面是它的函数原型:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fseek</span> <span class="params">( FILE * stream, <span class="type">long</span> <span class="type">int</span> offset, <span class="type">int</span> origin )</span>;</span><br></pre></td></tr></table></figure>
<p>下面是个参数的含义</p>
<ul>
<li>stream - 打开的文件指针</li>
<li>offset - 偏移量, 表示从起始点开始要移动的距离(起始点的选择由origin指定), 可以为正(向前移)、负(往回移), 也可以为零(保持不动).</li>
<li>origin - 用来指定起始点的模式, 可以使用下面定义的几个模式常量:<ol>
<li>SEEK_SET : 以文件开始位置作为起始点</li>
<li>SEEK_CUR : 以文件指针当前所在的位置作为起始点</li>
<li>SEEK_END : 以文件结尾作为起始点</li>
</ol>
</li>
</ul>
<span id="more"></span>
<p>下面是一些使用示例, 其中fp是一个文件指针</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fseek(fp, <span class="number">0L</span>, SEEK_SET)  <span class="comment">// 移动到文件开头</span></span><br><span class="line">fseek(fp, <span class="number">10L</span>, SEEK_SET)  <span class="comment">// 移动到文件的第10个字节</span></span><br><span class="line">fseek(fp, <span class="number">2L</span>, SEEK_CUR)  <span class="comment">// 从文件的当前位置向前移动两个字节</span></span><br><span class="line">fssek(fp, <span class="number">0L</span>, SEEK_END)  <span class="comment">// 移动到文件的结尾处</span></span><br><span class="line">fseek(fp, <span class="number">-10L</span>, SEEK_END)  <span class="comment">// 从文件结尾处退回10个字节</span></span><br></pre></td></tr></table></figure>
<p>如果函数执行正常, 那么返回值为0, 如果有错误, 则返回值为-1.<br><strong>ftell</strong><br>ftell函数用来获得当前文件指针的位置, 它返回当前文件指针距离文件开始处的字节数目, 函数原型如下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="type">int</span> <span class="title function_">ftell</span> <span class="params">( FILE * stream )</span>;</span><br></pre></td></tr></table></figure>
<p>如果函数执行失败会返回-1,</p>
<p>下面是一个使用示例, 接合fseek和ftell用来获得文件的大小</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="title function_">file_size</span><span class="params">(<span class="type">char</span> *fileName)</span> &#123;</span><br><span class="line">    <span class="type">long</span> size;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    <span class="keyword">if</span>((fp = fopen(fileName, <span class="string">&quot;rb&quot;</span>)) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;can&#x27;t open file %s\n&quot;</span>, fileName);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    fseek (fp, <span class="number">0</span> , SEEK_END);</span><br><span class="line">    size = ftell(fp);</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> mb;</span><br><span class="line">    mb = size * <span class="number">1.0</span> / <span class="number">1024</span> / <span class="number">1024</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;file size is %ldB and %.2fMB \n&quot;</span>, size, mb); </span><br><span class="line">    fclose(fp);</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="fwrite"><a href="#fwrite" class="headerlink" title="fwrite"></a>fwrite</h2><blockquote>
<p>Writes an array of <strong>count</strong> elements, each one with a size of <strong>size</strong> bytes, from the block of memory pointed by <strong>ptr</strong> to the current position in the <strong>stream</strong>.</p>
</blockquote>
<p>以二进制的形式将数据块写入文件, 函数原型为:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> <span class="title function_">fwrite</span> <span class="params">( <span class="type">const</span> <span class="type">void</span> * ptr, <span class="type">size_t</span> size, <span class="type">size_t</span> count, FILE * stream )</span>;</span><br></pre></td></tr></table></figure>
<p>下面是参数意义:</p>
<ul>
<li>ptr - 要写入的内存数据地址</li>
<li>size - 单个数据块的大小</li>
<li>count - 写入的数据块的数量</li>
<li>stream - 写入的目标文件</li>
</ul>
<p>如果写入成功, 会返回写入的数据块的数量, 即count, 如果返回值不等于count, 说明程序运行出现了错误.<br>下面是一个使用示例:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">file_fwrite</span><span class="params">(<span class="type">char</span> *fileName)</span> &#123;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    <span class="keyword">if</span>((fp = fopen(fileName, <span class="string">&quot;w+b&quot;</span>)) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;can&#x27;t open file %s\n&quot;</span>, fileName);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">20</span>, i;</span><br><span class="line">    <span class="type">int</span> *buffer;</span><br><span class="line">    buffer = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>) * count);</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">        buffer[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="type">long</span> success_num = <span class="number">0</span>;</span><br><span class="line">    success_num = fwrite(buffer, <span class="keyword">sizeof</span>(<span class="type">int</span>) , count, fp);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;success_num is %ld\n&quot;</span>, success_num);</span><br><span class="line"></span><br><span class="line">    fclose(fp);</span><br><span class="line">    <span class="built_in">free</span>(buffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>下面是写入的内容</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0000 0000 0100 0000 0200 0000 0300 0000</span><br><span class="line">0400 0000 0500 0000 0600 0000 0700 0000</span><br><span class="line">0800 0000 0900 0000 0a00 0000 0b00 0000</span><br><span class="line">0c00 0000 0d00 0000 0e00 0000 0f00 0000</span><br><span class="line">1000 0000 1100 0000 1200 0000 1300 0000</span><br></pre></td></tr></table></figure>
<p>上面是以16进制的形式进行显示, 即一个数字为4位, 一个int值占32位(4个字节),  在上面的内容中, 8个数字为1个int, 如 <code>0000 0000</code>为第一个int值, 即0, <code>0100 0000</code>为第二个int值, 即1. 这里需要说明的是在写入时是字节作为一个基本单位的, 并且低位字节是先写入的, 如<code>0100 0000</code>, 其中<code>01</code>就是int的最低位的字节. 我们来看这个例子, 如果写入文件之后的值为<code>1234 5678</code>, 那么其原先的值就是<code>0x78563412</code></p>
<h2 id="fread"><a href="#fread" class="headerlink" title="fread"></a>fread</h2><blockquote>
<p>Reads an array of <strong>count</strong> elements, each one with a size of <strong>size</strong> bytes, from the <strong>stream</strong> and stores them in the block of memory specified by <strong>ptr</strong>.</p>
</blockquote>
<p>以二进制的形式将数据块读入内存, 下面是函数原型:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> <span class="title function_">fread</span> <span class="params">( <span class="type">void</span> * ptr, <span class="type">size_t</span> size, <span class="type">size_t</span> count, FILE * stream )</span>;</span><br></pre></td></tr></table></figure>
<p>下面是参数含义</p>
<ul>
<li>ptr - 读入文件数据的内存地址</li>
<li>size - 单个数据块的大小</li>
<li>count - 数据块的数量</li>
<li>stream - 读取的文件</li>
</ul>
<p>如果读入成功, 会返回读入的数据块的数量. 下面是一个使用示例:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">file_fread</span><span class="params">(<span class="type">char</span> *fileName)</span> &#123;</span><br><span class="line">    <span class="type">long</span> count;</span><br><span class="line">    <span class="type">int</span> *buffer;</span><br><span class="line">    FILE *fp;</span><br><span class="line">    <span class="keyword">if</span>((fp = fopen(fileName, <span class="string">&quot;rb&quot;</span>)) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;can&#x27;t open file %s\n&quot;</span>, fileName);</span><br><span class="line">        <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">    &#125;</span><br><span class="line">    fseek (fp, <span class="number">0</span> , SEEK_END);</span><br><span class="line">    count = ftell(fp);</span><br><span class="line">    rewind(fp);</span><br><span class="line">    buffer =(<span class="type">int</span> *) <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>) * count);</span><br><span class="line"></span><br><span class="line">    fread(buffer, <span class="keyword">sizeof</span>(<span class="type">int</span>), count / <span class="keyword">sizeof</span>(<span class="type">int</span>), fp);</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; count/ <span class="keyword">sizeof</span>(<span class="type">int</span>); i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, buffer[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(fp);</span><br><span class="line">    <span class="built_in">free</span>(buffer);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="rewind"><a href="#rewind" class="headerlink" title="rewind"></a>rewind</h2><blockquote>
<p>Sets the position indicator associated with stream to the beginning of the file.</p>
</blockquote>
<p>重置文件指针到文件开头位置, 下面是函数原型:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">rewind</span> <span class="params">( FILE * stream )</span>;</span><br></pre></td></tr></table></figure>
<h2 id="setbuf-和-setvbuf"><a href="#setbuf-和-setvbuf" class="headerlink" title="setbuf 和 setvbuf"></a>setbuf 和 setvbuf</h2><p>当打开一个文件后, 系统会自动为该文件流分配一个缓冲区, 其大小为<code>BUFSIZ</code>, 我们可以通过打印<code>BUFSIZ</code>来获得默认的缓冲区大小. 如果想自定义缓冲区, 可以使用setbuf和setvbuf函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>, BUFSIZ);</span><br></pre></td></tr></table></figure>
<p><strong>setbuf</strong></p>
<blockquote>
<p>Specifies the buffer to be used by the stream for I&#x2F;O operations, which becomes a fully buffered stream. Or, alternatively, if buffer is a null pointer, buffering is disabled for the stream, which becomes an unbuffered stream.</p>
</blockquote>
<p>为文件流指定一个缓冲区, 函数原型为</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">setbuf</span> <span class="params">( FILE * stream, <span class="type">char</span> * buffer )</span>;</span><br></pre></td></tr></table></figure>
<p>buffer表示指定的缓冲区, 需要注意的一点是, 这里缓冲区的大小仍然为<code>BUFSIZ</code>, 只不过是缓冲区的位置发生了改变, 因此buffer的大小应该大于或者等于<code>BUFSIZ</code>.  该函数应该在文件刚被打开时调用, 不能在进行了读写操作之后再调用. 如果buffer的为NULL, 就表示禁用缓冲区. 下面是一个使用示例:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span> <span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buffer[BUFSIZ];</span><br><span class="line">  FILE *pFile1, *pFile2;</span><br><span class="line"></span><br><span class="line">  pFile1=fopen (<span class="string">&quot;myfile1.txt&quot;</span>,<span class="string">&quot;w&quot;</span>);</span><br><span class="line">  pFile2=fopen (<span class="string">&quot;myfile2.txt&quot;</span>,<span class="string">&quot;a&quot;</span>);</span><br><span class="line"></span><br><span class="line">  setbuf ( pFile1 , buffer );</span><br><span class="line">  <span class="built_in">fputs</span> (<span class="string">&quot;This is sent to a buffered stream&quot;</span>,pFile1);</span><br><span class="line">  fflush (pFile1);</span><br><span class="line"></span><br><span class="line">  setbuf ( pFile2 , <span class="literal">NULL</span> );</span><br><span class="line">  <span class="built_in">fputs</span> (<span class="string">&quot;This is sent to an unbuffered stream&quot;</span>,pFile2);</span><br><span class="line"></span><br><span class="line">  fclose (pFile1);</span><br><span class="line">  fclose (pFile2);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>setvbuf</strong></p>
<blockquote>
<p>Specifies a buffer for stream. The function allows to specify the mode and size of the buffer (in bytes).</p>
</blockquote>
<p>为文件指定一个缓冲区, 同时可以指定缓冲区的类型和大小, 下面是函数原型:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">setvbuf</span> <span class="params">( FILE * stream, <span class="type">char</span> * buffer, <span class="type">int</span> mode, <span class="type">size_t</span> size )</span>;</span><br></pre></td></tr></table></figure>
<p>其中 stream表示操作的文件, buffer为指定的缓冲区首地址, 如果缓冲区为NULL, 系统会自动创建一个大小为size的缓冲区, mode为缓冲区的类别, size为缓冲区的大小, 其中mode的值可以为下面几个:</p>
<ul>
<li><p><strong>_IOFBF</strong> - 全缓冲(Full buffering), 当缓冲区满时才执行真正的I&#x2F;O操作, 例如对磁盘文件的读写. </p>
<blockquote>
<p> On output, data is written once the buffer is full (or flushed). On Input, the buffer is filled when an input operation is requested and the buffer is empty.</p>
</blockquote>
</li>
<li><p><strong>_IOLBF</strong> - 行缓冲(Line buffering), 在输入和输出时遇到换行符时才进行真正的I&#x2F;O操作, 例如标准输入(stdin)和标准输出(stdout). </p>
<blockquote>
<p>On output, data is written when a newline character is inserted into the stream or when the buffer is full (or flushed), whatever happens first. On Input, the buffer is filled up to the next newline character when an input operation is requested and the buffer is empty. </p>
</blockquote>
</li>
<li><p><strong>_IONBF</strong> - 无缓冲(No buffering), 在这种情况下buffer和size参数会被忽略.</p>
</li>
</ul>
<p>其实setbuf将相当于调用了setvbuf</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setvbuf(stream, buf, buf ? _IOFBF : _IONBF, BUFSIZE)</span><br></pre></td></tr></table></figure>
<p>下面是一个使用示例:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span> <span class="params">()</span>&#123;</span><br><span class="line">  FILE *pFile;</span><br><span class="line">  pFile=fopen (<span class="string">&quot;myfile.txt&quot;</span>,<span class="string">&quot;w&quot;</span>);</span><br><span class="line">  setvbuf ( pFile , <span class="literal">NULL</span> , _IOFBF , <span class="number">1024</span> );</span><br><span class="line"></span><br><span class="line">  <span class="comment">// File operations here</span></span><br><span class="line"></span><br><span class="line">  fclose (pFile);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="fflush"><a href="#fflush" class="headerlink" title="fflush"></a>fflush</h2><p>对于输入输出流, 下列情况会自动刷新缓冲区</p>
<ul>
<li>当进行输出(output)操作时, 输出缓冲区满了</li>
<li>当流(stream)被关闭</li>
<li>当程序调用exit方法终止</li>
<li>当缓冲区为行缓冲区时, 一个换行符(newline)被写入</li>
<li>Whenever an input operation on any stream actually reads data from its file.</li>
</ul>
<p>对于一个输出流, 可以调用fflush进行显示的刷新缓冲区, 即将缓冲区的内容写入到文件中, 但是对于一个输入流使用fflush函数的效果没有定义. 下面是函数原型:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">fflush</span> <span class="params">( FILE * stream )</span>;</span><br></pre></td></tr></table></figure>
<p>如果stream为NULL, 那么所有的缓冲区都将被刷新.</p>
<h2 id="stat"><a href="#stat" class="headerlink" title="stat"></a>stat</h2><p>stat函数主要用于获取文件状态, 函数原型为</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">stat</span> <span class="params">(<span class="type">const</span> <span class="type">char</span> *filename, <span class="keyword">struct</span> stat *buf)</span></span><br></pre></td></tr></table></figure>
<p>下面是struct stat的定义:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">stat</span> &#123;</span></span><br><span class="line">    <span class="comment">//device 文件的设备编号</span></span><br><span class="line">    <span class="type">dev_t</span> st_dev;   </span><br><span class="line">    <span class="comment">//inode 文件的i-node</span></span><br><span class="line">    <span class="type">ino_t</span> st_ino;   </span><br><span class="line">    <span class="comment">//protection 文件的类型和存取的权限</span></span><br><span class="line">    <span class="type">mode_t</span> st_mode;  </span><br><span class="line">    <span class="comment">//number of hard links 连到该文件的硬连接数目, 刚建立的文件值为1.</span></span><br><span class="line">    <span class="type">nlink_t</span> st_nlink;  </span><br><span class="line">    <span class="comment">//user ID of owner 文件所有者的用户识别码</span></span><br><span class="line">    <span class="type">uid_t</span> st_uid;  </span><br><span class="line">    <span class="comment">//group ID of owner 文件所有者的组识别码</span></span><br><span class="line">    <span class="type">gid_t</span> st_gid;  </span><br><span class="line">    <span class="comment">//device type 若此文件为装置设备文件, 则为其设备编号</span></span><br><span class="line">    <span class="type">dev_t</span> st_rdev;  </span><br><span class="line">    <span class="comment">//total size, in bytes 文件大小, 以字节计算</span></span><br><span class="line">    <span class="type">off_t</span> st_size;  </span><br><span class="line">    <span class="comment">//blocksize for filesystem I/O 文件系统的I/O 缓冲区大小.</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> st_blksize;  </span><br><span class="line">    <span class="comment">//number of blocks allocated 占用文件区块的个数, 每一区块大小为512 个字节.</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">long</span> st_blocks; </span><br><span class="line">    <span class="comment">//time of lastaccess 文件最近一次被存取或被执行的时间, 一般只有在用mknod、utime、read、write 与tructate 时改变.</span></span><br><span class="line">    <span class="type">time_t</span> st_atime;  </span><br><span class="line">    <span class="comment">//time of last modification 文件最后一次被修改的时间, 一般只有在用mknod、utime 和write 时才会改变</span></span><br><span class="line">    <span class="type">time_t</span> st_mtime;  </span><br><span class="line">    <span class="comment">//time of last change i-node 最近一次被更改的时间, 此参数会在文件所有者、组、权限被更改时更新</span></span><br><span class="line">    <span class="type">time_t</span> st_ctime;  </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>其中st_mode定义了以下数种情况</p>
<ol>
<li><strong>S_IFMT</strong> - 0170000 文件类型的位遮罩</li>
<li><strong>S_IFSOCK</strong> - 0140000 scoket</li>
<li><strong>S_IFLNK</strong> - 0120000 符号连接</li>
<li><strong>S_IFREG</strong> - 0100000 一般文件</li>
<li><strong>S_IFBLK</strong> - 0060000 区块装置</li>
<li><strong>S_IFDIR</strong> - 0040000 目录</li>
<li><strong>S_IFCHR</strong> - 0020000 字符装置</li>
<li><strong>S_IFIFO</strong> - 0010000 先进先出</li>
<li><strong>S_ISUID</strong> - 04000 文件的 (set user-id on execution)位</li>
<li><strong>S_ISGID</strong> - 02000 文件的 (set group-id on execution)位</li>
<li><strong>S_ISVTX</strong> - 01000 文件的sticky 位</li>
<li><strong>S_IRUSR (S_IREAD)</strong> - 00400 文件所有者具可读取权限</li>
<li><strong>S_IWUSR (S_IWRITE)</strong> - 00200 文件所有者具可写入权限</li>
<li><strong>S_IXUSR (S_IEXEC)</strong> - 00100 文件所有者具可执行权限</li>
<li><strong>S_IRGRP</strong> - 00040 用户组具可读取权限</li>
<li><strong>S_IWGRP</strong> - 00020 用户组具可写入权限</li>
<li><strong>S_IXGRP</strong> - 00010 用户组具可执行权限</li>
<li><strong>S_IROTH</strong> - 00004 其他用户具可读取权限</li>
<li><strong>S_IWOTH</strong> - 00002 其他用户具可写入权限</li>
<li><strong>S_IXOTH</strong> - 00001 其他用户具可执行权限上述的文件类型在 POSIX 中定义了检查这些类型的宏定义</li>
<li><strong>S_ISLNK (st_mode)</strong> - 判断是否为符号连接</li>
<li><strong>S_ISREG (st_mode)</strong> - 是否为一般文件</li>
<li><strong>S_ISDIR (st_mode)</strong> - 是否为目录</li>
<li><strong>S_ISCHR (st_mode)</strong> - 是否为字符装置文件</li>
<li><strong>S_ISBLK (s3e)</strong> - 是否为先进先出</li>
<li><strong>S_ISSOCK (st_mode)</strong> - 是否为socket 若一目录具有sticky 位 (S_ISVTX), 则表示在此目录下的文件只能被该文件所有者、此目录所有者或root 来删除或改名.</li>
</ol>
<p>下面是一个使用示例:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">file_stat</span><span class="params">(<span class="type">char</span> * fileName)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">stat</span> <span class="title">fileStat</span>;</span></span><br><span class="line">    stat(fileName, &amp;fileStat);</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Information for %s\n&quot;</span>, fileName);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;---------------------------\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;File Size: \t\t%ld bytes\n&quot;</span>,fileStat.st_size);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Number of Links: \t%ld\n&quot;</span>,fileStat.st_nlink);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;File inode: \t\t%ld\n&quot;</span>,fileStat.st_ino);</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;File Permissions: \t&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>( (S_ISDIR(fileStat.st_mode)) ? <span class="string">&quot;d&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>( (fileStat.st_mode &amp; S_IRUSR) ? <span class="string">&quot;r&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>( (fileStat.st_mode &amp; S_IWUSR) ? <span class="string">&quot;w&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>( (fileStat.st_mode &amp; S_IXUSR) ? <span class="string">&quot;x&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>( (fileStat.st_mode &amp; S_IRGRP) ? <span class="string">&quot;r&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>( (fileStat.st_mode &amp; S_IWGRP) ? <span class="string">&quot;w&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>( (fileStat.st_mode &amp; S_IXGRP) ? <span class="string">&quot;x&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>( (fileStat.st_mode &amp; S_IROTH) ? <span class="string">&quot;r&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>( (fileStat.st_mode &amp; S_IWOTH) ? <span class="string">&quot;w&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>( (fileStat.st_mode &amp; S_IXOTH) ? <span class="string">&quot;x&quot;</span> : <span class="string">&quot;-&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n\n&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The file %s a symbolic link\n&quot;</span>, (S_ISLNK(fileStat.st_mode)) ? <span class="string">&quot;is&quot;</span> : <span class="string">&quot;is not&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果如下:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Information for data/test.txt</span><br><span class="line">---------------------------</span><br><span class="line">File Size:      24023896 bytes</span><br><span class="line">Number of Links:    1</span><br><span class="line">File inode:         8261278</span><br><span class="line">File Permissions:   -rw-rw-r--</span><br><span class="line"></span><br><span class="line">The file is not a symbolic link</span><br></pre></td></tr></table></figure>




            </div>

            
                <div class="post-copyright-info">
                    
<div class="article-copyright-info-container">
    <ul class="copyright-info-content">
        <li class="post-title">
            <span class="type">本文标题</span>：<span class="content">【C】文件操作(二)</span>
        </li>
        <li class="post-author">
            <span class="type">本文作者</span>：<span class="content">Pin Young</span>
        </li>
        <li class="post-time">
            <span class="type">创建时间</span>：<span class="content">2016-03-04 18:45:21</span>
        </li>
        <li class="post-link">
            <span class="type">本文链接</span>：<span class="content">posts/ce80.html</span>
        </li>
        <li class="post-license">
            <span class="type">版权声明</span>：<span class="content">本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</span>
        </li>
    </ul>
    <div class="copy-copyright-info flex-center tooltip" data-content="复制版权信息" data-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/C/">#C</a>&nbsp;
                        </li>
                    
                </ul>
            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                               rel="prev"
                               href="/posts/40d1.html"
                            >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                                <span class="title flex-center">
                                <span class="post-nav-title-item">【C】解析命令行参数--getopt和getopt_long</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                               rel="next"
                               href="/posts/c0c7.html"
                            >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">Android日志系统</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                                <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                            </a>
                        </div>
                    
                </div>
            

            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fseek-%E5%92%8C-ftell"><span class="nav-number">2.</span> <span class="nav-text">fseek 和 ftell</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fwrite"><span class="nav-number">3.</span> <span class="nav-text">fwrite</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fread"><span class="nav-number">4.</span> <span class="nav-text">fread</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rewind"><span class="nav-number">5.</span> <span class="nav-text">rewind</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#setbuf-%E5%92%8C-setvbuf"><span class="nav-number">6.</span> <span class="nav-text">setbuf 和 setvbuf</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#fflush"><span class="nav-number">7.</span> <span class="nav-text">fflush</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#stat"><span class="nav-number">8.</span> <span class="nav-text">stat</span></a></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            
<footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
                <span>2014</span> -
            
            2023
            
                &nbsp;<i class="fas fa-heart icon-animate"></i>
                &nbsp;<a href="/">Pin Young</a>
            
        </div>
        
            <script async data-pjax
                    src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                
                
                    总访问量&nbsp;<span id="busuanzi_value_site_pv"></span>
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/dstansice">零域Lite 1.3.1</a>
        </div>
        
        
        <script async defer data-website-id="b3b1feba-ef0f-4367-ba34-6a0152b8749b" src="https://analysis.0skyu.cn/umami.js"></script>
         
            <div class="icp-info info-item">
            <div class="theme-info info-item">
                <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12011002021027" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img src="https://0skyu.cn/beian.png" style="float:left;"/><p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">津公网安备 12011002021027号</p></a> 
                </div>
                 <div class="theme-info info-item">
               <center> <a target="_blank" rel="nofollow"
                   href="https://beian.miit.gov.cn"
                >
                    津ICP备2021004482号-1
                </a></center>
                </div>
                
            </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>





    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-block.js"></script>




    
<script src="/js/lazyload.js"></script>



<div class="post-scripts pjax">
    
        
<script src="/js/post-helper.js"></script>

        
            
<script src="/js/libs/anime.min.js"></script>

        
        
            
<script src="/js/toc.js"></script>

        
    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
