<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="空中有零，零域，分享快乐，音乐，心得，生活，电影，代码，编程，考试，学业，零式的天空，凌空博客，原零空博客，原Tans博客，现零的小屋官方博客，计算机，音乐，电脑，编程，生活，分享">
    <meta name="description" content="一个技术控，爱技术，爱分享，爱音乐">
    <meta name="author" content="Pin Young">
    
    <title>
        
            PWA 与 UWP 的结合 |
        
        零域
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="shortcut icon" href="/img/favicon.png">
    
<link rel="stylesheet" href="/font/css/fontawesome.min.css">

    
<link rel="stylesheet" href="/font/css/regular.min.css">

    
<link rel="stylesheet" href="/font/css/solid.min.css">

    
<link rel="stylesheet" href="/font/css/brands.min.css">

    
    <script id="hexo-configurations">
    let KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"0skyu.cn","root":"/","language":"zh-CN","path":"search.xml"}
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true},"style":{"primary_color":"#EE5A24","logo":"/img/favicon.png","favicon":"/img/favicon.png","avatar":"img/1.jpg","font_size":null,"font_family":null,"hover":{"shadow":true,"scale":false},"first_screen":{"enable":true,"header_transparent":false,"background_img":"/img/bg/333.jpg","description":"Keep writing and Keep loving.","font_color":"#f0d21a","hitokoto":true},"scroll":{"progress_bar":true,"percent":false}},"local_search":{"enable":true,"preload":true},"code_copy":{},"code_block":{"tools":{"enable":true,"style":"default"},"highlight_theme":"default"},"side_tools":{},"pjax":{"enable":true},"lazyload":{"enable":true},"comment":{"enable":false,"use":"gitalk","valine":{"appid":null,"appkey":null,"server_urls":null,"placeholder":null},"gitalk":{"github_id":"DsTansice","github_admins":"DsTansice","repository":"Null-Comment","client_id":"b109b534b2268088d780","client_secret":"7808e138a1ffbcd9f02bb39cc1ee7fb41828c52f","proxy":null},"twikoo":{"env_id":"twikoo-0skyucn-1gkzaji32bb03146","region":null,"version":"1.6.8"},"waline":{"server_url":null,"reaction":false,"version":2}},"post":{"author_label":{"enable":true,"auto":true,"custom_label_list":["Trainee","Engineer","Architect"]},"word_count":{"enable":true,"wordcount":true,"min2read":true},"img_align":"left","copyright_info":true},"version":"3.6.1"}
    KEEP.language_ago = {"second":"%s 秒前","minute":"%s 分钟前","hour":"%s 小时前","day":"%s 天前","week":"%s 周前","month":"%s 个月前","year":"%s 年前"}
    KEEP.language_code_block = {"copy":"复制代码","copied":"已复制","fold":"折叠代码块","folded":"已折叠"}
    KEEP.language_copy_copyright = {"copy":"复制版权信息","copied":"已复制","title":"原文标题","author":"原文作者","link":"原文链接"}
  </script>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="零域" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>


<main class="page-container">

    

    <div class="page-main-content">

        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="header-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="/img/favicon.png">
                </a>
            
            <a class="logo-title" href="/">
               零域
            </a>
        </div>

        <div class="right">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                首页
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                归档
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                标签
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/categories"
                            >
                                分类
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/links"
                            >
                                友链
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               target="_blank" rel="noopener" href="https://hao.0skyu.cn/"
                            >
                                HAO
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">首页</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">归档</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">标签</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/categories">分类</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/links">友链</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       target="_blank" rel="noopener" href="https://hao.0skyu.cn/">HAO</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle">

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            <div class="article-title">
                <span class="title-hover-animation">PWA 与 UWP 的结合</span>
            </div>

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="/img/1.jpg">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">Pin Young</span>
                            
                                <span class="author-label">Lv9</span>
                            
                        </div>
                        <div class="meta-info">
                            
<div class="article-meta-info">
    <span class="article-date article-meta-item">
        
            <i class="fa-regular fa-calendar-plus"></i>&nbsp;
        
        <span class="pc">2019-07-01 09:29:00</span>
        <span class="mobile">2019-07-01 09:29</span>
    </span>
    
        <span class="article-update-date article-meta-item">
        <i class="fas fa-file-pen"></i>&nbsp;
        <span class="pc">2023-02-02 14:05:21</span>
    </span>
    
    
        <span class="article-categories article-meta-item">
            <i class="fas fa-folder"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/%E7%BD%91%E9%A1%B5/">网页</a>&nbsp;
                    </li>
                
                    <li>
                        &gt; <a href="/categories/%E7%BD%91%E9%A1%B5/PWA/">PWA</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fas fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/web/">web</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/pwa/">pwa</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/uwp/">uwp</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fas fa-file-word"></i>&nbsp;<span>4.9k 字</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fas fa-clock"></i>&nbsp;<span>18 分钟</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content keep-markdown-body">
                

                <p>:::tip<br>早前，微软为了挽回UWP的颓势，曾推进PWA上架微软应用商店的工作。配合微软进行转制的有Uber、Twitter等知名大厂的网页应用。这些经过转制的应用看起来和网页端并无二致，但却可以调用<code>NativeAPI</code>，在某些地方达到甚至超越了nodejs的效果，而这种转制，也让PWA在Windows下更为强大。</p>
<p>本章便是来探讨PWA是如何与UWP相结合，产生 <strong>1+1&gt;2</strong> 的效果的。<br>:::</p>
<span id="more"></span>

<h2 id="什么是-PWA"><a href="#什么是-PWA" class="headerlink" title="什么是 PWA"></a>什么是 PWA</h2><p>PWA，全称 <code>Progressive Web App</code>，翻译过来就是渐进式网页应用。所以PWA首先要是一个网页，在此基础上，如果浏览器或者其他的渲染器支持，才会变成一个应用。这也正是其<strong>渐进式</strong>的由来。</p>
<p>从组成结构上来说，PWA是对原始网页的一个补充。这种补充不是破坏式的，因为只需要添加两个文件，这两个文件分别是<code>Service Worker</code>和<code>Manifest</code>。甚至极端一些，如果你只对PWA所带来的强大后台功能感兴趣，那么<code>Manifest</code>都可以不要。</p>
<p>通常来说，PWA更喜欢移动端。它是App-Like，像本地应用却又不是本地应用。比本地应用更轻，卸载也更为方便。</p>
<p>但是在桌面端，PWA便不甚突出。相比起应用，在浏览器中打开几个标签页显然更为方便，如果没有一些特殊的功能，那么是否集成PWA则显得不那么重要。</p>
<p>显然，UWP下WinRT的加入，便是为PWA在桌面端赋予了新的能力。尽管在新的VS2019中已经不再支持。</p>
<h2 id="以-PWA-为基础的-UWP-应用"><a href="#以-PWA-为基础的-UWP-应用" class="headerlink" title="以 PWA 为基础的 UWP 应用"></a>以 PWA 为基础的 UWP 应用</h2><p>UWP是一个平台，而最原汁原味的应用开发自然是采用<code>XAML</code>+<code>C#</code>，除此之外，Javascript搭配HTML也是一个不错的实现。但不管开发采取何种方式，在与本机API交互时，都需要依托WinRT API，相当于一个中间层。</p>
<p>当PWA应用运行于UWP平台之上时，启动它的进程并非浏览器进程，而是名为<code>wwahost.exe</code>的进程。</p>
<p>Javascript能调用绝大部分WinRT API，但有一些平台独有的，比如<code>Windows.UI.XAML</code>命名空间下的API就不能调用。这意味着PWA应用并不能调取Acrylic Brush来实现Fluent Design中的动效及光效，不过前端UI库极多，达到类似的效果也并不困难。</p>
<p>UWP对PWA的赋能，更多地体现在平台特色功能上。随便举几个例子：</p>
<ul>
<li>本地文件IO</li>
<li>Microsoft服务的访问</li>
<li>机器学习</li>
<li>设备调用（比如照相机、陀螺仪等）</li>
<li>通知推送</li>
<li>Cortana</li>
</ul>
<p>上述功能只是诸多特色功能中的一部分，这得益于Windows10带来的强大功能，以及WinRT作为中间层提供的良好兼容能力。</p>
<h2 id="从现有-PWA-项目中建立-UWP-应用"><a href="#从现有-PWA-项目中建立-UWP-应用" class="headerlink" title="从现有 PWA 项目中建立 UWP 应用"></a>从现有 PWA 项目中建立 UWP 应用</h2><p>假设你已经写好了一个PWA应用，包括了<code>Service Worker</code>，Manifest有没有并不重要。</p>
<p>那么如何根据这个项目创建一个UWP应用呢？非常简单，甚至不需要你修改现有代码。</p>
<p>打开<strong>VS2017</strong> <em>（必须要是这个版本的Visual Studio）</em>。新建一个<code>Progressive Web App</code>项目。<br><img  
                     lazyload
                     alt="image"
                     data-src="https://storage.live.com/items/51816931BAB0F7A8!13425?authkey=AO7QXpgYo7-5DUU"
                      alt="531a0d1c-ae65-41ca-b240-08d33b61a39f.png"
                ></p>
<p>我们可以观察新项目的目录结构，可以发现，新项目仅有几个标注为error错误页面，和一些UWP项目自带的图标文件、应用清单文件等。</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://storage.live.com/items/51816931BAB0F7A8!13430?authkey=AO7QXpgYo7-5DUU"
                      alt="7a4018c0-f653-4779-9d4d-d29749254705.png"
                ></p>
<p>这和我们平常的开发可不一样，看样子VS并没有为我们提供<code>index.html</code>等配套文件。奇怪，这些文件难道要我们自己创建吗？</p>
<p>当然不是。</p>
<p>甚至你根本不需要添加任何文件。</p>
<p>那如何让它工作呢？</p>
<p>答案就在应用清单中。</p>
<p>打开<code>package.appxmanifest</code>，秘密就在Application -&gt; Start page 选项中。</p>
<p>如果你的页面上线了，直接在这里输入你的网页网址，点击运行，它就可以工作了。</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://storage.live.com/items/51816931BAB0F7A8!13426?authkey=AO7QXpgYo7-5DUU"
                      alt="b1850053-6613-40c8-bdfc-a102b4050bf5.png"
                ></p>
<p>想新建一个以PWA为基础的UWP应用，可以说是非常简单了。</p>
<p>如果你有UWP的基础，相信对你来说，配置应用图标，改写应用名这些操作应该是驾轻就熟，无需赘述了。</p>
<h2 id="代码中集成WinRT-API"><a href="#代码中集成WinRT-API" class="headerlink" title="代码中集成WinRT API"></a>代码中集成WinRT API</h2><p>对于从现有项目中新建UWP应用而言，并没有什么值得称道的地方。因为这看起来就是一个浏览器套壳应用罢了。</p>
<p>但如果你打算将PWA应用转制为UWP，那么你感兴趣的地方就绝不仅于此。</p>
<p>尽管UWP应用本身反响平平，但是在功能性上仍比PWA应用要强上很多，比如文件IO。</p>
<h3 id="调用本地文件操作API的例子"><a href="#调用本地文件操作API的例子" class="headerlink" title="调用本地文件操作API的例子"></a>调用本地文件操作API的例子</h3><blockquote>
<p>对于一个网页应用，<code>能读不能写</code>几乎是常态。你可以通过Input标签来获取本机文件，但很显然，如果你想保存什么文件到计算机上，就要麻烦很多了，甚至要走许多弯路。但是依托于UWP，我们可以直接调用本地API帮助我们自如地实现文件的读写。</p>
</blockquote>
<p>新建一个简单的项目（你可以使用喜欢的编辑器，比如VS Code），项目结构如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">IO</span><br><span class="line">|- index.html</span><br><span class="line">|- sw.js</span><br></pre></td></tr></table></figure>

<p>在<code>index.html</code>中，我们新建两个按钮及一个文本框，用作我们的UI元素。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;left&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;import&quot;</span>&gt;</span>导入<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;export&quot;</span> <span class="attr">style</span>=<span class="string">&quot;margin-top: 20px&quot;</span>&gt;</span>导出<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;right&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">textarea</span> <span class="attr">id</span>=<span class="string">&quot;contentBox&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;请输入内容&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>接下来注册我们的<code>serviceWorker</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&quot;serviceWorker&quot;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">   navigator.<span class="property">serviceWorker</span>.<span class="title function_">register</span>(<span class="string">&quot;/sw.js&quot;</span>).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">registration</span>) &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Service Worker registered with scope:&quot;</span>, registration.<span class="property">scope</span>);</span><br><span class="line">   &#125;).<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Service worker registration failed:&quot;</span>, err);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这些算是基本的准备工作，为求简便，脚本可以直接写在<code>&lt;body&gt;</code>标签中，尽管这并不符合书写规范。</p>
<p>接下来我们为两个按钮绑定事件，将下面的代码写入到html文件中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> win = <span class="variable language_">window</span>.<span class="property">Windows</span>;</span><br><span class="line"><span class="keyword">let</span> importButton = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#import&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> exportButton = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#export&#x27;</span>);</span><br><span class="line"><span class="comment">// 导入文件，调用了FileOpenPicker</span></span><br><span class="line">importButton.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (win) &#123;</span><br><span class="line">        <span class="keyword">let</span> sto = win.<span class="property">Storage</span>;</span><br><span class="line">        <span class="keyword">let</span> picker = <span class="keyword">new</span> sto.<span class="property">Pickers</span>.<span class="title class_">FileOpenPicker</span>();</span><br><span class="line">        <span class="keyword">let</span> input = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#contentBox&#x27;</span>)</span><br><span class="line">        picker.<span class="property">SuggestStartLocation</span> = sto.<span class="property">Pickers</span>.<span class="property">PickerLocationId</span>.<span class="property">documentsLibrary</span>;</span><br><span class="line">        picker.<span class="property">fileTypeFilter</span>.<span class="title function_">push</span>(<span class="string">&#x27;.txt&#x27;</span>);</span><br><span class="line">        picker.<span class="title function_">pickSingleFileAsync</span>()</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">            sto.<span class="property">FileIO</span>.<span class="title function_">readTextAsync</span>(file).<span class="title function_">then</span>(<span class="function">(<span class="params">str</span>) =&gt;</span> &#123;</span><br><span class="line">                input.<span class="property">value</span>=str;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;读取文件失败&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 导出文本至文件中，调用了FileSavePicker</span></span><br><span class="line">exportButton.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (win) &#123;</span><br><span class="line">        <span class="keyword">let</span> sto = win.<span class="property">Storage</span>;</span><br><span class="line">        <span class="keyword">let</span> text = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#contentBox&#x27;</span>).<span class="property">value</span>;</span><br><span class="line">        <span class="keyword">if</span> (text) &#123;</span><br><span class="line">            <span class="keyword">let</span> picker = <span class="keyword">new</span> sto.<span class="property">Pickers</span>.<span class="title class_">FileSavePicker</span>();</span><br><span class="line">            picker.<span class="property">defaultFileExtension</span> = <span class="string">&#x27;.txt&#x27;</span>;</span><br><span class="line">            picker.<span class="property">suggestedFileName</span> = <span class="string">&#x27;Test.txt&#x27;</span>;</span><br><span class="line">            picker.<span class="property">fileTypeChoices</span>.<span class="title function_">insert</span>(<span class="string">&#x27;文本文件&#x27;</span>, [<span class="string">&#x27;.txt&#x27;</span>]);</span><br><span class="line">            picker.<span class="property">suggestStartLocation</span> = sto.<span class="property">Pickers</span>.<span class="property">PickerLocationId</span>.<span class="property">documentsLibrary</span>;</span><br><span class="line">            picker.<span class="title function_">pickSaveFileAsync</span>()</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function">(<span class="params">file</span>) =&gt;</span> &#123;</span><br><span class="line">                sto.<span class="property">FileIO</span>.<span class="title function_">writeTextAsync</span>(file,text);</span><br><span class="line">            &#125;)</span><br><span class="line">            .<span class="title function_">catch</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;保存文件失败&#x27;</span>)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>如果你之前开发过传统UWP应用，那么这里面的一些类你应该很熟悉，比如FileOpenPicker-文件选择器、FileSavePicker-文件保存器、FileIO-文件静态操作类等。</p>
<blockquote>
<p>相比起C#，Javascript的调用显然要复杂一些，需要写出完整的类名，即包含了命名空间的类名。</p>
</blockquote>
<p>所有这些WinRT API都被放在了window.Windows之中，所以每次调用的时候，都是先从这里开始。</p>
<p>但是有一个问题，原生JS中并没有window.Windows这个对象，我们也从来没有创建过它，那为什么通过它可以调用本机API呢？</p>
<p>答案还是在我们的PWA-UWP项目上。</p>
<h3 id="为PWA项目开启WinRT支持"><a href="#为PWA项目开启WinRT支持" class="headerlink" title="为PWA项目开启WinRT支持"></a>为PWA项目开启WinRT支持</h3><p>在进入到我们最开始用VS创建的PWA项目之前，你需要先运行一个本地服务器，让我们刚刚写的文件IO的例子可以运行。</p>
<p>我使用的是本机的IIS服务器，前端也有很多其他的选择，比如<code>http-server</code>。喜欢使用哪个就使用哪个，这无关紧要。</p>
<p>起一个本地服务器的目的也仅在于能通过http链接访问到我们的 <code>index.html</code> 文件。</p>
<p>服务器跑起来之后，将对应的链接写在 <code>package.appxmanifest</code> 的<code>Start page</code>中。</p>
<p>这是我们的准备工作。</p>
<p>如果你这个时候直接运行项目，你会发现点击按钮一点反应也没有。这很正常，因为你并没有开启该UWP项目的特殊权限。</p>
<p>想要让window.Windows工作，需要在<code>package.appxmanifest</code>下的<code>Content URIs</code>中添加网站所对应的链接，并将 <code>WinRT Access</code> 设置为<code>All</code>。</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://storage.live.com/items/51816931BAB0F7A8!13427?authkey=AO7QXpgYo7-5DUU"
                      alt="4e046625-a9f0-4f37-a655-ab013cd91641.png"
                ></p>
<p>这个时候重新运行项目，你就会发现当你点击按钮的时候，文件选择器就会顺利弹出了。</p>
<hr>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>我们完成了一次简单的实验。即通过Javascript调用本机API来帮助我们实现文件的读写。</p>
<p>尽管在实际编写中需要频繁查文档而显得略有些繁琐，但总体的结果是好的。Javascript和WinRT API的交互也很顺畅。</p>
<p>但仍有一些需要注意的问题。</p>
<p><strong>首要的便在于命名。</strong></p>
<p>C#中的命名遵循帕斯卡规范，即每个单词首字母都大写，而Javascript多采用驼峰命名。在调用WinRT API时，微软更改了方法和部分属性的命名方式，从帕斯卡变为了小驼峰。在没有代码提示的情况下，极易写错，这是一个大坑，在书写的时候应遵循以下规律：</p>
<ol>
<li>命名空间和类是帕斯卡写法</li>
<li>类的成员（包括方法和属性）是驼峰命名</li>
<li>事件名称纯小写</li>
</ol>
<p><strong>其次是支持的功能有限。</strong></p>
<p>尽管大多数特色功能都得到了支持，但只能作为补充。有些内容，比如<code>Windows.UI.Controls</code>里的内容就不可用。关于可用及不可用的API，你可以参照<a class="link"   target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/microsoft-edge/windows-runtime" >WinRT文档<i class="fas fa-external-link-alt"></i></a>。</p>
<p><strong>最后则是工作范围问题。</strong></p>
<p>你也看到了，我们调用WinRT API的途径是<code>window.Windows</code>，而在Service Worker中，<code>window</code>变量是不存在的，有的只是<code>self</code>，而<code>self.Windows</code>并不存在。所以这意味着一件事，在Service Worker中无法使用WinRT API。</p>
<p>所以，我们并没有可能将Service Worker变成一个Runtime Component。</p>
<h2 id="与Service-Worker结合推送消息"><a href="#与Service-Worker结合推送消息" class="headerlink" title="与Service Worker结合推送消息"></a>与Service Worker结合推送消息</h2><p>尽管我们说，试图将Service Worker变为Runtime Component是一种徒劳。但这并不意味着我们不能借助Service Worker来配合工作了。</p>
<p>假使我们需要用到消息推送。</p>
<p>在前端中，消息推送早已有之，比如<code>web-push</code>。但这种消息推送只能用作信息展示。Win10的Toast Notification能做的事情远不止于此，它还可以添加按钮以进行交互。</p>
<p>想要使用原生的Toast Notification，则势必要在前台进行触发。<em>这里的前台指的是与Service Worker相对应的主UI线程。</em></p>
<p>按照一般PWA的开发趋势，数据处理（不涉及前台UI交互）放在Service Worker中，我们可以简化成如下处理逻辑：</p>
<p><strong>前台发起信息处理请求 –&gt; Service Worker进行处理 –&gt; 将处理结果发回前台 –&gt; 前台弹出通知</strong></p>
<h3 id="调用通知模块"><a href="#调用通知模块" class="headerlink" title="调用通知模块"></a>调用通知模块</h3><p>我们要调用本地的Toast Notification，这涉及到WinRT API。</p>
<p>那就先把这个弹出通知的方法写出来：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * data结构：</span></span><br><span class="line"><span class="comment"> * &#123;</span></span><br><span class="line"><span class="comment"> *   title: string,</span></span><br><span class="line"><span class="comment"> *   content: string</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> title = data.<span class="property">title</span>;</span><br><span class="line">    <span class="keyword">let</span> content = data.<span class="property">content</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">Windows</span> &amp;&amp; <span class="variable language_">window</span>.<span class="property">Windows</span>.<span class="property">UI</span>.<span class="property">Notifications</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> notify = <span class="variable language_">window</span>.<span class="property">Windows</span>.<span class="property">UI</span>.<span class="property">Notifications</span>;</span><br><span class="line">        <span class="keyword">let</span> xml =</span><br><span class="line">        <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;toast launch=&quot;app-defined-string&quot;&gt;</span></span><br><span class="line"><span class="string">          &lt;visual&gt;</span></span><br><span class="line"><span class="string">              &lt;binding template=&quot;ToastGeneric&quot;&gt;</span></span><br><span class="line"><span class="string">                  &lt;text hint-maxLines=&quot;1&quot;&gt;<span class="subst">$&#123;title&#125;</span>&lt;/text&gt;</span></span><br><span class="line"><span class="string">                  &lt;text&gt;<span class="subst">$&#123;content&#125;</span>&lt;/text&gt;</span></span><br><span class="line"><span class="string">                  &lt;image placement=&quot;appLogoOverride&quot; hint-crop=&quot;circle&quot; src=&quot;https://picsum.photos/48?image=883&quot;/&gt;</span></span><br><span class="line"><span class="string">              &lt;/binding&gt;</span></span><br><span class="line"><span class="string">          &lt;/visual&gt;</span></span><br><span class="line"><span class="string">          &lt;actions&gt;</span></span><br><span class="line"><span class="string">              &lt;action content=&quot;查看更多细节&quot; arguments=&quot;action=detail&amp;amp;contentId=351&quot; activationType=&quot;foreground&quot;/&gt;</span></span><br><span class="line"><span class="string">          &lt;/actions&gt;</span></span><br><span class="line"><span class="string">        &lt;/toast&gt;</span></span><br><span class="line"><span class="string">        `</span>;</span><br><span class="line">        <span class="keyword">let</span> doc=<span class="keyword">new</span> <span class="title class_">Windows</span>.<span class="property">Data</span>.<span class="property">Xml</span>.<span class="property">Dom</span>.<span class="title class_">XmlDocument</span>();</span><br><span class="line">        doc.<span class="title function_">loadXml</span>(xml);</span><br><span class="line">        <span class="keyword">let</span> notification = <span class="keyword">new</span> notify.<span class="title class_">ToastNotification</span>(doc);</span><br><span class="line">        notify.<span class="property">ToastNotificationManager</span>.<span class="title function_">createToastNotifier</span>().<span class="title function_">show</span>(notification);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的通知UI我们用一个XML字符串表示，关于通知的UI结构，可以参见<a class="link"   target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/windows/uwp/design/shell/tiles-and-notifications/adaptive-interactive-toasts" >官方文档<i class="fas fa-external-link-alt"></i></a>。</p>
<p>我们的通知包含了<strong>LOGO</strong>、<strong>标题</strong>、<strong>文本</strong>和一个<strong>按钮</strong>。我们希望达到一个效果：</p>
<p>点击弹出通知的按钮，前台给予响应 <em>（即能捕获到对应的点击事件，并可以获取到按钮附带的参数）</em></p>
<p>在UWP中，Toast的激活分为前台和后台两种，由于PWA-UWP项目没有后台支持，所以这里仅考虑前台的情况。</p>
<p>点击通知时，会激活软件，所以我们需要捕获软件的Activated事件。该事件由UWP框架提供，所以这里我们来看如何触发这一事件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">Windows</span>) &#123;</span><br><span class="line">  <span class="title class_">Windows</span>.<span class="property">UI</span>.<span class="property">WebUI</span>.<span class="property">WebUIApplication</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;activated&quot;</span>, <span class="keyword">function</span> (<span class="params">activatedEventArgs</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (activatedEventArgs.<span class="property">kind</span> == <span class="title class_">Windows</span>.<span class="property">ApplicationModel</span>.<span class="property">Activation</span>.<span class="property">ActivationKind</span>.<span class="property">toastNotification</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(activatedEventArgs.<span class="property">argument</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们渲染出的网页就放在<code>WebUIApplication</code>之中，所以给这个容器注册一个<code>activated</code>事件即可。但软件激活有多种渠道，为了确保抓到我们需要的事件，需要做一个甄别，这个甄别就通过事件参数的<code>kind</code>属性来进行，对上号了，我们就处理附带的信息参数（这里只是简单的输出）</p>
<p>我们现在完成了需要用到WinRT API的部分，接下来的事情就交由Javascript原生API来处理了。</p>
<h3 id="窗口与Service-Worker通信"><a href="#窗口与Service-Worker通信" class="headerlink" title="窗口与Service Worker通信"></a>窗口与Service Worker通信</h3><p>首先建立一个<code>sw.js</code>的文件，并在主页注册它：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&quot;serviceWorker&quot;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">   navigator.<span class="property">serviceWorker</span>.<span class="title function_">register</span>(<span class="string">&quot;/sw.js&quot;</span>).<span class="title function_">then</span>(<span class="keyword">function</span> (<span class="params">registration</span>) &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Service Worker registered with scope:&quot;</span>, registration.<span class="property">scope</span>);</span><br><span class="line">   &#125;).<span class="title function_">catch</span>(<span class="keyword">function</span> (<span class="params">err</span>) &#123;</span><br><span class="line">     <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Service worker registration failed:&quot;</span>, err);</span><br><span class="line">   &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们在<code>&lt;body&gt;</code>中写一个按钮，用以做我们的触发器：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;pushButton&quot;</span>&gt;</span>推送消息<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>添加按钮的事件处理方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> btn = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#pushButton&#x27;</span>);</span><br><span class="line">btn.<span class="title function_">addEventListener</span>(<span class="string">&#x27;click&#x27;</span>, <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 利用postMessage和serviceWorker通信</span></span><br><span class="line">  navigator.<span class="property">serviceWorker</span>.<span class="property">controller</span>.<span class="title function_">postMessage</span>(<span class="string">&#x27;toast&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在sw.js中捕获信息，进行数据处理，并返回给前台：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(event.<span class="property">data</span>==<span class="string">&#x27;toast&#x27;</span>)&#123;</span><br><span class="line">    self.<span class="property">clients</span>.<span class="title function_">matchAll</span>().<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">clients</span>)&#123;</span><br><span class="line">      clients.<span class="title function_">forEach</span>(<span class="keyword">function</span>(<span class="params">client</span>)&#123;</span><br><span class="line">          <span class="comment">// 向前台发送信息</span></span><br><span class="line">          client.<span class="title function_">postMessage</span>(</span><br><span class="line">            &#123;<span class="attr">title</span>:<span class="string">&#x27;后台信息&#x27;</span>,<span class="attr">content</span>:<span class="string">&#x27;来自后台的你&#x27;</span>&#125;</span><br><span class="line">          );</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>既然serviceWorker回传了数据，那么前台就必须要接收才行：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">navigator.<span class="property">serviceWorker</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;message&quot;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="comment">// sendMessage方法是我们最开始就定义好的</span></span><br><span class="line">    <span class="title function_">sendMessage</span>(event.<span class="property">data</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>现在可以运行一下软件试试了。点击按钮，屏幕右下方就会弹出通知，点击通知上的按钮，留意控制台的输出：</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://storage.live.com/items/51816931BAB0F7A8!13428?authkey=AO7QXpgYo7-5DUU"
                      alt="e2817abd-1f83-4110-969d-02ade71b144c.png"
                ></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://storage.live.com/items/51816931BAB0F7A8!13429?authkey=AO7QXpgYo7-5DUU"
                      alt="8435a417-65d7-44a6-87d6-94f6dce7fb4d.png"
                ></p>
<h2 id="借助Typescript实现智能提示"><a href="#借助Typescript实现智能提示" class="headerlink" title="借助Typescript实现智能提示"></a>借助Typescript实现智能提示</h2><p>用Javascript写代码有一个不太好的地方，即智能提示有限。尤其是在我们写WinRT相关API的时候，我想没谁记得住那一堆堆的API，尤其是全名。</p>
<p>如果你不想在写的时候疯狂查文档，我想你需要试试Typescript。</p>
<p>Typescript也是微软家的，你可以理解为是具备了静态类型检查功能的Javascript。静态类型的语言有一个好处就是类型确定，所有的属性、方法、字段都有定义，做起代码提示的时候就方便很多。</p>
<p>在开始搞智能提示之前，请先安装好Typescript的相关环境，具体如何安装，并不是本文需要讲的内容，请读者自行查阅。</p>
<p>假设你安装了Typescript，并对其有了一定的了解，现在开始我们的操作吧：</p>
<h3 id="新建一个WinJS的UWP项目"><a href="#新建一个WinJS的UWP项目" class="headerlink" title="新建一个WinJS的UWP项目"></a>新建一个WinJS的UWP项目</h3><p>Typescript想实现代码提示，需要有一个定义文件，后缀名为<code>.d.ts</code>。但是在官方的<code>@types</code>库中，并不存在window.Windows相关的定义文件。</p>
<p>幸运的是，微软为了能让WinJS的项目可以正常工作，已经将WinRT的API定义文件写进了VS中，新建一个WinJS项目就是为了找到它。</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://storage.live.com/items/51816931BAB0F7A8!13432?authkey=AO7QXpgYo7-5DUU"
                      alt="dc698ebd-5f66-44a7-a738-2503ba7c9e1a.png"
                ></p>
<p>新建项目后，在项目管理列表窗口里打开所有隐藏文件，在如下目录中找到我们的目标文件：<code>winrtrefs.d.ts</code></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://storage.live.com/items/51816931BAB0F7A8!13433?authkey=AO7QXpgYo7-5DUU"
                      alt="8aacd944-e17b-466b-8773-434564dabab9.png"
                ></p>
<h3 id="引入定义文件"><a href="#引入定义文件" class="headerlink" title="引入定义文件"></a>引入定义文件</h3><p>得到了<code>winrtrefs.d.ts</code>文件之后，我们将其复制到我们的PWA项目中。</p>
<p>:::tip<br>如果你已有一个项目，且不好转换到Typescript，可以另起炉灶，将你要写的逻辑代码视作模块，单独编写，单独编译<br>:::</p>
<p>新建一个ts文件，我们在顶部对<code>.d.ts</code>文件进行引入：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///&lt;reference path=&quot;./winrtrefs.d.ts&quot;/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="欺骗Typescript编译器"><a href="#欺骗Typescript编译器" class="headerlink" title="欺骗Typescript编译器"></a>欺骗Typescript编译器</h3><p>前面两步其实很简单，就是复制+引入，做完之后你就已经拥有智能提示的能力了。</p>
<p>当然，这需要编辑器的支持，我个人推荐使用<strong>VS Code</strong>。</p>
<p>但是在Typescript中编写代码的时候还是会遇到问题。如果你直接书写<code>window.Windows</code>，编辑器会报错，说<code>Windows</code>并没有在<code>window</code>中定义。</p>
<p>这就是静态类型检查和动态语言之间的矛盾了。我们明白Windows是在UWP容器下附加到window中的变量，事先当然不好定义。</p>
<p>为了编译器放我们一马，这里要做一点处理：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">interface</span> <span class="title class_">Window</span> &#123;</span><br><span class="line">    <span class="title class_">Windows</span>: <span class="built_in">any</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>强行怼一个定义即可。</p>
<p>接下来就可以享受代码提示带来的快感了：</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://storage.live.com/items/51816931BAB0F7A8!13435?authkey=AO7QXpgYo7-5DUU"
                      alt="15764430-b394-4e92-8182-09c7ad0677dd.png"
                ></p>
<h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>我们举了两个例子加一个技巧，这两个例子设计到的PWA的内容少，而WinRT的内容多，因为我们这篇文章的侧重点就在于此，但真要做PWA，依然要以网页技术为主。</p>
<p>在传统UWP应用中，我们使用LocalSettings存放用户设置，使用本地文件来存放结构化数据。这些在网页技术中都有对应的内容，比如localStorage或indexDb。由于Service Worker中没有window，我们不能借助WinRT将PWA改造成一个完全的本地应用，事实上也完全没有必要。</p>
<p>WinRT API只能在前台使用，这注定WinRT API的身份只是赋能，而不是革新。</p>
<p>赋能何意？</p>
<p>借助UWP的容器，实现本地化功能，获取一些仅本地应用才能获取的权限。</p>
<p>但是除开这些，PWA应用本质上还是一个功能完整的网页应用。理论上不应该有任何重要功能依赖于WinRT，所以对于一个成熟的PWA项目来说，WinRT可以帮助应用获得更好的本地化体验，却不能成就它。</p>
<p>就如同外国领导人新春时送上的一句中文祝福，或可以博一个亲民的彩头。但说与不说，都不会对两国关系有实质性影响。</p>
<p>在新的Visual Studio 2019中，JS相关的UWP开发都已被移除。其实按道理来说，这种开发手段不应该这么激进地处理，考虑到微软放弃了当前的Edge浏览器，转投Chromium阵营。我猜测是原Edge团队内部出现了问题，导致Edge无法继续更新或更新频率过低（与Windows捆绑）。</p>
<p>而不久前，微软正在开放基于Chromium的<a class="link"   target="_blank" rel="noopener" href="https://blogs.windows.com/msedgedev/2019/06/18/building-hybrid-applications-with-the-webview2-developer-preview/#TQ3BjLPkJG0DgVgV.97" >WebView2<i class="fas fa-external-link-alt"></i></a>的测试，所以乐观估计，JS终会回到UWP中，但会基于新的渲染内核，这可能是两个大版本之后的事情了。</p>
<p>目前的PWA与UWP结合的事，了解即可。</p>
<p>轉載來自 <a class="link"   target="_blank" rel="noopener" href="https://blog.richasy.cn/" >https://blog.richasy.cn/<i class="fas fa-external-link-alt"></i></a></p>

            </div>

            
                <div class="post-copyright-info">
                    
<div class="article-copyright-info-container">
    <ul class="copyright-info-content">
        <li class="post-title">
            <span class="type">本文标题</span>：<span class="content">PWA 与 UWP 的结合</span>
        </li>
        <li class="post-author">
            <span class="type">本文作者</span>：<span class="content">Pin Young</span>
        </li>
        <li class="post-time">
            <span class="type">创建时间</span>：<span class="content">2019-07-01 09:29:00</span>
        </li>
        <li class="post-link">
            <span class="type">本文链接</span>：<span class="content">posts/45a8.html</span>
        </li>
        <li class="post-license">
            <span class="type">版权声明</span>：<span class="content">本博客所有文章除特别声明外，均采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> 许可协议。转载请注明出处！</span>
        </li>
    </ul>
    <div class="copy-copyright-info flex-center tooltip" data-content="复制版权信息" data-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/web/">#web</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/pwa/">#pwa</a>&nbsp;
                        </li>
                    
                        <li class="tag-item">
                            <a href="/tags/uwp/">#uwp</a>&nbsp;
                        </li>
                    
                </ul>
            

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                               rel="prev"
                               href="/posts/1e9b.html"
                            >
                            <span class="left arrow-icon flex-center">
                              <i class="fas fa-chevron-left"></i>
                            </span>
                                <span class="title flex-center">
                                <span class="post-nav-title-item">Code Highlight Style test</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                               rel="next"
                               href="/posts/4497.html"
                            >
                            <span class="title flex-center">
                                <span class="post-nav-title-item">基于Vue、ElementUI的换肤解决方案</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                                <span class="right arrow-icon flex-center">
                              <i class="fas fa-chevron-right"></i>
                            </span>
                            </a>
                        </div>
                    
                </div>
            

            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF-PWA"><span class="nav-number">1.</span> <span class="nav-text">什么是 PWA</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A5-PWA-%E4%B8%BA%E5%9F%BA%E7%A1%80%E7%9A%84-UWP-%E5%BA%94%E7%94%A8"><span class="nav-number">2.</span> <span class="nav-text">以 PWA 为基础的 UWP 应用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8E%E7%8E%B0%E6%9C%89-PWA-%E9%A1%B9%E7%9B%AE%E4%B8%AD%E5%BB%BA%E7%AB%8B-UWP-%E5%BA%94%E7%94%A8"><span class="nav-number">3.</span> <span class="nav-text">从现有 PWA 项目中建立 UWP 应用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E4%B8%AD%E9%9B%86%E6%88%90WinRT-API"><span class="nav-number">4.</span> <span class="nav-text">代码中集成WinRT API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9CAPI%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="nav-number">4.1.</span> <span class="nav-text">调用本地文件操作API的例子</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BAPWA%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%90%AFWinRT%E6%94%AF%E6%8C%81"><span class="nav-number">4.2.</span> <span class="nav-text">为PWA项目开启WinRT支持</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">4.3.</span> <span class="nav-text">小结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8EService-Worker%E7%BB%93%E5%90%88%E6%8E%A8%E9%80%81%E6%B6%88%E6%81%AF"><span class="nav-number">5.</span> <span class="nav-text">与Service Worker结合推送消息</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E9%80%9A%E7%9F%A5%E6%A8%A1%E5%9D%97"><span class="nav-number">5.1.</span> <span class="nav-text">调用通知模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AA%97%E5%8F%A3%E4%B8%8EService-Worker%E9%80%9A%E4%BF%A1"><span class="nav-number">5.2.</span> <span class="nav-text">窗口与Service Worker通信</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%80%9F%E5%8A%A9Typescript%E5%AE%9E%E7%8E%B0%E6%99%BA%E8%83%BD%E6%8F%90%E7%A4%BA"><span class="nav-number">6.</span> <span class="nav-text">借助Typescript实现智能提示</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B0%E5%BB%BA%E4%B8%80%E4%B8%AAWinJS%E7%9A%84UWP%E9%A1%B9%E7%9B%AE"><span class="nav-number">6.1.</span> <span class="nav-text">新建一个WinJS的UWP项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%95%E5%85%A5%E5%AE%9A%E4%B9%89%E6%96%87%E4%BB%B6"><span class="nav-number">6.2.</span> <span class="nav-text">引入定义文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%AC%BA%E9%AA%97Typescript%E7%BC%96%E8%AF%91%E5%99%A8"><span class="nav-number">6.3.</span> <span class="nav-text">欺骗Typescript编译器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E8%AF%AD"><span class="nav-number">7.</span> <span class="nav-text">结语</span></a></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom">
            
<footer class="footer">
    <div class="info-container">
        <div class="copyright-info info-item">
            &copy;
            
                <span>2014</span> -
            
            2023
            
                &nbsp;<i class="fas fa-heart icon-animate"></i>
                &nbsp;<a href="/">Pin Young</a>
            
        </div>
        
            <script async data-pjax
                    src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    访问人数&nbsp;<span id="busuanzi_value_site_uv"></span>&ensp;
                
                
                    总访问量&nbsp;<span id="busuanzi_value_site_pv"></span>
                
            </div>
        
        <div class="theme-info info-item">
            由 <a target="_blank" href="https://hexo.io">Hexo</a> 驱动&nbsp;|&nbsp;主题&nbsp;<a class="theme-version" target="_blank" href="https://github.com/dstansice">零域Lite 1.3.1</a>
        </div>
        
        
        <script async defer data-website-id="b3b1feba-ef0f-4367-ba34-6a0152b8749b" src="https://analysis.0skyu.cn/umami.js"></script>
         
            <div class="icp-info info-item">
            <div class="theme-info info-item">
                <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=12011002021027" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img src="https://0skyu.cn/beian.png" style="float:left;"/><p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">津公网安备 12011002021027号</p></a> 
                </div>
                 <div class="theme-info info-item">
               <center> <a target="_blank" rel="nofollow"
                   href="https://beian.miit.gov.cn"
                >
                    津ICP备2021004482号-1
                </a></center>
                </div>
                
            </div>
        
        
    </div>
</footer>

        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="tools-list">
        <!-- TOC aside toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-bottom-side-tools">
        <div class="side-tools-container">
    <ul class="side-tools-list">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="tools-item rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                    <i class="fas fa-rss"></i>
                </a>
            </li>
        

        
            <li class="tools-item tool-scroll-to-top flex-center">
                <i class="fas fa-arrow-up"></i>
            </li>
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list">
        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>
        
    </ul>
</div>

    </div>

    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜索..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>




<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/header-shrink.js"></script>

<script src="/js/back2top.js"></script>

<script src="/js/dark-light-toggle.js"></script>





    
<script src="/js/local-search.js"></script>




    
<script src="/js/code-block.js"></script>




    
<script src="/js/lazyload.js"></script>



<div class="post-scripts pjax">
    
        
<script src="/js/post-helper.js"></script>

        
            
<script src="/js/libs/anime.min.js"></script>

        
        
            
<script src="/js/toc.js"></script>

        
    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            KEEP.refresh();
        });
    });
</script>



</body>
</html>
