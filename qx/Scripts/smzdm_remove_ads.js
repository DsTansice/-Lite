const scriptName="什么值得买";let magicJS=MagicJS(scriptName,"INFO");function MagicJS(e="MagicJS",t="INFO"){return new class{constructor(){if(this.version="2.2.3.3",this.scriptName=e,this.logLevels={DEBUG:5,INFO:4,NOTIFY:3,WARNING:2,ERROR:1,CRITICAL:0,NONE:-1},this.isLoon="undefined"!=typeof $loon,this.isQuanX="undefined"!=typeof $task,this.isJSBox="undefined"!=typeof $drive,this.isNode="undefined"!=typeof module&&!this.isJSBox,this.isSurge="undefined"!=typeof $httpClient&&!this.isLoon,this.node={request:void 0,fs:void 0,data:{}},this.iOSUserAgent="Mozilla/5.0 (iPhone; CPU iPhone OS 13_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.5 Mobile/15E148 Safari/604.1",this.pcUserAgent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.125 Safari/537.36 Edg/84.0.522.59",this.logLevel=t,this._barkUrl="",this.isNode){this.node.fs=require("fs"),this.node.request=require("request");try{this.node.fs.accessSync("./magic.json",this.node.fs.constants.R_OK|this.node.fs.constants.W_OK)}catch(e){this.node.fs.writeFileSync("./magic.json","{}",{encoding:"utf8"})}this.node.data=require("./magic.json")}else this.isJSBox&&($file.exists("drive://MagicJS")||$file.mkdir("drive://MagicJS"),$file.exists("drive://MagicJS/magic.json")||$file.write({data:$data({string:"{}"}),path:"drive://MagicJS/magic.json"}))}set barkUrl(e){this._barkUrl=e.replace(/\/+$/g,"")}set logLevel(e){this._logLevel="string"==typeof e?e.toUpperCase():"DEBUG"}get logLevel(){return this._logLevel}get isRequest(){return"undefined"!=typeof $request&&"undefined"==typeof $response}get isResponse(){return"undefined"!=typeof $response}get request(){return"undefined"!=typeof $request?$request:void 0}get response(){return"undefined"!=typeof $response?($response.hasOwnProperty("status")&&($response.statusCode=$response.status),$response.hasOwnProperty("statusCode")&&($response.status=$response.statusCode),$response):void 0}get platform(){return this.isSurge?"Surge":this.isQuanX?"Quantumult X":this.isLoon?"Loon":this.isJSBox?"JSBox":this.isNode?"Node.js":"Unknown"}read(t,s=""){let o="";this.isSurge||this.isLoon?o=$persistentStore.read(t):this.isQuanX?o=$prefs.valueForKey(t):this.isNode?o=this.node.data:this.isJSBox&&(o=$file.read("drive://MagicJS/magic.json").string);try{this.isNode&&(o=o[t]),this.isJSBox&&(o=JSON.parse(o)[t]),s&&(o=(o="string"==typeof o?JSON.parse(o):o)&&"object"==typeof o?o[s]:null)}catch(e){this.logError(e),o=s?{}:null,this.del(t)}void 0===o&&(o=null);try{o&&"string"==typeof o&&(o=JSON.parse(o))}catch(e){}return this.logDebug(`READ DATA [${t}]${s?`[${s}]`:""}(${typeof o})
`+JSON.stringify(o)),o}write(t,e,s=""){let o=s?{}:"";if(s&&(this.isSurge||this.isLoon)?o=$persistentStore.read(t):s&&this.isQuanX?o=$prefs.valueForKey(t):this.isNode?o=this.node.data:this.isJSBox&&(o=JSON.parse($file.read("drive://MagicJS/magic.json").string)),s){try{o="object"==typeof(o="string"==typeof o?JSON.parse(o):o)&&o?o:{}}catch(e){this.logError(e),this.del(t),o={}}this.isJSBox||this.isNode?(o[t]&&"object"==typeof o[t]||(o[t]={}),o[t].hasOwnProperty(s)||(o[t][s]=null),void 0===e?delete o[t][s]:o[t][s]=e):void 0===e?delete o[s]:o[s]=e}else this.isNode||this.isJSBox?void 0===e?delete o[t]:o[t]=e:o=void 0===e?null:e;"object"==typeof o&&(o=JSON.stringify(o)),this.isSurge||this.isLoon?$persistentStore.write(o,t):this.isQuanX?$prefs.setValueForKey(o,t):this.isNode?this.node.fs.writeFileSync("./magic.json",o):this.isJSBox&&$file.write({data:$data({string:o}),path:"drive://MagicJS/magic.json"}),this.logDebug(`WRITE DATA [${t}]${s?`[${s}]`:""}(${typeof e})
`+JSON.stringify(e))}del(e,t=""){this.logDebug(`DELETE KEY [${e}]`+(t?`[${t}]`:"")),this.write(e,null,t)}notify(e=this.scriptName,t="",s="",o=""){o=(e=>{let t={};return"string"==typeof e?this.isLoon?t={openUrl:e}:this.isQuanX?t={"open-url":e}:this.isSurge&&(t={url:e}):"object"==typeof e&&(this.isLoon?(t.openUrl=e["open-url"]||"",t.mediaUrl=e["media-url"]||""):this.isQuanX?t=e["open-url"]||e["media-url"]?e:{}:this.isSurge&&(e=e["open-url"]||e.openUrl,t=e?{url:e}:{})),t})(o),1==arguments.length&&(e=this.scriptName,t="",s=arguments[0]),this.logNotify(`title:${e}
subTitle:${t}
body:${s}
options:`+("object"==typeof o?JSON.stringify(o):o)),this.isSurge?$notification.post(e,t,s,o):this.isLoon?o?$notification.post(e,t,s,o):$notification.post(e,t,s):this.isQuanX?$notify(e,t,s,o):this.isNode?this._barkUrl&&(o=encodeURI(e+`/${t}
`+s),this.get(this._barkUrl+"/"+o,()=>{})):this.isJSBox&&$push.schedule({title:e,body:t?t+`
`+s:s})}notifyDebug(e=this.scriptName,t="",s="",o=""){"DEBUG"===this.logLevel&&(1==arguments.length&&(e=this.scriptName,t="",s=arguments[0]),this.notify(e,t,s,o))}log(e,t="INFO"){this.logLevels[this._logLevel]<this.logLevels[t.toUpperCase()]||console.log(`[${t}] [${this.scriptName}]
${e}
`)}logDebug(e){this.log(e,"DEBUG")}logInfo(e){this.log(e,"INFO")}logNotify(e){this.log(e,"NOTIFY")}logWarning(e){this.log(e,"WARNING")}logError(e){this.log(e,"ERROR")}logRetry(e){this.log(e,"RETRY")}adapterHttpOptions(e,t){let s="object"==typeof e?Object.assign({},e):{url:e,headers:{}};s.hasOwnProperty("header")&&!s.hasOwnProperty("headers")&&(s.headers=s.header,delete s.header);var o={accept:"Accept","accept-ch":"Accept-CH","accept-charset":"Accept-Charset","accept-features":"Accept-Features","accept-encoding":"Accept-Encoding","accept-language":"Accept-Language","accept-ranges":"Accept-Ranges","access-control-allow-credentials":"Access-Control-Allow-Credentials","access-control-allow-origin":"Access-Control-Allow-Origin","access-control-allow-methods":"Access-Control-Allow-Methods","access-control-allow-headers":"Access-Control-Allow-Headers","access-control-max-age":"Access-Control-Max-Age","access-control-expose-headers":"Access-Control-Expose-Headers","access-control-request-method":"Access-Control-Request-Method","access-control-request-headers":"Access-Control-Request-Headers",age:"Age",allow:"Allow",alternates:"Alternates",authorization:"Authorization","cache-control":"Cache-Control",connection:"Connection","content-encoding":"Content-Encoding","content-language":"Content-Language","content-length":"Content-Length","content-location":"Content-Location","content-md5":"Content-MD5","content-range":"Content-Range","content-security-policy":"Content-Security-Policy","content-type":"Content-Type",cookie:"Cookie",dnt:"DNT",date:"Date",etag:"ETag",expect:"Expect",expires:"Expires",from:"From",host:"Host","if-match":"If-Match","if-modified-since":"If-Modified-Since","if-none-match":"If-None-Match","if-range":"If-Range","if-unmodified-since":"If-Unmodified-Since","last-event-id":"Last-Event-ID","last-modified":"Last-Modified",link:"Link",location:"Location","max-forwards":"Max-Forwards",negotiate:"Negotiate",origin:"Origin",pragma:"Pragma","proxy-authenticate":"Proxy-Authenticate","proxy-authorization":"Proxy-Authorization",range:"Range",referer:"Referer","retry-after":"Retry-After","sec-websocket-extensions":"Sec-Websocket-Extensions","sec-websocket-key":"Sec-Websocket-Key","sec-websocket-origin":"Sec-Websocket-Origin","sec-websocket-protocol":"Sec-Websocket-Protocol","sec-websocket-version":"Sec-Websocket-Version",server:"Server","set-cookie":"Set-Cookie","set-cookie2":"Set-Cookie2","strict-transport-security":"Strict-Transport-Security",tcn:"TCN",te:"TE",trailer:"Trailer","transfer-encoding":"Transfer-Encoding",upgrade:"Upgrade","user-agent":"User-Agent","variant-vary":"Variant-Vary",vary:"Vary",via:"Via",warning:"Warning","www-authenticate":"WWW-Authenticate","x-content-duration":"X-Content-Duration","x-content-security-policy":"X-Content-Security-Policy","x-dnsprefetch-control":"X-DNSPrefetch-Control","x-frame-options":"X-Frame-Options","x-requested-with":"X-Requested-With","x-surge-skip-scripting":"X-Surge-Skip-Scripting"};if("object"==typeof s.headers)for(var i in s.headers)o[i]&&(s.headers[o[i]]=s.headers[i],delete s.headers[i]);s.headers&&"object"==typeof s.headers&&s.headers["User-Agent"]||(s.headers&&"object"==typeof s.headers||(s.headers={}),this.isNode?s.headers["User-Agent"]=this.pcUserAgent:s.headers["User-Agent"]=this.iOSUserAgent);let r=!1;return(r="object"==typeof s.opts&&(!0===s.opts.hints||!0===s.opts["Skip-Scripting"])||"object"==typeof s.headers&&!0===s.headers["X-Surge-Skip-Scripting"]?!0:r)||(this.isSurge?s.headers["X-Surge-Skip-Scripting"]=!1:this.isLoon?s.headers["X-Requested-With"]="XMLHttpRequest":this.isQuanX&&("object"!=typeof s.opts&&(s.opts={}),s.opts.hints=!1)),this.isSurge&&!r||delete s.headers["X-Surge-Skip-Scripting"],!this.isQuanX&&s.hasOwnProperty("opts")&&delete s.opts,this.isQuanX&&s.hasOwnProperty("opts")&&delete s.opts["Skip-Scripting"],"GET"===t&&!this.isNode&&s.body&&(e=Object.keys(s.body).map(e=>void 0===s.body?"":encodeURIComponent(e)+"="+encodeURIComponent(s.body[e])).join("&"),s.url.indexOf("?")<0&&(s.url+="?"),s.url.lastIndexOf("&")+1!=s.url.length&&s.url.lastIndexOf("?")+1!=s.url.length&&(s.url+="&"),s.url+=e,delete s.body),this.isQuanX?(s.hasOwnProperty("body")&&"string"!=typeof s.body&&(s.body=JSON.stringify(s.body)),s.method=t):this.isNode?(delete s.headers["Accept-Encoding"],"object"==typeof s.body&&("GET"===t?(s.qs=s.body,delete s.body):"POST"===t&&(s.json=!0,s.body=s.body))):this.isJSBox&&(s.header=s.headers,delete s.headers),s}adapterHttpResponse(e){let t={body:e.body,headers:e.headers,json:()=>JSON.parse(t.body)};return e.hasOwnProperty("statusCode")&&e.statusCode&&(t.status=e.statusCode),t}get(e,o){e=this.adapterHttpOptions(e,"GET");this.logDebug("HTTP GET: "+JSON.stringify(e)),this.isSurge||this.isLoon?$httpClient.get(e,o):this.isQuanX?$task.fetch(e).then(e=>{e.status=e.statusCode,o(null,e,e.body)},e=>o(e.error,null,null)):this.isNode?this.node.request.get(e,(e,t,s)=>{t=this.adapterHttpResponse(t),o(e,t,s)}):this.isJSBox&&(e.handler=e=>{var t=e.error?JSON.stringify(e.error):void 0,s="object"==typeof e.data?JSON.stringify(e.data):e.data;o(t,e.response,s)},$http.get(e))}getPromise(e){return new Promise((s,o)=>{magicJS.get(e,(e,t)=>{e?o(e):s(t)})})}post(e,o){var t,e=this.adapterHttpOptions(e,"POST");this.logDebug("HTTP POST: "+JSON.stringify(e)),this.isSurge||this.isLoon?$httpClient.post(e,o):this.isQuanX?$task.fetch(e).then(e=>{e.status=e.statusCode,o(null,e,e.body)},e=>{o(e.error,null,null)}):this.isNode?((t=this.node.request.post(e,o)).status=t.statusCode,delete t.statusCode):this.isJSBox&&(e.handler=e=>{var t=e.error?JSON.stringify(e.error):void 0,s="object"==typeof e.data?JSON.stringify(e.data):e.data;o(t,e.response,s)},$http.post(e))}get http(){return{get:this.getPromise,post:this.post}}done(e={}){"undefined"!=typeof $done&&$done(e)}isToday(e){var t;return null!=e&&(t=new Date,"string"==typeof e&&(e=new Date(e)),t.getFullYear()==e.getFullYear())&&t.getMonth()==e.getMonth()&&t.getDay()==e.getDay()}isNumber(e){return"NaN"!==parseFloat(e).toString()}attempt(e,t=null){return e.then(e=>[null,e]).catch(e=>(this.logError(e),[e,t]))}retry(r,n=5,a=0,c=null){return(...e)=>new Promise((s,o)=>{function i(...t){Promise.resolve().then(()=>r.apply(this,t)).then(e=>{"function"==typeof c?Promise.resolve().then(()=>c(e)).then(()=>{s(e)}).catch(e=>{1<=n?0<a?setTimeout(()=>i.apply(this,t),a):i.apply(this,t):o(e),n--}):s(e)}).catch(e=>{this.logRetry(e),1<=n&&0<a?setTimeout(()=>i.apply(this,t),a):1<=n?i.apply(this,t):o(e),n--})}i.apply(this,e)})}formatTime(e,t="yyyy-MM-dd hh:mm:ss"){var s,o={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};for(s in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),o)new RegExp("("+s+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?o[s]:("00"+o[s]).substr((""+o[s]).length)));return t}now(){return this.formatTime(new Date,"yyyy-MM-dd hh:mm:ss")}today(){return this.formatTime(new Date,"yyyy-MM-dd")}sleep(t){return new Promise(e=>setTimeout(e,t))}}(e)}(()=>{let e=null;if(magicJS.isResponse)switch(!0){case/^https?:\/\/app-api\.smzdm\.com\/util\/loading/.test(magicJS.request.url):try{var t=JSON.parse(magicJS.response.body);t.data.forEach(e=>{e.start_date="2030-12-24 00:00:00",e.end_date="2030-12-24 23:59:59",e.unix_start_date="1924272000",e.unix_end_date="1924358399",e.is_show_ad="0"}),e={body:JSON.stringify(t)}}catch(e){magicJS.logError("去除APP启动广告出现异常："+e)}break;case/^https?:\/\/homepage-api\.smzdm\.com\/v3\/home/.test(magicJS.request.url):try{var o=JSON.parse(magicJS.response.body);let s=[];o.data.component.forEach(e=>{var t;"banner"===e.zz_type?(t=e.zz_content.filter(e=>"广告"!==e.tag),e.zz_content=t):"list"===e.zz_type?(t=e.zz_content.filter(e=>"ads"!==e.zz_content.model_type),e.zz_content=t):"circular_banner"===e.zz_type&&(e.zz_content.circular_banner_option.background="1",e.zz_content.circular_banner_option.color_card="#ffffff",e.zz_content.circular_banner_option.img=""),"top_banner"!==e.zz_type&&"hongbao"!==e.zz_type&&s.push(e)}),o.data.component=s,e={body:JSON.stringify(o)}}catch(e){magicJS.logError("首页去广告出现异常："+e)}break;case/^https?:\/\/haojia-api\.smzdm\.com\/home\/list/.test(magicJS.request.url):try{var s=JSON.parse(magicJS.response.body),i=s.data.banner.big_banner.filter(e=>""==e.ad_banner_id),r=(s.data.banner.big_banner=i,s.data.rows.filter(e=>!e.hasOwnProperty("ad_banner_id")));s.data.banner.hongbao_banner=[],s.data.banner.module_banner.hongbao={},s.data.rows=r,e={body:JSON.stringify(s)}}catch(e){magicJS.logError("好价去广告出现异常："+e)}break;case/^https?:\/\/haojia\.m\.smzdm\.com\/detail_modul\/article_releated_modul/.test(magicJS.request.url):try{var n=JSON.parse(magicJS.response.body);n.data.lanmu_qikan={},e={body:JSON.stringify(n)}}catch(e){magicJS.logError("好价详情页去广告出现异常："+e)}break;case/^https?:\/\/baike-api\.smzdm\.com\/home_v3\/list/.test(magicJS.request.url):try{var a=JSON.parse(magicJS.response.body);a.data.rows=a.data.rows.filter(e=>!e.hasOwnProperty("ad_banner_id")||""==e.ad_banner_id),e={body:JSON.stringify(a)}}catch(e){magicJS.logError("百科去广告出现异常："+e)}break;case/^https?:\/\/s-api\.smzdm\.com\/sou\/filter\/tags\/hot_tags/.test(magicJS.request.url):try{var c=JSON.parse(magicJS.response.body);c.data.hongbao={},e={body:JSON.stringify(c)}}catch(e){magicJS.logError("搜索标签去广告出现异常："+e)}break;case/^https?:\/\/s-api\.smzdm\.com\/sou\/list_v10/.test(magicJS.request.url):try{var d=JSON.parse(magicJS.response.body);d.data.rows=d.data.rows.filter(e=>"广告"!==e.article_tag),e={body:JSON.stringify(d)}}catch(e){magicJS.logError("搜索结果去广告出现异常："+e)}break;case/^https?:\/\/zhiyou\.m\.smzdm\.com\/user\/vip\/ajax_get_banner/.test(magicJS.request.url):try{var l=JSON.parse(magicJS.response.body);l.data.big_banner=l.data.big_banner.filter(e=>"广告"!==e.logo_title),e={body:JSON.stringify(l)}}catch(e){magicJS.logError("值会员权益中心banner去广告出现异常："+e)}break;default:magicJS.notify("触发意外的请求处理，请确认脚本或复写配置正常。")}else magicJS.notify("触发意外的请求处理，请确认脚本或复写配置正常。");e?magicJS.done(e):magicJS.done()})();