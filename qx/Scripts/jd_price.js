const path1="serverConfig",path2="wareBusiness",path3="basicConfig",url=$request.url,body=$response.body,$tool=tool();if(-1!=url.indexOf(path1)){let e=JSON.parse(body);delete e.serverConfig.httpdns,delete e.serverConfig.dnsvip,delete e.serverConfig.dnsvip_v6,$done({body:JSON.stringify(e)})}if(-1!=url.indexOf(path3)){let e=JSON.parse(body),t=e.data.JDHttpToolKit;t&&(delete e.data.JDHttpToolKit.httpdns,delete e.data.JDHttpToolKit.dnsvipV6),$done({body:JSON.stringify(e)})}if(-1!=url.indexOf(path2)){let t=JSON.parse(body);const e=t.floors,f=e[e.length-1],g=f.data.property.shareUrl;let o="";request_history_price(g).then(e=>{if(0==e.priceTrend.series.length)throw new Error("Whoops!");o=priceSummary(e.priceTrend)}).catch(e=>o="暂无价格信息").finally(()=>{var r=adword_obj();r.data.ad.textColor="#fe0000";let i=0;for(let t=0;t<e.length;t++){var n=e[t];if(n.mId==r.mId){i=t+1;break}if(n.sortId>r.sortId){i=t;break}}r.data.ad.adword=o,e.insert(i,r),$done({body:JSON.stringify(t)})})}function priceSummary(e){e=e.series[0];let r=`🍵 当前: ${parseFloat(e.current/100)}${getSpace(8)}最低: ${parseFloat(e.min/100)}${getSpace(8)}最高: `+parseFloat(e.max/100);return historySummary(e.data).forEach((e,t)=>{r+=`
`+e.Name+getSpace(8)+e.Price+getSpace(8)+e.Date+getSpace(8)+e.Difference}),r}function historySummary(e){let i,n,o,a,s,p,f;return(e=e.reverse().slice(0,360)).forEach((e,t)=>{var r=getExactTime(e.x),e=parseFloat(e.y/100);0==t&&(i=e,f={Name:"六一八价格",Price:"-",Date:"-",Difference:"-",price:"-"},p={Name:"双十一价格",Price:"-",Date:"-",Difference:"-",price:"-"},n={Name:"三十天最低",Price:"¥"+String(e),Date:r,Difference:difference(i,e),price:e},o={Name:"九十天最低",Price:"¥"+String(e),Date:r,Difference:difference(i,e),price:e},a={Name:"一百八最低",Price:"¥"+String(e),Date:r,Difference:difference(i,e),price:e},s={Name:"三百六最低",Price:"¥"+String(e),Date:r,Difference:difference(i,e),price:e}),-1!=r.indexOf("06-18")&&(f.price=e,f.Price="¥"+String(e),f.Date=r,f.Difference=difference(i,e)),-1!=r.indexOf("11-11")&&(p.price=e,p.Price="¥"+String(e),p.Date=r,p.Difference=difference(i,e)),t<30&&e<n.price&&(n.price=e,n.Price="¥"+String(e),n.Date=r,n.Difference=difference(i,e)),t<90&&e<o.price&&(o.price=e,o.Price="¥"+String(e),o.Date=r,o.Difference=difference(i,e)),t<180&&e<a.price&&(a.price=e,a.Price="¥"+String(e),a.Date=r,a.Difference=difference(i,e)),t<360&&e<s.price&&(s.price=e,s.Price="¥"+String(e),s.Date=r,s.Difference=difference(i,e))}),[n,o,a,s,f,p]}async function request_history_price(e){const t={headers:{"User-Agent":"bijiago/1.4.2 (com.bijiago.app; build:65; iOS 14.5.1) Alamofire/4.9.1","Content-Type":"application/x-www-form-urlencoded"}};var r,o,i=await new Promise(function(i,n){t.url="https://app.bijiago.com/service/product?app_platform=ios&app_version=65&device=750%2A1334&opt=product&posi=default&url="+encodeURIComponent(e),$tool.get(t,function(e,t,r){e?n(e):i(JSON.parse(r))})});return r=i.rid,o=i.product.dp_id,await new Promise(function(i,n){t.url="https://app.bijiago.com/service/product",t.body=`app_platform=ios&app_version=10000&append_promo=1&dp_id=${o}&from=url&opt=priceTrend&rid=`+r,$tool.post(t,function(e,t,r){e?n(e):i(JSON.parse(r))})})}function getExactTime(e){e=new Date(1e3*e);return e.getFullYear()+"-"+((e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-")+e.getDate()}function difference(e,t){e=sub(e,t);return 0==e?"-":(0<e?"↑":"↓")+String(Math.abs(e))}function sub(e,t){return add(e,-Number(t),arguments[2])}function add(e,t){e=e.toString(),t=t.toString();var r=e.split("."),i=t.split("."),r=2==r.length?r[1]:"",i=2==i.length?i[1]:"",r=Math.max(r.length,i.length),i=Math.pow(10,r),i=Number(((e*i+t*i)/i).toFixed(r)),r=arguments[2];return"number"==typeof r?Number(i.toFixed(r)):i}function getSpace(t){let r="";for(let e=0;e<t;e++)r+=" ";return r}function adword_obj(){return{bId:"eCustom_flo_199",cf:{bgc:"#ffffff",spl:"empty"},data:{ad:{adword:"",textColor:"#8C8C8C",color:"#f23030",newALContent:!0,hasFold:!0,class:"com.jd.app.server.warecoresoa.domain.AdWordInfo.AdWordInfo",adLinkContent:"",adLink:""}},mId:"bpAdword",refId:"eAdword_0000000028",sortId:13}}function tool(){const n="undefined"!=typeof $httpClient,o="undefined"!=typeof $task;var e="undefined"!=typeof $response;const a="function"==typeof require?{request:require("request")}:null;const s=e=>(e&&(e.status?e.statusCode=e.status:e.statusCode&&(e.status=e.statusCode)),e);return{isQuanX:o,isSurge:n,isResponse:e,notify:(e,t,r)=>{o&&$notify(e,t,r),n&&$notification.post(e,t,r),a&&console.log(JSON.stringify({title:e,subtitle:t,message:r}))},write:(e,t)=>o?$prefs.setValueForKey(e,t):n?$persistentStore.write(e,t):void 0,read:e=>o?$prefs.valueForKey(e):n?$persistentStore.read(e):void 0,get:(e,i)=>{o&&((e="string"==typeof e?{url:e}:e).method="GET",$task.fetch(e).then(e=>{i(null,s(e),e.body)},e=>i(e.error,null,null))),n&&$httpClient.get(e,(e,t,r)=>{i(e,s(t),r)}),a&&a.request(e,(e,t,r)=>{i(e,s(t),r)})},post:(e,i)=>{o&&((e="string"==typeof e?{url:e}:e).method="POST",$task.fetch(e).then(e=>{i(null,s(e),e.body)},e=>i(e.error,null,null))),n&&$httpClient.post(e,(e,t,r)=>{i(e,s(t),r)}),a&&a.request.post(e,(e,t,r)=>{i(e,s(t),r)})}}}Array.prototype.insert=function(e,t){this.splice(e,0,t)},Date.prototype.format=function(e){var t,r,i={"y+":this.getFullYear(),"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),"S+":this.getMilliseconds()};for(t in i)new RegExp("("+t+")").test(e)&&(e="y+"==t?e.replace(RegExp.$1,(""+i[t]).substr(4-RegExp.$1.length)):"S+"==t?(r=1==(r=RegExp.$1.length)?3:r,e.replace(RegExp.$1,("00"+i[t]).substr((""+i[t]).length-1,r))):e.replace(RegExp.$1,1==RegExp.$1.length?i[t]:("00"+i[t]).substr((""+i[t]).length)));return e};