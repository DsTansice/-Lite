let[req,rsp]=[$request,JSON.parse($response.body||"{}")];async function runs(){req.url.includes("token.php")&&rsp.ad&&(rsp.ad.minor=[],rsp.ad.major=[]),req.url.includes("m3u8.php")&&rsp.message&&(await adURL(""),await new Promise(e=>setTimeout(e,25e3)),await adURL("end"),rsp=await playURL())}function adURL(e){return new Promise(s=>{get({url:`https://api.gamer.com.tw/mobile_app/anime/v1/stat_ad.php?ad=${e}&schedule=0&sn=`+req.url.split(/sn=(\d+)/)[1],headers:req.headers},(e,r,t)=>s())})}function playURL(){return new Promise(s=>{get({url:req.url,headers:req.headers},(e,r,t)=>s(JSON.parse(t||"{}")))})}function get(e,r){"undefined"!=typeof $task&&$task.fetch(e).then(e=>{e.status=e.statusCode,r(null,e,e.body)},e=>r(e.error,null,null)),"undefined"!=typeof $httpClient&&$httpClient.get(e,r)}runs().catch(e=>{console.log("[BahamutAnime] ERROR: "+(e.message||e))}).finally(()=>$done({body:JSON.stringify(rsp)}));