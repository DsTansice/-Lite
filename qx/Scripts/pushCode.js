const $=new Env("互助码提交");$.ddfactory="东东工厂",$.jxfactory="京喜工厂",$.bean="种豆得豆",$.farm="京东农场",$.pet="京东萌宠",$.zz="京东赚赚";let isGetCookie="undefined"!=typeof $request;function execDdfactory(){return new Promise(i=>{var e={url:"http://api.turinglabs.net/api/v1/jd/ddfactory/create/"+$.ddfactory,headers:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148"}};$.get(e,(e,t,s)=>{try{$.ddfactoryBody=s}catch(e){$.logErr(e,t)}finally{i()}})})}function execJxfactory(){return new Promise(i=>{var e={url:"http://api.turinglabs.net/api/v1/jd/jxfactory/create/"+$.jxfactory,headers:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148"}};$.get(e,(e,t,s)=>{try{$.jxfactoryBody=s}catch(e){$.logErr(e,t)}finally{i()}})})}function execBean(){return new Promise(i=>{var e={url:"http://api.turinglabs.net/api/v1/jd/bean/create/"+$.bean,headers:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148"}};$.get(e,(e,t,s)=>{try{$.beanBody=s}catch(e){$.logErr(e,t)}finally{i()}})})}function execFarm(){return new Promise(i=>{var e={url:"http://api.turinglabs.net/api/v1/jd/farm/create/"+$.farm,headers:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148"}};$.get(e,(e,t,s)=>{try{$.farmBody=s}catch(e){$.logErr(e,t)}finally{i()}})})}function execPet(){return new Promise(i=>{var e={url:"http://api.turinglabs.net/api/v1/jd/pet/create/"+$.pet,headers:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148"}};$.get(e,(e,t,s)=>{try{$.petBody=s}catch(e){$.logErr(e,t)}finally{i()}})})}function execZZ(){return new Promise(i=>{var e={url:"https://code.chiang.fun/api/v1/jd/jdzz/create/"+$.zz,headers:{"User-Agent":"Mozilla/5.0 (iPhone; CPU iPhone OS 12_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148"}};$.get(e,(e,t,s)=>{try{$.zzBody=s}catch(e){$.logErr(e,t)}finally{i()}})})}function showmsg(){return new Promise(e=>{console.log("东东工厂:"),console.log($.ddfactoryBody),console.log("\r\n京喜工厂:"),console.log($.jxfactoryBody),console.log("\r\n种豆得豆:"),console.log($.beanBody),console.log("\r\n京东农场:"),console.log($.farmBody),console.log("\r\n京东萌宠:"),console.log($.petBody),console.log("\r\n京东赚赚:"),console.log($.zzBody),e()})}function Env(o,e){class s{constructor(e){this.env=e}send(e,t="GET"){e="string"==typeof e?{url:e}:e;let s=this.get;return"POST"===t&&(s=this.post),new Promise((i,r)=>{s.call(this,e,(e,t,s)=>{e?r(e):i(t)})})}get(e){return this.send.call(this.env,e)}post(e){return this.send.call(this.env,e,"POST")}}return new class{constructor(e,t){this.name=e,this.http=new s(this),this.data=null,this.dataFile="box.dat",this.logs=[],this.isMute=!1,this.isNeedRewrite=!1,this.logSeparator="\n",this.startTime=(new Date).getTime(),Object.assign(this,t),this.log("",`🔔${this.name}, 开始!`)}isNode(){return"undefined"!=typeof module&&!!module.exports}isQuanX(){return"undefined"!=typeof $task}isSurge(){return"undefined"!=typeof $httpClient&&"undefined"==typeof $loon}isLoon(){return"undefined"!=typeof $loon}toObj(e,t=null){try{return JSON.parse(e)}catch{return t}}toStr(e,t=null){try{return JSON.stringify(e)}catch{return t}}getjson(e,t){let s=t;if(this.getdata(e))try{s=JSON.parse(this.getdata(e))}catch{}return s}setjson(e,t){try{return this.setdata(JSON.stringify(e),t)}catch{return!1}}getScript(e){return new Promise(i=>{this.get({url:e},(e,t,s)=>i(s))})}runScript(o,a){return new Promise(i=>{let e=this.getdata("@chavy_boxjs_userCfgs.httpapi");e=e&&e.replace(/\n/g,"").trim();var t=(t=this.getdata("@chavy_boxjs_userCfgs.httpapi_timeout"))?+t:20,[s,r]=(t=a&&a.timeout?a.timeout:t,e.split("@"));this.post({url:`http://${r}/v1/scripting/evaluate`,body:{script_text:o,mock_type:"cron",timeout:t},headers:{"X-Key":s,Accept:"*/*"}},(e,t,s)=>i(s))}).catch(e=>this.logErr(e))}loaddata(){if(!this.isNode())return{};this.fs=this.fs||require("fs"),this.path=this.path||require("path");var e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),s=this.fs.existsSync(e),i=!s&&this.fs.existsSync(t);if(!s&&!i)return{};i=s?e:t;try{return JSON.parse(this.fs.readFileSync(i))}catch(e){return{}}}writedata(){var e,t,s,i,r;this.isNode()&&(this.fs=this.fs||require("fs"),this.path=this.path||require("path"),e=this.path.resolve(this.dataFile),t=this.path.resolve(process.cwd(),this.dataFile),i=!(s=this.fs.existsSync(e))&&this.fs.existsSync(t),r=JSON.stringify(this.data),!s&&i?this.fs.writeFileSync(t,r):this.fs.writeFileSync(e,r))}lodash_get(e,t,s){let i=e;for(const e of t.replace(/\[(\d+)\]/g,".$1").split("."))if(i=Object(i)[e],void 0===i)return s;return i}lodash_set(e,i,t){return Object(e)!==e||((i=Array.isArray(i)?i:i.toString().match(/[^.[\]]+/g)||[]).slice(0,-1).reduce((e,t,s)=>Object(e[t])===e[t]?e[t]:e[t]=Math.abs(i[s+1])>>0==+i[s+1]?[]:{},e)[i[i.length-1]]=t),e}getdata(e){let t=this.getval(e);if(/^@/.test(e)){var[,s,i]=/^@(.*?)\.(.*?)$/.exec(e),s=s?this.getval(s):"";if(s)try{const e=JSON.parse(s);t=e?this.lodash_get(e,i,""):t}catch(e){t=""}}return t}setdata(e,t){let s=!1;if(/^@/.test(t)){var[,i,r]=/^@(.*?)\.(.*?)$/.exec(t),o=this.getval(i),o=i?"null"===o?null:o||"{}":"{}";try{const t=JSON.parse(o);this.lodash_set(t,r,e),s=this.setval(JSON.stringify(t),i)}catch(t){o={};this.lodash_set(o,r,e),s=this.setval(JSON.stringify(o),i)}}else s=this.setval(e,t);return s}getval(e){return this.isSurge()||this.isLoon()?$persistentStore.read(e):this.isQuanX()?$prefs.valueForKey(e):this.isNode()?(this.data=this.loaddata(),this.data[e]):this.data&&this.data[e]||null}setval(e,t){return this.isSurge()||this.isLoon()?$persistentStore.write(e,t):this.isQuanX()?$prefs.setValueForKey(e,t):this.isNode()?(this.data=this.loaddata(),this.data[t]=e,this.writedata(),!0):this.data&&this.data[t]||null}initGotEnv(e){this.got=this.got||require("got"),this.cktough=this.cktough||require("tough-cookie"),this.ckjar=this.ckjar||new this.cktough.CookieJar,e&&(e.headers=e.headers||{},void 0===e.headers.Cookie)&&void 0===e.cookieJar&&(e.cookieJar=this.ckjar)}get(e,r=()=>{}){e.headers&&(delete e.headers["Content-Type"],delete e.headers["Content-Length"]),this.isSurge()||this.isLoon()?(this.isSurge()&&this.isNeedRewrite&&(e.headers=e.headers||{},Object.assign(e.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.get(e,(e,t,s)=>{!e&&t&&(t.body=s,t.statusCode=t.status),r(e,t,s)})):this.isQuanX()?(this.isNeedRewrite&&(e.opts=e.opts||{},Object.assign(e.opts,{hints:!1})),$task.fetch(e).then(e=>{var{statusCode:e,statusCode:t,headers:s,body:i}=e;r(null,{status:e,statusCode:t,headers:s,body:i},i)},e=>r(e))):this.isNode()&&(this.initGotEnv(e),this.got(e).on("redirect",(e,t)=>{try{var s;e.headers["set-cookie"]&&(s=e.headers["set-cookie"].map(this.cktough.Cookie.parse).toString(),this.ckjar.setCookieSync(s,null),t.cookieJar=this.ckjar)}catch(e){this.logErr(e)}}).then(e=>{var{statusCode:e,statusCode:t,headers:s,body:i}=e;r(null,{status:e,statusCode:t,headers:s,body:i},i)},e=>{var{message:e,response:t}=e;r(e,t,t&&t.body)}))}post(e,r=()=>{}){if(e.body&&e.headers&&!e.headers["Content-Type"]&&(e.headers["Content-Type"]="application/x-www-form-urlencoded"),e.headers&&delete e.headers["Content-Length"],this.isSurge()||this.isLoon())this.isSurge()&&this.isNeedRewrite&&(e.headers=e.headers||{},Object.assign(e.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient.post(e,(e,t,s)=>{!e&&t&&(t.body=s,t.statusCode=t.status),r(e,t,s)});else if(this.isQuanX())e.method="POST",this.isNeedRewrite&&(e.opts=e.opts||{},Object.assign(e.opts,{hints:!1})),$task.fetch(e).then(e=>{var{statusCode:e,statusCode:t,headers:s,body:i}=e;r(null,{status:e,statusCode:t,headers:s,body:i},i)},e=>r(e));else if(this.isNode()){this.initGotEnv(e);const{url:t,...s}=e;this.got.post(t,s).then(e=>{var{statusCode:e,statusCode:t,headers:s,body:i}=e;r(null,{status:e,statusCode:t,headers:s,body:i},i)},e=>{var{message:e,response:t}=e;r(e,t,t&&t.body)})}}time(e){var t,s={"M+":(new Date).getMonth()+1,"d+":(new Date).getDate(),"H+":(new Date).getHours(),"m+":(new Date).getMinutes(),"s+":(new Date).getSeconds(),"q+":Math.floor(((new Date).getMonth()+3)/3),S:(new Date).getMilliseconds()};for(t in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,((new Date).getFullYear()+"").substr(4-RegExp.$1.length))),s)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?s[t]:("00"+s[t]).substr((""+s[t]).length)));return e}msg(e=o,t="",s="",i){var r=e=>{return e&&("string"==typeof e?this.isLoon()?e:this.isQuanX()?{"open-url":e}:this.isSurge()?{url:e}:void 0:"object"==typeof e?this.isLoon()?{openUrl:e.openUrl||e.url||e["open-url"],mediaUrl:e.mediaUrl||e["media-url"]}:this.isQuanX()?{"open-url":e["open-url"]||e.url||e.openUrl,"media-url":e["media-url"]||e.mediaUrl}:this.isSurge()?{url:e.url||e.openUrl||e["open-url"]}:void 0:void 0)},r=(this.isMute||(this.isSurge()||this.isLoon()?$notification.post(e,t,s,r(i)):this.isQuanX()&&$notify(e,t,s,r(i))),["","==============📣系统通知📣=============="]);r.push(e),t&&r.push(t),s&&r.push(s),console.log(r.join("\n")),this.logs=this.logs.concat(r)}log(...e){0<e.length&&(this.logs=[...this.logs,...e]),console.log(e.join(this.logSeparator))}logErr(e,t){!this.isSurge()&&!this.isQuanX()&&!this.isLoon()?this.log("",`❗️${this.name}, 错误!`,e.stack):this.log("",`❗️${this.name}, 错误!`,e)}wait(t){return new Promise(e=>setTimeout(e,t))}done(e={}){var t=((new Date).getTime()-this.startTime)/1e3;this.log("",`🔔${this.name}, 结束! 🕛 ${t} 秒`),this.log(),(this.isSurge()||this.isQuanX()||this.isLoon())&&$done(e)}}(o,e)}isGetCookie||(async()=>{await execDdfactory(),await execJxfactory(),await execBean(),await execFarm(),await execPet(),await execZZ(),await showmsg()})().catch(e=>$.logErr(e)).finally(()=>$.done());